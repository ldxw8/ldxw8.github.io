<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="UML,Android,Java,设计模式," />





  <link rel="alternate" href="/atom.xml" title="Kofe" type="application/atom+xml" />






<meta name="description" content="在安卓项目中，诸如监听器、适配器、迭代器等并不陌生，然而它们无不体现着设计模式的精髓，设计与模式的结合往往与设计能力与代码质量息息相关。同理逆向思考此类问题，对于一些优秀项目源码的学习障碍往往是对其架构设计的理解（逻辑、性能、解耦等），而不仅仅是源码本身。作为开发者，知其然知其所以然，这也正是我们深入学习设计模式的理由之一。 当然，我们还要正视学习设计模式的心态，掌握了各种设计模式，并不代表个人的">
<meta name="keywords" content="UML,Android,Java,设计模式">
<meta property="og:type" content="article">
<meta property="og:title" content="笔记 | 设计模式之 Android 实践与案例">
<meta property="og:url" content="http://www.kofes.cn/2018/01/Design-Pattern-Based-on-Android.html">
<meta property="og:site_name" content="Kofe">
<meta property="og:description" content="在安卓项目中，诸如监听器、适配器、迭代器等并不陌生，然而它们无不体现着设计模式的精髓，设计与模式的结合往往与设计能力与代码质量息息相关。同理逆向思考此类问题，对于一些优秀项目源码的学习障碍往往是对其架构设计的理解（逻辑、性能、解耦等），而不仅仅是源码本身。作为开发者，知其然知其所以然，这也正是我们深入学习设计模式的理由之一。 当然，我们还要正视学习设计模式的心态，掌握了各种设计模式，并不代表个人的">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_1-1.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_1-2.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-1.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-2.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-3.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-4.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-5.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-6.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-7.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-8.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-9.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-10.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-11.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-12.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-13.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-14.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-15.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-16.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-17.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-18.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-19.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-20.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-21.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-22.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-23.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-24.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-25.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-26.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-27.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-28.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-29.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-30.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-31.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-32.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-33.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-34.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-35.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-36.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-37.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-38.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-39.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-40.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-41.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-42.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-43.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-44.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-45.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-46.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-47.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-48.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_3-1.svg">
<meta property="og:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_3-2.svg">
<meta property="og:updated_time" content="2021-04-30T18:16:58.333Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="笔记 | 设计模式之 Android 实践与案例">
<meta name="twitter:description" content="在安卓项目中，诸如监听器、适配器、迭代器等并不陌生，然而它们无不体现着设计模式的精髓，设计与模式的结合往往与设计能力与代码质量息息相关。同理逆向思考此类问题，对于一些优秀项目源码的学习障碍往往是对其架构设计的理解（逻辑、性能、解耦等），而不仅仅是源码本身。作为开发者，知其然知其所以然，这也正是我们深入学习设计模式的理由之一。 当然，我们还要正视学习设计模式的心态，掌握了各种设计模式，并不代表个人的">
<meta name="twitter:image" content="http://www.kofes.cn/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_1-1.svg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.kofes.cn/2018/01/Design-Pattern-Based-on-Android.html"/>





  <title>笔记 | 设计模式之 Android 实践与案例 | Kofe</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?79b30ca99079b04e5fbf1ad6164bf0c1";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Kofe</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Reading / Project / Paper</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.kofes.cn/2018/01/Design-Pattern-Based-on-Android.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kofe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/profile/society_face_version_1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kofe">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">笔记 | 设计模式之 Android 实践与案例</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-30T19:51:18+08:00">
                2018-01-30
              </time>
            

            

            
          </span>


	  
            <span class="post-updated">
              &nbsp; | &nbsp; 更新于
              <time itemprop="dateUpdated" datetime="2021-05-01T02:16:58+08:00" content="2021-05-01">
                2021-05-01
              </time>
            </span>
          


          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Reading/" itemprop="url" rel="index">
                    <span itemprop="name">Reading</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/Design-Pattern-Based-on-Android.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2018/01/Design-Pattern-Based-on-Android.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/01/Design-Pattern-Based-on-Android.html" class="leancloud_visitors" data-flag-title="笔记 | 设计模式之 Android 实践与案例">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  27,336
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>在安卓项目中，诸如监听器、适配器、迭代器等并不陌生，然而它们无不体现着设计模式的精髓，设计与模式的结合往往与设计能力与代码质量息息相关。同理逆向思考此类问题，对于一些优秀项目源码的学习障碍往往是对其架构设计的理解（逻辑、性能、解耦等），而不仅仅是源码本身。作为开发者，知其然知其所以然，这也正是我们深入学习设计模式的理由之一。</p>
<p>当然，我们还要正视学习设计模式的心态，掌握了各种设计模式，并不代表个人的设计能力与代码质量就能突飞猛进；同样在项目中，也不是生搬硬套设计模式就能解决问题的。在《 <a href="https://book.douban.com/subject/2243615/" target="_blank" rel="noopener">Head First 设计模式</a> 》一书中指出，即没有最好的模式，只有最适合问题的设计模式，学习过程与运用过程要注重融会贯通。</p>
<p>最后，学习设计模式不要局限于《 <a href="https://book.douban.com/subject/26644935/" target="_blank" rel="noopener">Android 源码设计模式</a> 》本身，您还可以搭配一些经典论文、综述或者书籍学习，以至于怀疑一个问题的正误时，多比对、多思考，以得到正确理解。</p>
<a id="more"></a>
<ul>
<li>推荐书目：<ul>
<li>《 设计模式（可复用面向对象软件的基础）》</li>
</ul>
</li>
<li>推荐项目：<ul>
<li><a href="http://www.mcdonaldland.info/2007/11/28/40/" target="_blank" rel="noopener">Design Pattern Quick Reference.Jason Mcdonald</a>：<a href="/pdf/Design_Pattern_Quick_Reference.pdf">PDF Download</a></li>
<li><a href="https://github.com/DovAmir/awesome-design-patterns#languageframework-design-patterns-mainly-gof" target="_blank" rel="noopener">Awesome Design Patterns.DovAmir.Github</a></li>
</ul>
</li>
</ul>
<h2 id="更新进程"><a href="#更新进程" class="headerlink" title="更新进程"></a>更新进程</h2><ul>
<li>2018.01.30：完成序言；</li>
<li>2018.01.31：更新第壹章；</li>
<li>2018.02.05：更新第贰章 ( 共 23 种设计模式 )；</li>
<li>2021.04.19：所有图片资源更新为 svg 格式源；</li>
</ul>
<h2 id="内容总览"><a href="#内容总览" class="headerlink" title="内容总览"></a>内容总览</h2><ul>
<li><a href="#零-本书架构">零 本书架构</a></li>
<li><a href="#壹-面向对象编程六大原则">壹 面向对象编程六大原则</a></li>
<li><a href="#贰-二十三种设计模式解析">贰 二十三种设计模式解析</a></li>
<li><a href="#叁-MVC-与-MVP-模式">叁 MVC 与 MVP 模式</a></li>
</ul>
<h2 id="零-本书架构"><a href="#零-本书架构" class="headerlink" title="零 本书架构"></a>零 本书架构</h2><h3 id="面向对象六大原则"><a href="#面向对象六大原则" class="headerlink" title="面向对象六大原则"></a>面向对象六大原则</h3><ul>
<li><code>单一职责原则</code>：优化代码第一步。即就一个类而言，应该有且仅有一个引起它变化的原因。</li>
<li><code>开闭原则</code>：让程序更稳定，更灵活。即软件中的对象（类、模块、函数等）对于扩展是开放的，但对于修改是封闭的。</li>
<li><code>里氏替换原则</code>：构建扩展性更好的系统。</li>
<li><code>依赖倒置原则</code>：让项目拥有变化能力，即依赖抽象，不依赖具体实现。</li>
<li><code>接口隔离原则</code>：系统拥有更高灵活性。</li>
<li><code>迪米特原则</code>：也称为「最少知识原则」。即一个对象应对其他对象有最少的了解。</li>
</ul>
<h3 id="二十三种设计模式"><a href="#二十三种设计模式" class="headerlink" title="二十三种设计模式"></a>二十三种设计模式</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">模式名称</th>
<th style="text-align:left">一句话描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">单例模式</td>
<td style="text-align:left">一个类只有一个实例</td>
</tr>
<tr>
<td style="text-align:left">Build 模式</td>
<td style="text-align:left">自由拓展你的项目</td>
</tr>
<tr>
<td style="text-align:left">原型模式</td>
<td style="text-align:left">使程序运行更高效</td>
</tr>
<tr>
<td style="text-align:left">工厂方法模式</td>
<td style="text-align:left">生成复杂对象</td>
</tr>
<tr>
<td style="text-align:left">抽象工厂模式</td>
<td style="text-align:left">-</td>
</tr>
<tr>
<td style="text-align:left">策略模式</td>
<td style="text-align:left">时势造英雄</td>
</tr>
<tr>
<td style="text-align:left">状态模式</td>
<td style="text-align:left">随遇则安</td>
</tr>
<tr>
<td style="text-align:left">责任链模式</td>
<td style="text-align:left">使编程更有灵活性</td>
</tr>
<tr>
<td style="text-align:left">解释器模式</td>
<td style="text-align:left">化繁为简的翻译机</td>
</tr>
<tr>
<td style="text-align:left">命令模式</td>
<td style="text-align:left">让程序畅通执行</td>
</tr>
<tr>
<td style="text-align:left">观察者模式</td>
<td style="text-align:left">解决、解耦的钥匙</td>
</tr>
<tr>
<td style="text-align:left">备忘录模式</td>
<td style="text-align:left">编程中的后悔药</td>
</tr>
<tr>
<td style="text-align:left">迭代器模式</td>
<td style="text-align:left">解决问题的第三者</td>
</tr>
<tr>
<td style="text-align:left">模块方法模式</td>
<td style="text-align:left">抓住问题的核心</td>
</tr>
<tr>
<td style="text-align:left">访问者模式</td>
<td style="text-align:left">数据结构与操作分离</td>
</tr>
<tr>
<td style="text-align:left">中介者模式</td>
<td style="text-align:left">调解者模式或调停者模式</td>
</tr>
<tr>
<td style="text-align:left">代理模式</td>
<td style="text-align:left">委托模式</td>
</tr>
<tr>
<td style="text-align:left">组合模式</td>
<td style="text-align:left">物以类聚</td>
</tr>
<tr>
<td style="text-align:left">适配器模式</td>
<td style="text-align:left">得心应手粘合剂</td>
</tr>
<tr>
<td style="text-align:left">装饰模式</td>
<td style="text-align:left">动态给对象添加额外职责</td>
</tr>
<tr>
<td style="text-align:left">享元模式</td>
<td style="text-align:left">对象共享，避免创建多对象</td>
</tr>
<tr>
<td style="text-align:left">外观模式</td>
<td style="text-align:left">统一编程接口</td>
</tr>
<tr>
<td style="text-align:left">桥接模式</td>
<td style="text-align:left">连接两地的交通枢纽</td>
</tr>
</tbody>
</table>
</div>
<h2 id="壹-面向对象编程六大原则"><a href="#壹-面向对象编程六大原则" class="headerlink" title="壹 面向对象编程六大原则"></a>壹 面向对象编程六大原则</h2><h3 id="单一职责原则"><a href="#单一职责原则" class="headerlink" title="单一职责原则"></a>单一职责原则</h3><ul>
<li>Single Responsibility Principle，SRP</li>
<li>即就一个类而言，应该仅有一个引起它变化的原因。</li>
<li>如何划分一个类，一个函数的职责？每个人的经验不同，观点看法也不同，故视具体任务而定。但它也有一些基本的知道原则：  <ul>
<li>两个完全不一样的功能就不应该放到同一个类中。</li>
<li>一个类中应该是一组相关性很高的函数、数据的封装。</li>
</ul>
</li>
</ul>
<h3 id="开闭原则"><a href="#开闭原则" class="headerlink" title="开闭原则"></a>开闭原则</h3><ul>
<li>Open Close Principle，OCP</li>
<li>即软件中的对象（类、模块、函数等）应该对于扩展是开放的，但对于修改是封闭的。</li>
<li><p>勃兰特·梅耶. 《面向对象软件构造》中提倡：</p>
<ul>
<li>新的或改变的特性应通过新建不同的类实现，新建的类可通过 <code>继承</code> 的方式来重用原类的代码。</li>
<li><p>已存在的实现类对于修改是封闭的，但新的实现类可通过 <code>覆写父类的接口</code> 应对变化。</p>
<blockquote>
<p>总结：开闭原则知道我们，当软件需变化时，应该尽量通过扩展的方式来实现变化，而不是通过修改已有的代码来实现。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h3 id="里氏替换原则"><a href="#里氏替换原则" class="headerlink" title="里氏替换原则"></a>里氏替换原则</h3><blockquote>
<p>往往开闭原则与里氏替换原则是生死相依、不离不弃的。</p>
</blockquote>
<ul>
<li>Liskov Substitution Principle，LSP</li>
<li>所有引用基类的地方必须能透明地使用其子类的对象。</li>
<li><p>举例：任何继承自 View 类的子类都可以设置给 show 方法，即里氏替换。尽管千变万化的 View 传递给 Window，Window 只管组织 View 并显示在屏幕上。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">measure</span><span class="params">(<span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 测量视图的大小</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Button</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 绘制按钮</span></span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Windows</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">show</span><span class="params">(View child)</span> </span>&#123;</span><br><span class="line">		child.draw();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="依赖倒置原则"><a href="#依赖倒置原则" class="headerlink" title="依赖倒置原则"></a>依赖倒置原则</h3><ul>
<li>Dependence Inversion Principle，DIP</li>
<li>一种特定的 <code>解耦形式</code>，使得高层次的模块不依赖于低层次的模块的实现细节。</li>
<li><p>依赖倒置原则的几个关键点：    </p>
<ul>
<li><p>高层模块不应该依赖低层模块，两者都应以来其抽象（接口或抽象类）；</p>
<blockquote>
<p>高层模块指调用端，低层模块指实现类。</p>
</blockquote>
</li>
<li><p>抽象不应该依赖细节；</p>
</li>
<li>细节应依赖抽象.</li>
</ul>
</li>
<li><p>模块间的依赖通过抽象发生，实现类之间不发生直接依赖关系。</p>
<blockquote>
<p>一句话概括：<code>面向接口编程，面向抽象编程</code></p>
</blockquote>
</li>
<li><p>举例：设计一款实现图片缓冲功能的接口，具体的缓冲实现方式、细节，根据实际情况编写。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ImageChache</span> </span>&#123;	<span class="comment">// ImageCache 缓存抽象</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Bitmap <span class="title">get</span><span class="params">(String url)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String url, Bitmap bmp)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemoryCache</span> <span class="keyword">implements</span> <span class="title">ImageCache</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 根据实际需求，再实现具体细节</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageLoader</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 图片缓存类，依赖抽象，不依赖细节</span></span><br><span class="line">	ImageCache mCache = <span class="keyword">new</span> MemoryCache();</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">displayImage</span><span class="params">(String url, ImageView imageView)</span> </span>&#123;</span><br><span class="line">		Bitmap bmp = mCache.get(url);</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">null</span> == bmp)&#123;</span><br><span class="line">			downloadImageAsync(url, imageView);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			imageView.setImageBitmap(bmp);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImageCache</span><span class="params">(ImageCache cache)</span> </span>&#123;</span><br><span class="line">		mCache = cache;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="接口隔离原则"><a href="#接口隔离原则" class="headerlink" title="接口隔离原则"></a>接口隔离原则</h3><ul>
<li>Interface Segregation Principles，ISP</li>
<li><p>类间的依赖关系应建立在最小的接口上。ISP 将非常庞大、臃肿的接口拆分成更小的和更具体的接口。IPS的目的是系统解开耦合。</p>
<blockquote>
<p>如上例 ImageLoader 中的 ImageCache，ImageLoader 只需要知道该缓存对象有存、取缓存图片的接口即可，其他一概不管。</p>
</blockquote>
</li>
</ul>
<h3 id="迪米特原则"><a href="#迪米特原则" class="headerlink" title="迪米特原则"></a>迪米特原则</h3><ul>
<li><p>一个对象应对其他对象有最少的了解、即类的内部如何实现与调用者、依赖者没关系，调用者或依赖者之需知道它需要的方法即可，其他一概不管。</p>
</li>
<li><p>图 1-1 展示了租客、中介与房间相互之间的需求关系。</p>
<p>  <img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_1-1.svg" alt="租客、中介与房间关系"></p>
  <center>图 1-1 租客、中介与房间关系</center>   

<p>  因为租客只需要房子，即把需求转达中介，对房子具体的租金、维修、签约等交由中介处理，租客不需要再了解细节。改进效果见图 1-2。</p>
<p>  <img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_1-2.svg" alt="租客、中介与房间关系"></p>
  <center>图 1-2 改进：租客、中介与房间的关系</center>  

</li>
</ul>
<h2 id="贰-二十三种设计模式解析"><a href="#贰-二十三种设计模式解析" class="headerlink" title="贰 二十三种设计模式解析"></a>贰 二十三种设计模式解析</h2><h3 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h3><h4 id="单例模式的定义"><a href="#单例模式的定义" class="headerlink" title="单例模式的定义"></a>单例模式的定义</h4><ul>
<li><p>确保某 <code>一个类只有一个实例</code> ，而且自行实例化并向整个系统提供这个实例。</p>
<blockquote>
<p><code>一个类只有一个实例</code> ：避免产生多个对象消耗过多资源，如访问 I/O 和数据库等资源。</p>
</blockquote>
</li>
</ul>
<h4 id="单例模式-UML-类图"><a href="#单例模式-UML-类图" class="headerlink" title="单例模式 UML 类图"></a>单例模式 UML 类图</h4><p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-1.svg" alt="单例模式示意图"></p>
<center>图 2-1 单例模式示意图</center> 

<ul>
<li><p>实现单例模式主要有如下几个关键点：</p>
<ul>
<li><code>构造函数</code> 不对外开放，一般设为 <code>私有</code> ；</li>
<li>通过一个 <code>静态方法</code> 或者 <code>枚举返回</code> 单例类对象；</li>
<li>确保单例类的对象有且只有一个，尤其多线程环境下；</li>
<li><p>确保单例类对象在 <code>反序列化</code> 时不会重新构建对象；</p>
<blockquote>
<p>序列化：将对象的状态信息转换为可以存储或传输的形式的过程。一般将一个对象存储至一个储存媒介，例如档案或是记亿体缓冲等。在网络传输过程中，可以是字节或是XML等格式。  </p>
<p>反序列化：而字节的或XML编码格式可以还原完全相等的对象。这个相反的过程又称为反序列化。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h4 id="单例模式的简单示例"><a href="#单例模式的简单示例" class="headerlink" title="单例模式的简单示例"></a>单例模式的简单示例</h4><p>例如一个公司只有一个 CEO，一个应用只有一个 Application 对象等。下面以公司里的 CEO 为例来简单演示，即一个公司可有几个 VP，无数个员工，但 CEO 只有一个。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 员工的基类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Staff</span> </span>&#123; </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">work</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">// 忽略执行细节</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 副总裁类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VP</span> <span class="keyword">extends</span> <span class="title">Staff</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">work</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> 		<span class="comment">// 覆写执行细节</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 饿汉单例模式：声明静态对象时已初始化</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CEO</span> <span class="keyword">extends</span> <span class="title">Staff</span> </span>&#123; <span class="comment">// 公司保证只有一个 CEO</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> CEO mCeo = <span class="keyword">new</span> CEO();</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">CEO</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CEO <span class="title">getCeo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mCeo;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">work</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 覆写执行细节</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 实际中使用：</span></span><br><span class="line"><span class="comment"> * CEO 类不能通过 new 的形式构造对象，只能通过 CEO.getCeo() 函数获取。</span></span><br><span class="line"><span class="comment"> * CEO 对象是静态对象，并在声明时已初始化，保证 CEO 对象的唯一性。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">Staff ceo1 = CEO.getCeo();	</span><br><span class="line">Staff ceo2 = CEO.getCeo();</span><br></pre></td></tr></table></figure>
<h4 id="单例模式的其他实现方式"><a href="#单例模式的其他实现方式" class="headerlink" title="单例模式的其他实现方式"></a>单例模式的其他实现方式</h4><h5 id="懒汉模式"><a href="#懒汉模式" class="headerlink" title="懒汉模式"></a>懒汉模式</h5><ul>
<li>声明一静态对象；</li>
<li>调用 getInstance() 方法初始化 ( 用时才初始化，即惰性处理机制 )</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 懒汉单例模式：用时才初始化，即惰性处理机制</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Singleton instantce;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 添加 synchronized 关键字，即 getInstance() 是一个同步方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>( <span class="keyword">null</span> == instance ) &#123;</span><br><span class="line">			instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> instance;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>懒汉单例模式的优缺点：  <ul>
<li>优点 - 使用时才实例化，一定程度上节约资源。  </li>
<li>缺点 - 每次调用 getInstance() 都进行同步，造成不必要同步开销。</li>
</ul>
</li>
</ul>
<h5 id="Double-CheckLock-DCL"><a href="#Double-CheckLock-DCL" class="headerlink" title="Double CheckLock (DCL)"></a>Double CheckLock (DCL)</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">	<span class="comment">// private static Singleton sInstance = null;</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton sInstance = <span class="keyword">null</span>; <span class="comment">// 保证 sInstance 对象每次都是从主内存存、读取。</span></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"do sth."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>( <span class="keyword">null</span> == sInstance ) &#123; <span class="comment">// 避免不必要同步</span></span><br><span class="line">			<span class="keyword">synchronized</span>(Singleton.class) &#123;</span><br><span class="line">				<span class="keyword">if</span>( <span class="keyword">null</span> == sInstance ) &#123; <span class="comment">// 此处判空操作，是因为 Java 编译器允许处理器乱序执行，具体解析见注解</span></span><br><span class="line">					sInstance = <span class="keyword">new</span> Singleton();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> sInstance;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>DCL 又称「丑陋的优化」？  </p>
<p>DCL 虽一定程度解决了资源消耗，多余同步、线程安全等问题，但某种情况下还是会出现失效问题 ( 双重检查锁定(DCL) )，即称「丑陋的优化」。</p>
<ul>
<li><p>线程A，执行 <code>sInstance = new Singleton();</code>，编译器会编译成多条汇编指令，具体汇编指令的分工为：  </p>
<ul>
<li>Step.01 给 Singleton 实例分配内存；  </li>
<li>Step.02 调用 Singleton() 的构造函数；  </li>
<li>Step.03 将 sInstance 对象指向分配的内存空间；  </li>
</ul>
</li>
<li><p>然而 Java 编译器允许处理器乱序执行，即有「1-2-3」或「1-3-2」的执行顺序。</p>
</li>
<li>若执行「1-3-2」的顺序，这样会使 DCL 的优化失效，即第三步执行完毕，sInstance 非空，线程B取走 sInstance。再使用时就会报错。</li>
</ul>
<h5 id="静态内部类单例模式"><a href="#静态内部类单例模式" class="headerlink" title="静态内部类单例模式"></a>静态内部类单例模式</h5><p>​<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> SingletonHolder.sInstance;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span> </span>&#123; <span class="comment">// 静态内部类</span></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton sInstance = <span class="keyword">new</span> Singleton();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>第一次加载 Singleton 的 getInstance() 方法才会使 sInstance 被初始化。因此，第一次调用 getInstance() 方法会导致虚拟机加载 SingletonHolder 类.</p>
<blockquote>
<p>内部类是延时加载的，只会在第一次使用时加载，不使用不加载。这样，即保证了线程安全，又保证单例对象唯一性，同时也延迟单例的实例化。</p>
</blockquote>
<h5 id="枚举单例"><a href="#枚举单例" class="headerlink" title="枚举单例"></a>枚举单例</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 默认枚举实例的创建是线程安全的，并且在任何情况下它都是一个单例。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> SingletonEnum &#123;</span><br><span class="line">	INSTANCE;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"do sth."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li><p>不管以哪种形式实现单例模式，它们的核心原理都是将 <code>构造函数私有化</code> ，并通过 <code>静态方法获取一个唯一的实例</code> 。</p>
<blockquote>
<p>获取实例的过程须保证线程安全，防止反序列化导致重新生成实例对象等。</p>
</blockquote>
</li>
<li><p>选择哪种实现形式取决项目本身，如是否是复杂的并发环境、JDK 版本是否过低、单例对象的资源消耗等。</p>
</li>
<li>单例模式的优缺点<ul>
<li>优点<br>1) 只生成一个实例，减少系统的性能开销；<br>2) 当一对象的产生需要较多资源时，如读取配置、产生其他依赖对象时，可通过应用启动时直接产生一个单例对象，永久驻留内存。  </li>
<li>缺点<br>1) 单例模式一般没有接口，扩展性难；<br>2) 单例对象若持有 Context，那么很容易引发内存泄漏，此时需注意传递给单例对象的 Context 应该是 <code>Application.Context</code> 。</li>
</ul>
</li>
</ul>
<h3 id="Bulider-模式"><a href="#Bulider-模式" class="headerlink" title="Bulider 模式"></a>Bulider 模式</h3><h4 id="Bulider-模式的定义"><a href="#Bulider-模式的定义" class="headerlink" title="Bulider 模式的定义"></a>Bulider 模式的定义</h4><ul>
<li>创建型设计模式。</li>
<li>将一个复杂对象的 <code>构建</code> 与它的 <code>表示</code> 分离，使得同样的构建过程可以创建不同的表示。</li>
<li>Builder 模式是一步步创建一个复杂对象的，它允许用户在不知内部构建细节的情况下，可以更精细地控制对象的构造流程。</li>
</ul>
<h4 id="Builder-模式的使用场景"><a href="#Builder-模式的使用场景" class="headerlink" title="Builder 模式的使用场景"></a>Builder 模式的使用场景</h4><ul>
<li>产品类非常复杂，或产品类中调用顺序不同产生不同的作用，这时需要使用 Builder 模式。</li>
<li>初始化一个对象特别复杂，如参数多，且很多参数都具有默认值。</li>
</ul>
<h4 id="Builder-模式的UML类图"><a href="#Builder-模式的UML类图" class="headerlink" title="Builder 模式的UML类图"></a>Builder 模式的UML类图</h4><p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-2.svg" alt="Builder模式示意图"></p>
<center>图 2-2 Builder 模式示意图</center> 

<h4 id="Builder-模式的简单实现"><a href="#Builder-模式的简单实现" class="headerlink" title="Builder 模式的简单实现"></a>Builder 模式的简单实现</h4><p>便于理解，本示例的 UML 类图见图 2-3。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-3.svg" alt="计算机组装过程"></p>
<center>图 2-3 计算机组装过程</center> 

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 下述程序以计算机组装过程简化为：构建主机，设置操作系统，设置显示器。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算机抽象类，即 Product 角色</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Computer</span> </span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> String mBoard;</span><br><span class="line"> 	<span class="keyword">protected</span> String mDisplay;</span><br><span class="line"> 	<span class="keyword">protected</span> String mOS;</span><br><span class="line"> 	<span class="function"><span class="keyword">protected</span> <span class="title">Computer</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"> 	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBoard</span><span class="params">(String board)</span> </span>&#123; <span class="comment">// 设置 CPU 核心数</span></span><br><span class="line"> 		mBoard = board;</span><br><span class="line"> 	&#125;</span><br><span class="line"> 	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDisplay</span><span class="params">(String display)</span> </span>&#123; <span class="comment">// 设置内存</span></span><br><span class="line"> 		mDisplay = display;</span><br><span class="line"> 	&#125;</span><br><span class="line"> 	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">setOS</span><span class="params">()</span></span>;</span><br><span class="line"> 	<span class="meta">@override</span></span><br><span class="line"> 	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> 		<span class="keyword">return</span> <span class="string">"Computer[...]"</span>;</span><br><span class="line"> 	&#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的 Computer 类 - MacBook</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Macbook</span> <span class="keyword">extends</span> <span class="title">Computer</span> </span>&#123;</span><br><span class="line"> 	<span class="function"><span class="keyword">protected</span> <span class="title">Macbook</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"> 	<span class="meta">@override</span></span><br><span class="line"> 	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOS</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> 		mOS = <span class="string">"MAC OSX 10.10"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象 Builder 类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line"> 	<span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line"> 		<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">buildBoard</span><span class="params">(String board)</span></span>; <span class="comment">// 设置主机</span></span><br><span class="line"> 		<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">buildOS</span><span class="params">()</span></span>; <span class="comment">// 设置操作系统</span></span><br><span class="line"> 		<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">buildDisplay</span><span class="params">(String display)</span></span>; <span class="comment">// 设置显示器</span></span><br><span class="line"> 		<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Computer <span class="title">create</span><span class="params">()</span></span>; <span class="comment">// 创建 Computer</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的 Builder 类 - MacbookBuilder</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MacbookBuilder</span> <span class="keyword">extends</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line"> 	<span class="keyword">private</span> Computer mComputer = <span class="keyword">new</span> Macbook();</span><br><span class="line"> 	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildBoard</span><span class="params">(String board)</span></span>&#123;</span><br><span class="line"> 		mComputer.setBoard(board);</span><br><span class="line"> 	&#125;</span><br><span class="line"> 	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildDisplay</span><span class="params">(String display)</span> </span>&#123;</span><br><span class="line"> 		mComputer.setDisplay(display);</span><br><span class="line"> 	&#125;</span><br><span class="line"> 	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildOS</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> 		mComputer.setOS();</span><br><span class="line"> 	&#125;</span><br><span class="line"> 	<span class="function"><span class="keyword">public</span> Computer <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> 		<span class="keyword">return</span> mComputer;</span><br><span class="line"> 	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Director 类，负责构造 Computer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Director</span> </span>&#123;</span><br><span class="line"> 	Builder mBuilder = <span class="keyword">null</span>;</span><br><span class="line"> 	<span class="function"><span class="keyword">public</span> <span class="title">Director</span><span class="params">(Builder builder)</span> </span>&#123;</span><br><span class="line"> 		mBuilder = builder;</span><br><span class="line"> 	&#125;</span><br><span class="line"> 	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">construct</span><span class="params">(String board, String display)</span> </span>&#123;</span><br><span class="line"> 		mBuilder.buildBoard(board);</span><br><span class="line"> 		mBuilder.buildDisplay(display);</span><br><span class="line">		mBuilder.buildOS();</span><br><span class="line"> 	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Builder builder = <span class="keyword">new</span> MacbookBuilder(); <span class="comment">// 构造器</span></span><br><span class="line"> 		Director pcDirector = <span class="keyword">new</span> Director(builder); <span class="comment">// Director</span></span><br><span class="line"> 		<span class="comment">// 封装构建过程</span></span><br><span class="line"> 		pcDirector.construct(<span class="string">"英特尔主板"</span>, <span class="string">"Retina 显示器"</span>);</span><br><span class="line"> 		System.out.println(<span class="string">"Computer Info: "</span> + builder.create().toString());</span><br><span class="line"> 	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Builder-模式实战"><a href="#Builder-模式实战" class="headerlink" title="Builder 模式实战"></a>Builder 模式实战</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 知名图片加载库：Universal-Image-Loader</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">ImageLoaderConfiguration config = <span class="keyword">new</span> ImageLoaderConfiguration</span><br><span class="line">.Builder(context) <span class="comment">// 用户只能通过 Builder 对象构建 ImageLoaderConfiguration 对象，这就是构建和表示相分离</span></span><br><span class="line">.threadPriority(Thread_NORM_PRIORITY_2)</span><br><span class="line">.denyCacheImageMultipleSizesInMemory()</span><br><span class="line">.discCacheFileNameGenerator( <span class="keyword">new</span> MD5FileNameGenerator() )</span><br><span class="line">.tasksProcessingOrder(QueueProcessingType.LIFO)</span><br><span class="line">.bulider();</span><br><span class="line"></span><br><span class="line">ImageLoader.getInstance().init(config);</span><br></pre></td></tr></table></figure>
<h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><ul>
<li>Builder 模式，通过作为配置类的构建器将配置的构建和表示分离开来，同时也将配置从目标类中隔离出来，避免过多的 Setter 方法暴露在目标类当中。</li>
<li>Builder 模式的优缺点<ul>
<li>优点<br>1) 良好的封装性，不必知道产品内部组成的细节；<br>2) 建造者独立，易于扩展。</li>
<li>缺点<br>1) 产生多余 Builder 对象及 Director 对象，消耗内存。</li>
</ul>
</li>
</ul>
<h3 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h3><h4 id="原型模式的定义"><a href="#原型模式的定义" class="headerlink" title="原型模式的定义"></a>原型模式的定义</h4><ul>
<li>创建型的模式。</li>
<li>定义：用原型实例指定创建对象的种类，并通过拷贝这些原型创建新的对象。<ul>
<li>原型拥有样板实例，可克隆内部属性一致的对象。</li>
<li>原型模式多用于创建复杂的或构建耗时的实例，即复制一个已经存在的实例可使程序运行更高效。</li>
</ul>
</li>
</ul>
<h4 id="原型模式的使用场景"><a href="#原型模式的使用场景" class="headerlink" title="原型模式的使用场景"></a>原型模式的使用场景</h4><ul>
<li>类初始化需消耗非常多的资源 ( 数据、硬件资源等 )。</li>
<li>通过 new 产生一个对象需要非常繁琐的数据准备或访问权限。</li>
<li>一个对象需提供其他对象访问，且各调用者可能都需修改其值时，可考虑用原型模式或拷贝多个对象以供调用者使用，即 <code>保护性拷贝</code> 。</li>
</ul>
<h4 id="原型模式的-UML-类图"><a href="#原型模式的-UML-类图" class="headerlink" title="原型模式的 UML 类图"></a>原型模式的 UML 类图</h4><p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-4.svg" alt="Builder模式示意图"></p>
<center>图 2-4 原型模式的 UML 类图</center> 

<h4 id="原型模式的简单实现"><a href="#原型模式的简单实现" class="headerlink" title="原型模式的简单实现"></a>原型模式的简单实现</h4><p>便于理解，本示例的 UML 类图见图 2-5。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-5.svg" alt="WordDocument文档编辑器"></p>
<center>图 2-5 WordDocument 文档编辑器</center> 

<p>​<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * WordDocument 具有文字、图片编辑功能的简单文档处理类。且为保护源文件，其可在克隆对象上作内容修改。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordDocument</span> <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</span><br><span class="line">	<span class="comment">// WordDocument 扮演 ConcretePrototype 角色</span></span><br><span class="line">	<span class="comment">// Cloneable 扮演 Prototype 角色</span></span><br><span class="line">	<span class="keyword">private</span> String mText; <span class="comment">// 文本</span></span><br><span class="line">	<span class="keyword">private</span> ArrayList&lt;String&gt; mImages = <span class="keyword">new</span> ArrayList&lt;String&gt;(); <span class="comment">// 图片名列表</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">WordDocument</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 忽略实现细节</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> WordDocument <span class="title">clone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			WordDocument doc = (WordDocument) <span class="keyword">super</span>.clone();</span><br><span class="line">			doc.mText = <span class="keyword">this</span>.mText;</span><br><span class="line">			doc.mImages = <span class="keyword">this</span>.mImages;</span><br><span class="line">			<span class="keyword">return</span> doc;</span><br><span class="line">		&#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getText</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mText;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setText</span><span class="params">(String mText)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.mText = mText;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getImage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mImages;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addImage</span><span class="params">(String img)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.mImages.add(img);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showDocument</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Text:"</span> + mText);</span><br><span class="line">		System.out.println(<span class="string">"Images List:"</span>);</span><br><span class="line">		<span class="keyword">for</span>(String imgName:mImages) &#123;</span><br><span class="line">			System.out.println(<span class="string">"image name:"</span> + imgName);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		WordDocument originDoc = <span class="keyword">new</span> WordDocument();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">/* Partion A start */</span></span><br><span class="line">		originDoc.setText(<span class="string">"This is a Aircle"</span>);</span><br><span class="line">		originDoc.addImage(<span class="string">"Image A"</span>);</span><br><span class="line">		<span class="comment">/* Partion A end */</span></span><br><span class="line">		originDoc.showDocument();</span><br><span class="line">		</span><br><span class="line">		WordDocument secDoc = originDoc.clone();</span><br><span class="line">		secDoc.showDocument();</span><br><span class="line">		secDoc.setText(<span class="string">"This is a Paper"</span>); <span class="comment">// 只是改变了引用指向</span></span><br><span class="line">		secDoc.showDocument();</span><br><span class="line">		originDoc.showDocument(); <span class="comment">// 还是输出 Partion A 的结果</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>注：通过 clone() 拷贝对象时并不会执行构造函数。如果在构造函数中需要一些特殊的初始化操作类型，在使用 Cloneable 实现拷贝时，注意构造函数不会执行的问题。</p>
</blockquote>
<h4 id="浅拷贝和深拷贝"><a href="#浅拷贝和深拷贝" class="headerlink" title="浅拷贝和深拷贝"></a>浅拷贝和深拷贝</h4><ul>
<li>浅拷贝：上述例子实际上只是一个浅拷贝，也称 <code>影子拷贝</code>，即只是副本文档引用原始文档的字段。</li>
</ul>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-6.svg" alt="浅拷贝示意图"></p>
<center>图 2-6 浅拷贝示意图</center> 

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">secDoc.setText(<span class="string">"This is a Paper."</span>);</span><br><span class="line">secDoc.addImage(<span class="string">"Image B"</span>);</span><br><span class="line">secDoc.showDocument(); <span class="comment">// Case 1</span></span><br><span class="line">originDoc.showDocument(); <span class="comment">// Case 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Case 1，2 都增加了图片 “Image B”，原因是 secDoc 只是单纯指向了 this.mImages</span></span><br></pre></td></tr></table></figure>
<ul>
<li>深拷贝：为了解决浅拷贝所带来的“问题” ( 视具体问题而定 )，引入深入拷贝。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> WordDocument <span class="title">clone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		WordDocument doc = (WordDocument) <span class="keyword">super</span>.clone();</span><br><span class="line">		doc.mText = <span class="keyword">this</span>.mText;</span><br><span class="line">		<span class="comment">// doc.mImages 指向 mImages 的一份拷贝，而不是 this.mImages 本身</span></span><br><span class="line">		doc.mImages = (ArrayList&lt;String&gt;) <span class="keyword">this</span>.mImages.clone();		</span><br><span class="line">		<span class="keyword">return</span> doc;</span><br><span class="line">	&#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="原型模式实战"><a href="#原型模式实战" class="headerlink" title="原型模式实战"></a>原型模式实战</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 在线用户信息修改 (需登录后修改用户信息)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户实体类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> age;</span><br><span class="line">	<span class="keyword">public</span> String name;</span><br><span class="line">	<span class="keyword">public</span> String phoneNum;</span><br><span class="line">	<span class="keyword">public</span> Adress,adress;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"User[age=...]"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录接口</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> interface <span class="title">Login</span> <span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	<span class="keyword">void</span> login()</span></span>;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginImpl</span> <span class="keyword">implements</span> <span class="title">Login</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		User loginedUser = <span class="keyword">new</span> User(); <span class="comment">// 登录服务器，获取用户信息</span></span><br><span class="line">		loginedUser.age = <span class="number">12</span>;</span><br><span class="line">		loginedUser.name = <span class="string">"Mr.Sample"</span>;</span><br><span class="line">		loginedUser.address = <span class="keyword">new</span> Address(<span class="string">"BeiJing"</span>, <span class="string">"HaiDing"</span>, <span class="string">"Garden Rd"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 登录完成后，将用户信息设置到 Session:</span></span><br><span class="line">		LoginSession.getLoginSession()</span><br><span class="line">			.setLoginedUser(loginedUser)</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 登录 Session</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginSession</span> </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> LoginSession sLoginSession = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">private</span> User longinedUser; <span class="comment">// 已登录用户</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">LoginSession</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> LoginSession <span class="title">getLoginSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">null</span> == sLoginSession) &#123;</span><br><span class="line">	 		sLoginSession = <span class="keyword">new</span> LoginSession();</span><br><span class="line">	 	&#125;</span><br><span class="line">	 	<span class="keyword">return</span> sLoginSession;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 包级私有：即不加任何修饰符，该模式(默认访问模式)下，只允许在同一包中进行访问</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setLoginedUser</span><span class="params">(User user)</span> </span>&#123; <span class="comment">// 设置已登录用户信息，不对外开放</span></span><br><span class="line">		loginedUser = user;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getLoginedUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> loginedUser;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Partion A : 以下是实际执行部分，可能在不同包的某个类下执行 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取已登录的 User 对象</span></span><br><span class="line">User newUser = LoginSession.getLoginSession().getLoginedUser();</span><br><span class="line"><span class="comment">// 更新用户信息</span></span><br><span class="line">newUser.address = <span class="keyword">new</span> Adress(<span class="string">"BeiJing"</span>, <span class="string">"ChaoYang"</span>, <span class="string">"DaWang Rd"</span>);</span><br></pre></td></tr></table></figure>
<p>用户信息的更新，限定于与 LoginSession 类在同一包下才能执行，即 Partion A 的操作，使这样的限定失效。我们可作以下改进：</p>
<ul>
<li>在 User 类中实现 Cloneable 接口。</li>
<li>在 LoginSession 中将 getLoginedUser() 改为 <code>return loginedUser.clone()</code> ，即在任何地方调用，获得的都是用户拷贝的对象，修改只是作用于拷贝的对象。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现 Cloneable 接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123; <span class="comment">// 用户实体类</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> age;</span><br><span class="line">	<span class="keyword">public</span> String name;</span><br><span class="line">	<span class="keyword">public</span> String phoneNum;</span><br><span class="line">	<span class="keyword">public</span> Adress,adress;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">clone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		User user = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			user = (User) <span class="keyword">super</span>.clone();</span><br><span class="line">		&#125; <span class="keyword">catch</span>(CLoneNotSupportedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"User[age=...]"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginSession</span> </span>&#123; </span><br><span class="line">	<span class="comment">// 即管在任何地方调用，获得的都是用户拷贝的对象</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">getLoginedUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> loginedUser.clone();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h4><ul>
<li>原型模式的优缺点<ul>
<li>优点 - 原型模式是在内存中二进制的拷贝，比 new 一个对象性能更优。</li>
<li>缺点 - 内存中拷贝，构造函数是不会执行的。</li>
</ul>
</li>
</ul>
<h3 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h3><h4 id="工厂方法模式的定义"><a href="#工厂方法模式的定义" class="headerlink" title="工厂方法模式的定义"></a>工厂方法模式的定义</h4><ul>
<li>创建型设计模式。</li>
<li>定义一个用于创建对象的接口，让子类决定实例化哪个类。</li>
</ul>
<h4 id="工厂方法模式的使用场景"><a href="#工厂方法模式的使用场景" class="headerlink" title="工厂方法模式的使用场景"></a>工厂方法模式的使用场景</h4><ul>
<li>复杂对象的创建，而用 New 就可以完成创建的对象则不必使用工厂方法了。</li>
</ul>
<h4 id="工厂方法模式的-UML-类图"><a href="#工厂方法模式的-UML-类图" class="headerlink" title="工厂方法模式的 UML 类图"></a>工厂方法模式的 UML 类图</h4><p>工厂方法模式的 UML 如图 2-7 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-7.svg" alt="浅拷贝示意图"></p>
<center>图 2-7 工厂方法模式 UML 类图</center> 

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteProductA</span> <span class="keyword">extends</span> <span class="title">Product</span> </span>&#123; <span class="comment">// 具体产品 A</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"我是具体的产品A."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteProductB</span> <span class="keyword">extends</span> <span class="title">Product</span> </span>&#123; <span class="comment">// 具体产品 B</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"我是具体的产品B."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Factory</span> </span>&#123; <span class="comment">// 抽象工厂类</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * @return 具体的产品对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	 <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Product <span class="title">createProduct</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteFactory</span> <span class="keyword">extends</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Product <span class="title">createProduct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 返回具体产品 A 或者具体产品 B</span></span><br><span class="line">		<span class="comment">// return new ConcreteProductA();</span></span><br><span class="line">		<span class="comment">// return new ConcreteProductB();</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Factory factory = <span class="keyword">new</span> ConcreteFactory();</span><br><span class="line">		Product p = factory.createProduct();</span><br><span class="line">		p.method();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>另外，我们可以利用反射的方式实现多工厂方法模式，具体见下述代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment"> 	* 具体生产什么由子类去实现</span></span><br><span class="line"><span class="comment"> 	* @param clz 产品对象类类型</span></span><br><span class="line"><span class="comment"> 	* @return 具体的产品对象</span></span><br><span class="line"><span class="comment"> 	*/</span> 	</span><br><span class="line"> 	<span class="keyword">public</span> <span class="keyword">abstract</span>&lt;T extends Product&gt; <span class="function">T <span class="title">createProduct</span><span class="params">(class&lt;T&gt; clz)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteFactory</span> <span class="keyword">extends</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> &lt;T extends Product&gt; <span class="function">T <span class="title">createProduct</span><span class="params">(class&lt;T&gt; clz)</span> </span>&#123;</span><br><span class="line">		Product p = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			p = (Product) <span class="class"><span class="keyword">class</span>.<span class="title">forName</span>(<span class="title">clz</span>.<span class="title">getName</span>()).<span class="title">newInstance</span>()</span>;</span><br><span class="line">		&#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> (T) p;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端中实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Factory factory = <span class="keyword">new</span> ConcreteFactory();</span><br><span class="line">		Product p = factory.createProduct(ConcreteProductA.class);</span><br><span class="line">		p.method();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="工厂方法模式的简单实现"><a href="#工厂方法模式的简单实现" class="headerlink" title="工厂方法模式的简单实现"></a>工厂方法模式的简单实现</h4><p>某汽车厂主要就是组装某款 SUV 车型，比如 Q3、Q5、Q7，对于这类车型来说，内部结构差异并不是很大，因此一条生产线足以应付 3 种车型，对于该类生产线可提供一抽象类定义。</p>
<p>便于理解，本示例的 UML 类图见图 2-8。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-8.svg" alt="某工厂生产某车型的工厂方法"></p>
<center>图 2-8 某工厂生产某车型的工厂方法</center> 

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AudiFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 某工厂生产某种车型的工厂方法</span></span><br><span class="line"><span class="comment">	 * @param clz 具体的 SUV 型号类型</span></span><br><span class="line"><span class="comment">	 * @return 具体型号的 SUV 车对象</span></span><br><span class="line"><span class="comment"> 	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">abstract</span>&lt;T extends AudiCar&gt; <span class="function">T <span class="title">createAudiCar</span><span class="params">(class&lt;T&gt; clz)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AudiCarFactory</span> <span class="keyword">extends</span> <span class="title">AudiFactory</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> &lt;T extends AudiCar&gt; <span class="function">T <span class="title">createProduct</span><span class="params">(class&lt;T&gt; clz)</span> </span>&#123;</span><br><span class="line">		Product p = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			p = (AudiCar) <span class="class"><span class="keyword">class</span>.<span class="title">forName</span>(<span class="title">clz</span>.<span class="title">getName</span>())</span></span><br><span class="line"><span class="class">				.<span class="title">newInstance</span>()</span>; </span><br><span class="line">		&#125; <span class="keyword">catch</span>() &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> (T) p;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 汽车的抽象产品类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AudiCar</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">drive</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">selfNavigation</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体车型：Q3</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AudiQ3</span> <span class="title">exntends</span> <span class="title">AudiCar</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Q3 Launched!"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">selfNavigation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Q3 starts a auto-navigation!"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		AudiFactory factory = <span class="keyword">new</span> AudiFactory();</span><br><span class="line">		AudiQ3 audiQ3 = factory.createProduct(AudiQ3.class);</span><br><span class="line">		audiQ3.dirve();</span><br><span class="line">		audiQ3.selfNavigation();	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="工厂方法模式的实战"><a href="#工厂方法模式的实战" class="headerlink" title="工厂方法模式的实战"></a>工厂方法模式的实战</h4><p>Android 数据持久化有很多方式，如 SharedPreferences (XML)、SQLite (关系数据库)。对数据操作的方法无非就是增、删、改、查，若我们将每种数据储存的方式作为一个产品类，在抽象产品类中定义对数据操作的方法，即我们宏观层面把握操作的逻辑，具体的实现逻辑由储存数据的方式决定。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">IOHandler</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String id, String name)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(String id)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String id, String name)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">query</span><span class="params">(String id)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> <span class="keyword">extends</span> <span class="title">IOHandler</span> </span>&#123; <span class="comment">// 普通文件存储</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String id, String name)</span> </span>&#123;</span><br><span class="line">		<span class="comment">/* 业务逻辑 */</span> &#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">		<span class="comment">/* 业务逻辑 */</span> &#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String id, String name)</span> </span>&#123;</span><br><span class="line">		<span class="comment">/* 业务逻辑 */</span> &#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">query</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">		<span class="comment">/* 业务逻辑 */</span> </span><br><span class="line">		<span class="keyword">return</span> <span class="string">"AigeStudio"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XMLHandler</span> <span class="keyword">extends</span> <span class="title">IOHandler</span> </span>&#123; <span class="comment">// XML 文存储</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String id, String name)</span> </span>&#123;</span><br><span class="line">		<span class="comment">/* 业务逻辑 */</span> &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">		<span class="comment">/* 业务逻辑 */</span> &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String id, String name)</span> </span>&#123;</span><br><span class="line">		<span class="comment">/* 业务逻辑 */</span> &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">query</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">		<span class="comment">/* 业务逻辑 */</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">"SMBrother"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBHandler</span> <span class="keyword">extends</span> <span class="title">IOHandler</span> </span>&#123; <span class="comment">// SQLite 数据库存储</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String id, String name)</span> </span>&#123;</span><br><span class="line">		<span class="comment">/* 业务逻辑 */</span> &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">		<span class="comment">/* 业务逻辑 */</span> &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String id, String name)</span> </span>&#123;</span><br><span class="line">		<span class="comment">/* 业务逻辑 */</span> &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">query</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">		<span class="comment">/* 业务逻辑 */</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Android"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IOFactory</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * 获取 IO 处理者</span></span><br><span class="line"><span class="comment">	 * @param clz IOHandler 类型的类类型</span></span><br><span class="line"><span class="comment">	 * @return IOHandler 对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	 </span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends IOHandler&gt; <span class="function">T <span class="title">getIOHandler</span><span class="params">(class&lt;T&gt; clz)</span> </span>&#123;</span><br><span class="line">		IOHandler handler = <span class="keyword">null</span>;</span><br><span class="line">	 	<span class="keyword">try</span> &#123;</span><br><span class="line">	 		handler = (IOHandler) <span class="class"><span class="keyword">class</span>.<span class="title">forName</span>(<span class="title">clz</span>.<span class="title">getName</span>())</span></span><br><span class="line"><span class="class">	 			.<span class="title">newInstance</span>()</span>;</span><br><span class="line">	 	&#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">	 		e.printStackTrace();</span><br><span class="line">	 	&#125;</span><br><span class="line">		<span class="keyword">return</span> (T) handler;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FactoryActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">	<span class="meta">@override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle saveInstanceState)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.onCreate(saveInstanceState);</span><br><span class="line">		setContentView(R.layout.activity_factory);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 获取显示查询内容的 TextView 对象</span></span><br><span class="line">		<span class="keyword">final</span> TextView tvContent = (TextView) <span class="keyword">this</span>.findViewById(R.id.factory_content_tv);</span><br><span class="line">		<span class="comment">// 获取查询普通文件数据的按钮对象，并设置监听</span></span><br><span class="line">		Button btnFile = (Button) <span class="keyword">this</span>.findViewById(R.id.factory_file_btn);</span><br><span class="line">		btnFile.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">				IOHandler handler = IOFactory.getIOHanHandler(FileHandler.class);</span><br><span class="line">				Log.d(<span class="string">"AigeStudio"</span>, handler.query(<span class="string">"4455645646"</span>));</span><br><span class="line">				tvContent.setText(handler.query(<span class="string">"4455645646"</span>));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h3><h4 id="抽象工厂模式的定义"><a href="#抽象工厂模式的定义" class="headerlink" title="抽象工厂模式的定义"></a>抽象工厂模式的定义</h4><ul>
<li>创建型设计模式。</li>
<li>为创建一组相关或者是相互依赖的对象 提供一个 <code>接口</code> ，而不需要指定它们的具体类。</li>
</ul>
<h4 id="抽象工厂模式的使用场景"><a href="#抽象工厂模式的使用场景" class="headerlink" title="抽象工厂模式的使用场景"></a>抽象工厂模式的使用场景</h4><p>一个对象族有相同约束时可以使用抽象工厂模式。如：<br>Android、iOS、Window Phone 下都有短信软件和拨号软件，两者属于软件范畴，但由于操作系统平台不一样，其代码实现细节也是有差异的，则我们可考虑使用抽象工厂方法模式去产生不同平台下的同款软件。</p>
<h4 id="抽象工厂模式的-UML-类图"><a href="#抽象工厂模式的-UML-类图" class="headerlink" title="抽象工厂模式的 UML 类图"></a>抽象工厂模式的 UML 类图</h4><p>抽象工厂方法模式的 UML 如图 2-9 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-9.svg" alt="抽象工厂方法模式UML类图"></p>
<center>图 2-9 抽象工厂方法模式 UML 类图</center> 

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractProductA</span> </span>&#123; <span class="comment">// 抽象产品类 A</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> abstractvoid <span class="title">method</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractProductB</span> </span>&#123; <span class="comment">// 抽象产品类 B</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> abstractvoid <span class="title">method</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteProducxtA1</span> <span class="keyword">extends</span> <span class="title">AbstractProductA</span> </span>&#123; <span class="comment">// 具体产品类 A1</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"具体产品 A1 的方法."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteProducxtA2</span> <span class="keyword">extends</span> <span class="title">AbstractProductA</span> </span>&#123; <span class="comment">// 具体产品类 A2</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"具体产品 A2 的方法."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteProducxtB1</span> <span class="keyword">extends</span> <span class="title">AbstractProductB</span> </span>&#123; <span class="comment">// 具体产品类 B1</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> 	    System.out.println(<span class="string">"具体产品 B1 的方法."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteProducxtB2</span> <span class="keyword">extends</span> <span class="title">AbstractProductB</span> </span>&#123; <span class="comment">// 具体产品类 B2</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"具体产品 B2 的方法."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractFactory</span> </span>&#123; <span class="comment">// 抽象工厂类</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建产品 A 的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 产品 A 的对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> AbstractProductA <span class="title">createProductA</span><span class="params">()</span></span>;</span><br><span class="line"> 	 </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建产品 B 的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 产品 B的对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> AbstractProductB <span class="title">createProductB</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteFactory1</span> <span class="keyword">extends</span> <span class="title">AbstractFactory</span> </span>&#123; <span class="comment">// 具体工厂类1</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> AbstractProductA <span class="title">createProductA1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ConcreteProductA1();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> AbstractProductB <span class="title">createProductB1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ConcreteProductB1();</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteFactory2</span> <span class="keyword">extends</span> <span class="title">AbstractFactory</span> </span>&#123; <span class="comment">// 具体工厂类2</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> AbstractProductA <span class="title">createProductA2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ConcreteProductA2();</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> AbstractProductB <span class="title">createProductB2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ConcreteProductB2();</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="抽象工厂模式的简单实现"><a href="#抽象工厂模式的简单实现" class="headerlink" title="抽象工厂模式的简单实现"></a>抽象工厂模式的简单实现</h4><p>在简单工厂模式的简单实现中，我门以车厂生产汽车为例。虽 Q3、Q5、Q7 同为一车系，但三者之间的零部件产别却很大，如 Q3、Q7 当中，Q3 装配的是国产发动机，普通轮胎和普通制动系统；Q7 则装配的是进口发动机，全尺寸越野轮胎和制动性能极好的制动系统。</p>
<p>即同为一系列车，大家共有部件有发动机、轮胎和制动系统等，由于具体的部件品质不同，装配的细节又不同。故我们可将抽象工厂模式应用当中，化繁为简。具体的架构如图 2-10 的 UML 类图所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-10.svg" alt="车厂生产同系列汽车的抽象工厂模式"></p>
<center>图 2-10 车厂生产同系列汽车的抽象工厂模式</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CarFactory</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 生产轮胎</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> ITire 轮胎</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"> 	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> ITire <span class="title">createTire</span><span class="params">()</span></span>;</span><br><span class="line"> 	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 生产发动机</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> IEngine 发动机</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"> 	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> IEngine <span class="title">createEngine</span><span class="params">()</span></span>;</span><br><span class="line"> 	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 生产制动系统</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> IBrake 制动系统</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> IBrake <span class="title">createBrake</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ITire</span> </span>&#123; <span class="comment">// 轮胎</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">tire</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NormalTire</span> <span class="keyword">implements</span> <span class="title">ITire</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tire</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"普通轮胎"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SUVTire</span> <span class="keyword">implements</span> <span class="title">ITire</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tire</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"越野轮胎"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> interface <span class="title">IEngine</span><span class="params">()</span> </span>&#123; <span class="comment">// 发动机</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">engine</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DomesticEngine</span> <span class="keyword">implements</span> <span class="title">IEngine</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">engine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"国产发动机"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImportEngine</span> <span class="keyword">implements</span> <span class="title">IEngine</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">engine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"进口发动机"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IBrake</span> </span>&#123; <span class="comment">// 制动系统</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">brake</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NormalBrake</span> <span class="keyword">implements</span> <span class="title">IBrake</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">brake</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"普通制动"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SeniorBrake</span> <span class="keyword">implements</span> <span class="title">IBrake</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">brake</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"高级制动"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Q3Factory</span> <span class="keyword">extends</span> <span class="title">CarFactory</span> </span>&#123; <span class="comment">// Q3工厂类</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ITire <span class="title">createTire</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> NormalTire();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> IEngine <span class="title">createEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="function">Domestic <span class="title">Engine</span><span class="params">()</span></span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> IBrake <span class="title">createBrake</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> NormalBrake();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Q3Factory</span> <span class="keyword">extends</span> <span class="title">CarFactory</span> </span>&#123; <span class="comment">// Q3工厂类</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ITire <span class="title">createTire</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> NormalTire();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> IEngine <span class="title">createEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> DomesticEngine();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> IBrake <span class="title">createBrake</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> NormalBrake();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Q7Factory</span> <span class="keyword">extends</span> <span class="title">CarFactory</span> </span>&#123; <span class="comment">// Q7 工厂类</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> ITire <span class="title">createTire</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SUVTire();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> IEngine <span class="title">createEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ImportEngine();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@verride</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> IBrake <span class="title">createBrake</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> SeniorBrake();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 构造一个生产 Q3 的工厂</span></span><br><span class="line">		CarFactory factoryQ3 = <span class="keyword">new</span> Q3Factory();</span><br><span class="line">		factoryQ3.createTire().tire();</span><br><span class="line">		factoryQ3.createEngine().engine();</span><br><span class="line">		factoryQ3.createBrake().brake();</span><br><span class="line"> 		</span><br><span class="line">		<span class="comment">// 构造一个生产 Q7 的工厂</span></span><br><span class="line">		CarFactory factoryQ7 = <span class="keyword">new</span> Q7Factory();</span><br><span class="line">		factoryQ7.createTire().tire();</span><br><span class="line">		factoryQ7.createEngine().engine();</span><br><span class="line">		factoryQ7.createBrake().brake();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h4><ul>
<li>抽象工厂方法模式的优缺点<ul>
<li>优点 - 分离接口与实现，即客户端使用抽象工厂的创建对象，客户端不知具体实现是谁，客户端只是面向产品的接口编程而已，使其从具体的产品实现中解耦。</li>
<li>缺点<br>1) 类文件的爆炸性增加。<br>2) 不太容易扩展新的产品类，因为每当增加一个产品类，就需修改抽象工厂，故所有具体工厂类均会被修改。</li>
</ul>
</li>
</ul>
<h3 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h3><h4 id="策略模式的介绍"><a href="#策略模式的介绍" class="headerlink" title="策略模式的介绍"></a>策略模式的介绍</h4><p>实现某功能，可以有多种算法或策略选择，例如排序算法，有插入排序、归并排序、冒泡排序等。</p>
<blockquote>
<p>思考：多种排序算法，可以写在一个类中，一个方法对应一种具体排序。但是缺点也是很明显，即臃肿；维护成本高，且容易引发错误；每增加一种排序需修改封装类的源码。  </p>
<p>改进：提供一个统一接口，不同的算法或策略有不同的实现类。</p>
</blockquote>
<h4 id="策略模式的使用场景"><a href="#策略模式的使用场景" class="headerlink" title="策略模式的使用场景"></a>策略模式的使用场景</h4><ul>
<li>针对同类问题的多种处理方式，仅仅是 <code>具体行为</code> 有差别。</li>
<li>需要安全地封装多种 <code>同类型</code> 的操作。</li>
<li><p>出现同一抽象类，有多个子类，而又需使用 <code>if-else</code> 或 <code>switch-case</code>  来选择具体子类。</p>
<blockquote>
<p>但缺点也明显，耦合性高；代码臃肿难维护。</p>
</blockquote>
</li>
</ul>
<h4 id="策略模式的-UML-类图"><a href="#策略模式的-UML-类图" class="headerlink" title="策略模式的 UML 类图"></a>策略模式的 UML 类图</h4><p>策略模式的 UML 如图 2-11 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-11.svg" alt="策略模式UML类图"></p>
<center>图 2-11 策略模式 UML 类图</center> 

<h4 id="策略模式的简单实现"><a href="#策略模式的简单实现" class="headerlink" title="策略模式的简单实现"></a>策略模式的简单实现</h4><p>下面以在北京乘坐公共交通工具的费用计算来演示一简单示例。在 2014 年 12 月 20 号之后，北京提高公交价格，不在是单一票价制，而是分段计费。显然，公交车和地铁的价格计算方式是不一样的。但是，我们的示例中是需要计算乘不同出行工具的成本，故我们采用策略模式进行设计、编码。</p>
<p>便于理解，本示例的 UML 类图如图 2-12 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-12.svg" alt="交通方案UML类图"></p>
<center>图 2-12 交通方案的 UML 类图</center> 

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CalculateStragety</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 按距离来计算价格</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> km 公里</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 返回价格</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">calculatePrice</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BusStragety</span> <span class="keyword">implements</span> <span class="title">CalculateStragety</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calculatePrice</span><span class="params">(<span class="keyword">int</span> km)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 公交车价格计算策略</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SubwayStragety</span> <span class="keyword">implements</span> <span class="title">CalculateStragety</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calculatePrice</span><span class="params">(<span class="keyword">int</span> km)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 地铁价格计算策略</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现: 出行价格计算器</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TranficCalculator</span> </span>&#123;</span><br><span class="line">	CalculateStrategy mStrategy = <span class="keyword">null</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		TranficCalculator calculator = <span class="keyword">new</span> TranficCalculator();</span><br><span class="line">		<span class="comment">// 设置计算策略</span></span><br><span class="line">		calculator.setStrategy( <span class="keyword">new</span> BusStrategy() );</span><br><span class="line">		<span class="comment">// 计算价格</span></span><br><span class="line">		System.out.println(<span class="string">"公交车乘16公里的价格: "</span> + calculator.calculatePrice(<span class="number">16</span>));</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStrategy</span><span class="params">(CalculateStrategy mStrategy)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.mStrategy = mStrategy;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calculatePrice</span><span class="params">(<span class="keyword">int</span> km)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mStrategy.calculatePrice(km);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="策略模式的实战应用"><a href="#策略模式的实战应用" class="headerlink" title="策略模式的实战应用"></a>策略模式的实战应用</h4><p>对于默认情况下，ImageLoader 会按照先后顺序加载图片，但在实际算法当中，相反顺序加载图片也是有可能的，即反序列加载图片。当然加载方式可看作多种策略，共同的目标是实现加载图片。图 2-13 是 ImageLoader 的 UML 类图。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-13.svg" alt="ImageLoader的UML类图"></p>
<center>图 2-13 ImageLoader 的 UML 类图</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LoadPolicy</span> </span>&#123; <span class="comment">// 加载策略接口</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(BitmapRequest request1, BitmapRequest request2)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 顺序加载策略</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SerialPolicy</span> <span class="keyword">implements</span> <span class="title">LoadPolicy</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(BitmapRequest request1, BitmapRequest request2)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 按照添加到队列的序列号顺序来执行</span></span><br><span class="line">		<span class="keyword">return</span> request1.serialNum - request2.serialNum;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 逆序加载策略，即从最后加入队列的请求进行加载</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">pulbic <span class="class"><span class="keyword">class</span> <span class="title">ReversePolicy</span> <span class="keyword">implements</span> <span class="title">LoadPolicy</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(BitmapRequest request1, BitmapRequest request2)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 注意: Bitmap 请求要先执行最晚加入队列的请求，ImageLoader 的策略 </span></span><br><span class="line">	<span class="keyword">return</span> request2.serialNum - request1.serialNum;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 因每个请求都有一序列号，序列号以递增形式增加，越晚加入队列的请求序列号越大。</span></span><br><span class="line"><span class="comment"> * 而请求队列是优先级队列，因此我们需要在图片加载请求类中实现 Comparable 接口，以实现对这些请求的排序处理。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BitmapRequest</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">BitmapRequest</span>&gt; </span>&#123; <span class="comment">// 加载策略</span></span><br><span class="line">	LoadPolicy mLoadPolicy = <span class="keyword">new</span> SerialPolicy();</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(BitmapRequest another)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 委托给 LoadPolicy 进行处理，实现按照策略模式</span></span><br><span class="line">		<span class="keyword">return</span> mLoadPolicy.compare(<span class="keyword">this</span>, another);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户在配置 ImageLoader 时可以设置加载策略，</span></span><br><span class="line"><span class="comment"> * 这个策略会被设置给每个图片加载请求对象，具体如下：</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">displayImage</span><span class="params">(<span class="keyword">final</span> ImageView imageView, <span class="keyword">final</span> String uri, <span class="keyword">final</span> DisplayConfig config, <span class="keyword">final</span> ImageListener listener)</span> </span>&#123;</span><br><span class="line">	BitmapRequest request = <span class="keyword">new</span> BitmapRequest(imageView, uri, config, listener);</span><br><span class="line"> 	</span><br><span class="line">	<span class="comment">// 加载的配置对象，如果没有设置则使用 ImageLoader 的配置</span></span><br><span class="line">	request.displayConfig = request.displayConfig != <span class="keyword">null</span> ?</span><br><span class="line">		request.displayConfig : mConfig.displayConfig;</span><br><span class="line"> 	<span class="comment">// 设置加载策略</span></span><br><span class="line"> 	request.setLoadPolicy(mConfig.loadPolicy);</span><br><span class="line"> 	<span class="comment">// 添加到队列中</span></span><br><span class="line">	mImageQueue.addRequest(request);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h4><ul>
<li>策略模式的优缺点<ul>
<li>优点<br>1) 很好地演示了开闭原则，也就定义了抽象。<br>2) 耦合度相对较低，扩展方法。</li>
<li>缺点 - 随着策略的增加，子类会变得繁多。</li>
</ul>
</li>
</ul>
<h3 id="状态模式"><a href="#状态模式" class="headerlink" title="状态模式"></a>状态模式</h3><ul>
<li>状态模式和策略模式和结构几乎一样，但它们的目的本质完全相异。<ul>
<li>状态模式：行为是平行的，不可替换的。</li>
<li>策略模式：行为彼此独立，可相互替换。</li>
</ul>
</li>
</ul>
<h4 id="状态模式的定义"><a href="#状态模式的定义" class="headerlink" title="状态模式的定义"></a>状态模式的定义</h4><p>当一个对象的内在状态改变时允许改变其行为，这个对象看起来像是改变了其类。</p>
<h4 id="状态模式的使用场景"><a href="#状态模式的使用场景" class="headerlink" title="状态模式的使用场景"></a>状态模式的使用场景</h4><p>代码中包含大量与对象状态有关的条件语句。如操作中含有庞大的多分支语句 ( <code>if-else</code> 或 <code>switch-case</code> )，且这些分支依赖与该对象的状态。</p>
<p>若使用状态模式来优化架构，即每一条件分支放于独立的类。</p>
<h4 id="状态模式的-UML-类图"><a href="#状态模式的-UML-类图" class="headerlink" title="状态模式的 UML 类图"></a>状态模式的 UML 类图</h4><p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-14.svg" alt="状态模式的UML类图"></p>
<center>图 2-14 状态模式的 UML 类图</center> 

<h4 id="状态模式的简单示例"><a href="#状态模式的简单示例" class="headerlink" title="状态模式的简单示例"></a>状态模式的简单示例</h4><p>下面以电视遥控器为例演示状态模式的实现。便于理解，本示例的 UML 类图如图 2-15 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-15.svg" alt="电视遥控器UML类图"></p>
<center>图 2-15 电视遥控器 UML 类图</center> 

<h4 id="状态模式实战"><a href="#状态模式实战" class="headerlink" title="状态模式实战"></a>状态模式实战</h4><p>在新浪微博中，用户在未登录的情况下点击转发按钮，此时会先让用户登录，然后再执行转发操作；如果已登录的情况下，那么用户输入转发的内容后就可以直接进行操作。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-16.svg" alt="新浪微博用户状态管理UML类图"></p>
<center>图 2-16 新浪微博用户状态管理 UML 类图</center> 

<h4 id="总结-5"><a href="#总结-5" class="headerlink" title="总结"></a>总结</h4><ul>
<li>状态模式的优缺点<ul>
<li>优点 - 将所有与一个特定的状态相关的行为都放入一个状态对象中，它提供了一个更好的方法来组织与特定状态相关的代码，将繁琐的状态判断转为结构清晰的状态类族。</li>
<li>缺点 - 必然增加系统类和对象的个数。</li>
</ul>
</li>
</ul>
<h3 id="责任链模式"><a href="#责任链模式" class="headerlink" title="责任链模式"></a>责任链模式</h3><h4 id="责任链模式的定义"><a href="#责任链模式的定义" class="headerlink" title="责任链模式的定义"></a>责任链模式的定义</h4><ul>
<li>行为型设计模式。</li>
<li>通俗定义：每个节点看作一对象，每一对象拥有不同的处理逻辑，将一请求从链式的首端发出，沿着链的路径一次传递每个节点对象，直至有对象处理这个请求为止。</li>
<li>标准定义：使多个对象都有机会处理请求，从而避免了请求的发送者和接受者之间的耦合关系。将这些对象连成链，并沿着这条链传递该请求，直至有对象处理它为止。</li>
</ul>
<h4 id="责任链模式的使用场景"><a href="#责任链模式的使用场景" class="headerlink" title="责任链模式的使用场景"></a>责任链模式的使用场景</h4><ul>
<li>多个对象可以处理同一请求，但具体由哪个对象处理则在运行时动态决定。</li>
<li>在请求处理者不明确的情况下向多个对象中的其一提交一个请求。</li>
<li>需要动态指定一组对象处理请求。</li>
</ul>
<h4 id="责任链模式的-UML-类图"><a href="#责任链模式的-UML-类图" class="headerlink" title="责任链模式的 UML 类图"></a>责任链模式的 UML 类图</h4><p>责任链模式的 UML 类图如图 2-17 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-17.svg" alt="责任链模式UML类图"></p>
<center>图 2-17 责任链模式 UML 类图</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象处理者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> Handler successor; <span class="comment">// 下一节点的处理者</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 请求处理</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> condition 请求条件</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">handleRequest</span><span class="params">(String condition)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的处理者1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteHandler1</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleRequest</span><span class="params">(String condition)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(condition.equals(<span class="string">"ConcreteHandler1"</span>)) &#123;</span><br><span class="line">			System.out.println(<span class="string">"ConcreteHandler1 handled"</span>);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			successor.handleRequest(condition);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的处理者2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteHandler1</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleRequest</span><span class="params">(String condition)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(condition.equals(<span class="string">"ConcreteHandler2"</span>)) &#123;</span><br><span class="line">			System.out.println(<span class="string">"ConcreteHandler2 handled"</span>);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			successor.handleRequest(condition);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 构造一个 ConcreteHandler1 对象</span></span><br><span class="line">		ConcreteHandler1 handler1 = <span class="keyword">new</span> ConcreteHandler1();</span><br><span class="line">		<span class="comment">// 构造一个 ConcreteHandler2 对象</span></span><br><span class="line">		ConcreteHandler2 handler1 = <span class="keyword">new</span> ConcreteHandler2();</span><br><span class="line">		<span class="comment">// 设置 handler1 的下一个节点</span></span><br><span class="line">		handler1.successor = handler2;</span><br><span class="line">		<span class="comment">// 设置 handler2 的下一个节点</span></span><br><span class="line">		handler2.successor = handler1;</span><br><span class="line">		<span class="comment">// 处理请求</span></span><br><span class="line">		handler1.handleRequest(<span class="string">"ConcreteHandler2"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="责任链模式的简单实现"><a href="#责任链模式的简单实现" class="headerlink" title="责任链模式的简单实现"></a>责任链模式的简单实现</h4><p>在公司中报销费用中，审批的流程其实就是一个类似责任链的实例。例如，小明是请求的发起者，而处理者有组长、部门主管、经理和老板，对于不同额度的报销费用需要不同级的处理者审批，准确地说，每一类人代表这条链上的一个节点。</p>
<p>例如小民是请求的发起者，而老板则是处于链条顶端的类，小民从链的底端开始发出一个申请报账的请求，首先由组长处理该请求，组长比对后发现自己权限不够于是将该请求转发给位于链中下一个节点的主管，主管比对后发现自己权限不足又将该请求转发给经理，经理也基于同样的原因将请求转发给老板，这样层层转达直至请求被处理。即至始至终小民关心的是报账结果，而不用在乎处理者是谁。责任链模式在这里很好地将请求的发起者与处理者解耦。</p>
<p>便于理解，本示例的 UML 类图如图 2-18 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-18.svg" alt="报账审核机制UML类图"></p>
<center>图 2-18 报账审核机制 UML 类图</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象领导者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Leader</span> </span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> Leader nextHandler; <span class="comment">// 上一级领导处理者</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 处理报账请求</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> money 能批复的报账额度</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">handleRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>( money &lt; limit() ) &#123;</span><br><span class="line">			handle(money);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span>( <span class="keyword">null</span> != nextHandlder ) &#123;</span><br><span class="line">				nextHandler.handleRequest(money);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 自身能批复的额度权限</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 额度</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">limit</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 处理报账行为</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> money 具体金额</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">pulbic <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(<span class="keyword">int</span> money)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GroupLeader</span> <span class="keyword">extends</span> <span class="title">Leader</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">limit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1000</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(<span class="keyword">int</span> money)</span> </span>&#123;</span><br><span class="line">		Ststen.out.println(<span class="string">"组长批复报销"</span> + money + <span class="string">"元"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Director</span> <span class="keyword">extends</span> <span class="title">Leader</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">limit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">5000</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(<span class="keyword">int</span> money)</span> </span>&#123;</span><br><span class="line">		Ststen.out.println(<span class="string">"主管批复报销"</span> + money + <span class="string">"元"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Manager</span> <span class="keyword">extends</span> <span class="title">Leader</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">limit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">10000</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(<span class="keyword">int</span> money)</span> </span>&#123;</span><br><span class="line">		Ststen.out.println(<span class="string">"经理批复报销"</span> + money + <span class="string">"元"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Boss</span> <span class="keyword">extends</span> <span class="title">Leader</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">limit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> Integer.MAX_VALUE;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(<span class="keyword">int</span> money)</span> </span>&#123;</span><br><span class="line">		Ststen.out.println(<span class="string">"老板批复报销"</span> + money + <span class="string">"元"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 小民从组长开始发起请求申请报账</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XiaoMin</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 构造各个领导对象</span></span><br><span class="line">		GroupLeader groupLeader = <span class="keyword">new</span> GroupLeader();</span><br><span class="line">		Director director = <span class="keyword">new</span> Director();</span><br><span class="line">		Manager manager = <span class="keyword">new</span> Manager();</span><br><span class="line">		Boss boss = <span class="keyword">new</span> Boss();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 设置上一级领导处理者对象</span></span><br><span class="line">		groupLeader.nextHandler = director;</span><br><span class="line">		director.nextHandler = manager;</span><br><span class="line">		manager.nextHandler = boss;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 发起报账申请</span></span><br><span class="line">		groupLeader.handleRequest(<span class="number">50000</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="责任链模式实战"><a href="#责任链模式实战" class="headerlink" title="责任链模式实战"></a>责任链模式实战</h4><p>Android 中我们可以借鉴责任链模式的思想来优化 BroadcastReceiver 使之成为一个全局的责任链处理者。</p>
<p>我们知道 Broadcast 可以被分为两种:</p>
<ul>
<li>Normal Broadcast：普通广播，异步广播，发出时可被所有的接收者收到。</li>
<li>Ordered Broadcast：有序广播，依优先级依次传播的，直到有接收者将其终止或所有接收者都不终止它。</li>
</ul>
<p>有序广播这一特性与我们的责任链模式很相近，通过它可实现一种全局的责任链事件处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体的实现思路是，通过 Intent 的限制值来限定最终的广播权归谁所有</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FirstReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 获取 Intent 中附加的限制值</span></span><br><span class="line">		<span class="keyword">int</span> limit = intent.getIntExtra(<span class="string">"limit"</span>, -<span class="number">1001</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 如果限定值等于 1000 则处理，否则继续转发给下一个 Receiver</span></span><br><span class="line">		<span class="keyword">if</span>( <span class="number">1000</span> == limit ) &#123;</span><br><span class="line">			<span class="comment">// 获取 Intent 中附加的字符串消息并 Toast</span></span><br><span class="line">			String msg = intent.getStringExtra(<span class="string">"msg"</span>);</span><br><span class="line">			Toast.makeText(context, msg, Toast.LENGTH_SHORT).show();		</span><br><span class="line">			<span class="comment">// 终止广播</span></span><br><span class="line">			abortBroadcast();</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// 添加信息发送给下一个 Receiver</span></span><br><span class="line">			Bundle b = <span class="keyword">new</span> Bundle();</span><br><span class="line">			b.putString(<span class="string">"new"</span>, <span class="string">"Message from FirstReceiver"</span>);</span><br><span class="line">			setResultExtras(b);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 获取 Intent 中附加的限制值</span></span><br><span class="line">		<span class="keyword">int</span> limit = intent.getIntExtra(<span class="string">"limit"</span>, -<span class="number">1001</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 如果限定值等于 100 则处理，否则继续转发给下一个 Receiver</span></span><br><span class="line">		<span class="keyword">if</span>( <span class="number">100</span> == limit ) &#123;</span><br><span class="line">			<span class="comment">// 获取 Intent 中附加的字符串消息</span></span><br><span class="line">			String msg = intent.getStringExtra(<span class="string">"msg"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 获取上一个 Receiver 增加的消息</span></span><br><span class="line">			Bundle b = getResultExtras(<span class="keyword">true</span>);</span><br><span class="line">			String str = b.getString(<span class="string">"new"</span>);</span><br><span class="line">			</span><br><span class="line">			Toast.makeText(context, msg + str, Toast.LENGTH_SHORT).show();		</span><br><span class="line">			<span class="comment">// 终止广播</span></span><br><span class="line">			abortBroadcast();</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// 添加信息发送给下一个 Receiver</span></span><br><span class="line">			Bundle b = <span class="keyword">new</span> Bundle();</span><br><span class="line">			b.putString(<span class="string">"new"</span>, <span class="string">"Message from FirstReceiver"</span>);</span><br><span class="line">			setResultExtras(b);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThirdReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 获取 Intent 中附加的限制值</span></span><br><span class="line">		<span class="keyword">int</span> limit = intent.getIntExtra(<span class="string">"limit"</span>, -<span class="number">1001</span>);</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 如果限定值等于 10 则处理，否则继续转发给下一个 Receiver</span></span><br><span class="line">		<span class="keyword">if</span>( <span class="number">10</span> == limit ) &#123;</span><br><span class="line">			<span class="comment">// 获取 Intent 中附加的字符串消息</span></span><br><span class="line">			String msg = intent.getStringExtra(<span class="string">"msg"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// 获取上一个 Receiver 增加的消息</span></span><br><span class="line">			Bundle b = getResultExtras(<span class="keyword">true</span>);</span><br><span class="line">			String str = b.getString(<span class="string">"new"</span>);</span><br><span class="line">			</span><br><span class="line">			Toast.makeText(context, msg + str, Toast.LENGTH_SHORT).show();		</span><br><span class="line">			<span class="comment">// 终止广播</span></span><br><span class="line">			abortBroadcast();</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// 添加信息发送给下一个 Receiver</span></span><br><span class="line">			Bundle b = <span class="keyword">new</span> Bundle();</span><br><span class="line">			b.putString(<span class="string">"new"</span>, <span class="string">"Message from FirstReceiver"</span>);</span><br><span class="line">			setResultExtras(b);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">		setContentView(R.layout.activity_order);</span><br><span class="line">		</span><br><span class="line">		Button btnSend = (Button) findViewById(R.id.order_send_btn);</span><br><span class="line">		btnSend.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">			<span class="meta">@Override</span></span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">				Intent i = <span class="keyword">new</span> Intent();</span><br><span class="line">				i.setAction(<span class="string">"com.aigestudio.action.ORDER_BROADCAST"</span>);</span><br><span class="line">				i.putExtra(<span class="string">"limit"</span>, <span class="number">100</span>);</span><br><span class="line">				i.putExtra(<span class="string">"msg"</span>, <span class="string">"Message from OrderActivity"</span>);</span><br><span class="line">				sendOrderedBroadcast(i, <span class="keyword">null</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里我们设置 limit = 100，即只有 SecondReceiver 才会处理它。</span></span><br></pre></td></tr></table></figure>
<h4 id="总结-6"><a href="#总结-6" class="headerlink" title="总结"></a>总结</h4><ul>
<li>责任链模式的优缺点<ul>
<li>优点 - 对请求者和处理者关系解耦，提高代码灵活性。</li>
<li>缺点 - 递归调用。特别是处理者太多，那么遍历定会影响性能。</li>
</ul>
</li>
</ul>
<h3 id="解释器模式"><a href="#解释器模式" class="headerlink" title="解释器模式"></a>解释器模式</h3><h4 id="解释器模式的定义"><a href="#解释器模式的定义" class="headerlink" title="解释器模式的定义"></a>解释器模式的定义</h4><ul>
<li>行为型设计模式。</li>
<li>概念：给定一个语言，定义它的 <code>文法</code> 的一种表示，并定义一个解释器，该解释器使用该表示来解释语言中的句子。</li>
<li>文法：例如我们熟悉的「主谓宾结构」，通过下述短语举例，我们可把短语抽象看作：I am a/an [noun.]</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>主语</th>
<th>谓语</th>
<th>宾语</th>
</tr>
</thead>
<tbody>
<tr>
<td>I</td>
<td>am</td>
<td>a designer</td>
</tr>
<tr>
<td>I</td>
<td>am</td>
<td>a teacher</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p>再举例：假设有如以 ab 开头 ef 结尾，中间排列 N(N&gt;=0) 个 cd 的字符串。</p>
<blockquote>
<p>abcdcd…cdef</p>
</blockquote>
<p>在计算机科学中，我们将上述字符串中的 “a”、“b”、“c”、“d”、“e” 和 “f” 这 6 个字符称为一种形式语言的 <code>字符表</code>。</p>
<p>而这些字符组成的集合，如 “abcdcd…cdef” 这样由字符表构成的字符串则称为 <code>形式语言</code>。注意这里的语言不是文法。</p>
<p>假设定义一个符号 S，从符号 S 出发推导上述字符串，即可得到如下推导式：</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">S ::= abA*ef  </span><br><span class="line">A ::= cd</span><br></pre></td></tr></table></figure>
<ul>
<li><code>::==</code> 称为推导；  </li>
<li><code>*</code> 表示闭包，上述推导式中意思是，符号 A 可以有 0 或 N 个重复；  </li>
<li>非终结符号：<code>S</code> 和 <code>A</code> 则称非终结符号，即它们能推导出式子右边的表达式；  </li>
<li>终结符号：”pqmn”，“ab”，“ef”，即无法再推导；</li>
</ul>
<h4 id="解释器模式的使用场景"><a href="#解释器模式的使用场景" class="headerlink" title="解释器模式的使用场景"></a>解释器模式的使用场景</h4><ul>
<li><p>某个 <code>简单语言</code> 需要解释执行且可将该语言中的语句表示为 <code>抽象语法树</code> 时可考虑使用解释器模式。</p>
<blockquote>
<p>如：有非终结符号 p+q+m-n，即该数学表示式可表示为一棵抽象语法树。如图 2-19 所示。</p>
</blockquote>
</li>
</ul>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-19.svg" alt="p+q+m-n的抽象语法树"></p>
<center>图 2-19 p+q+m-n 的抽象语法树</center>

<ul>
<li><p>某些特定的领域出现不断重复的问题时，可将该领域的问题转化为一种语法规则下的语句，然后构建解释器来解释该语句。</p>
<blockquote>
<p>英文字母的大小写转换；阿拉伯数字转为中文的数字…<br>即它们都是一个个终结符，不同的只是具体内容。</p>
</blockquote>
</li>
</ul>
<h4 id="解释器模式的-UML-类图"><a href="#解释器模式的-UML-类图" class="headerlink" title="解释器模式的 UML 类图"></a>解释器模式的 UML 类图</h4><p>解释器模式的 UML 类图如图 2-20 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-20.svg" alt="解释器模式UML类图"></p>
<center>图 2-20 解释器模式 UML 类图</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractExpression</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 抽象的解析方法</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> ctx 上下文环境对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">interpret</span><span class="params">(Context ctx)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 终结符表达式</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TerminalExpression</span> <span class="keyword">extends</span> <span class="title">AbstractExpression</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">interpret</span><span class="params">(Context ctx)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 实现文法中与终结符有关的解释操作</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 非终结符表达式</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NonterminalExpression</span> <span class="keyword">extends</span> <span class="title">AbstractExpression</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">interpret</span><span class="params">(Context ctx)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 实现文法中与非终结符有关的解释操作</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 包含解释器之外的全局信息</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 根据文法对特定句子构建抽象语法树后解释</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="总结-7"><a href="#总结-7" class="headerlink" title="总结"></a>总结</h4><ul>
<li>解释模式的优缺点<ul>
<li>优点 - 灵活的扩展性，即我们想对文法规则进行扩展延伸时，只需增加相应的非终结符解释器，并在构建抽象语法树时，使用到新增的解释器对象进行具体的解释即可。</li>
<li>缺点<br>1) 对于每一条文法对应至少一个解释器，其会生成大量的类，导致后期维护困难；<br>2) 构建其抽象语法树会显得异常繁琐，甚至可能出现需要构建多棵抽象语法树的情况。</li>
</ul>
</li>
</ul>
<h3 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h3><h4 id="命令模式的定义"><a href="#命令模式的定义" class="headerlink" title="命令模式的定义"></a>命令模式的定义</h4><ul>
<li>行为型设计模式。</li>
<li>介绍：将一系列的方法调用封装，用户只需调用一个方法执行，那么所有这些被封装的方法就会被挨个执行调用。</li>
<li>定义：<ul>
<li>将一个请求封装成一个对象，从而让用户使用不同的请求把客户端参数化。</li>
<li>对请求排队或者记录请求日志，以及支持可撤销的操作。</li>
</ul>
</li>
</ul>
<h4 id="命令模式的使用场景"><a href="#命令模式的使用场景" class="headerlink" title="命令模式的使用场景"></a>命令模式的使用场景</h4><ul>
<li>需要抽象出待执行的动作，然后以参数的形式提供处理 (类似过程设计中的回调机制)。</li>
<li>在不同的时刻指定、排列和执行请求。一个命令对象可以有与初始请求无关的生存期。</li>
<li>需要支持取消操作。</li>
<li>需要支持事务操作。</li>
<li>支持修改日志功能，若系统崩溃，这些修改可重做一遍。</li>
</ul>
<h4 id="命令模式的-UML-类图"><a href="#命令模式的-UML-类图" class="headerlink" title="命令模式的 UML 类图"></a>命令模式的 UML 类图</h4><p>命令模式的 UML 类图如图 2-21 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-21.svg" alt="命令模式UML类图"></p>
<center>图 2-21 命令模式 UML 类图</center>

<p><strong>Receiver：接收者角色</strong><br>该类负责具体实施或执行一个请求，通俗地说，执行具体逻辑的角色。</p>
<p><strong>Command：命令角色</strong><br>定义所有具体命令类的抽象接口。</p>
<p><strong>ConcreteCommand：具体命令角色</strong><br>该类实现了 Command 接口，在 execute() 方法中调用接收者角色的相关方法，在接收者和命令执行的具体行为之间加以弱耦和。</p>
<p><strong>Invoker：请求者角色</strong><br>该类的职责就是调用命令对象执行具体的请求，相关的方法我们称为行动方法。</p>
<p>这里其实大家可以看到，命令模式的应用其实可用一句话概述，就是将行为调用者与实现者解耦。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收者类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Receiver</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 真正执行具体命令逻辑的方法</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"执行具体操作"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象命令接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 执行具体操作的命令</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体命令类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteCommand</span> <span class="keyword">implements</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Receiver receiver; <span class="comment">// 持有一个对接受者对象的引用</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ConcreteCommand</span><span class="params">(Receiver receiver)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.receiver = receiver;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 调用接收者的相关方法来执行具体逻辑</span></span><br><span class="line">		receiver.action();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求者类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Invoker</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Command command; <span class="comment">// 持有一个对应命令对象的引用</span></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Invoker</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.command = command;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 调用具体命令对象的相关方法，执行具体命令</span></span><br><span class="line">		command.execute();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 构造一个接受者对象</span></span><br><span class="line">		Receiver receiver = <span class="keyword">new</span> Receiver();</span><br><span class="line">		<span class="comment">// 根据接收者对象构造一个命令对象</span></span><br><span class="line">		Command command = <span class="keyword">new</span> ConcreteCommand(receiver);</span><br><span class="line">		<span class="comment">// 根据具体的对象构造请求者对象</span></span><br><span class="line">		Invoker invoker = <span class="keyword">new</span> Invoker(command);</span><br><span class="line">		<span class="comment">// 执行请求方法</span></span><br><span class="line">		invoker.action();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="命令模式的简单实现"><a href="#命令模式的简单实现" class="headerlink" title="命令模式的简单实现"></a>命令模式的简单实现</h4><p>这里以古老的俄罗斯方块游戏为例，在命令模式下如何操控俄罗斯方块变换。游戏中含有 4 个按钮，即上下左右。设定玩游戏的人相当于我们的客户端，游戏上的 4 个按钮相当于请求者，而执行具体按钮命令的逻辑方法可看作命令角色。</p>
<p>便于理解，本示例的 UML 类图如图 2-22 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-22.svg" alt="命令模式实现俄罗斯方块游戏"></p>
<center>图 2-22 命令模式实现俄罗斯方块游戏</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收者角色</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TetrisMachine</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toLeft</span><span class="params">()</span> </span>&#123; <span class="comment">// 真正处理 “向左” 操作的逻辑代码</span></span><br><span class="line">		System.out.println(“向左”);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toRight</span><span class="params">()</span> </span>&#123; <span class="comment">// 真正处理 “向右” 操作的逻辑代码</span></span><br><span class="line">		System.out.println(“向右”);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fastToBottom</span><span class="params">()</span> </span>&#123; <span class="comment">// 真正处理 “快速落下” 操作的逻辑代码</span></span><br><span class="line">		System.out.println(“快速落下”);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transform</span><span class="params">()</span> </span>&#123; <span class="comment">// 真正处理 “改变形状” 操作的逻辑代码</span></span><br><span class="line">		System.out.println(“改变形状”);</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 命令者抽象</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 命令执行方法</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体命令者：向左移的命令类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LeftCommand</span> <span class="keyword">implements</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 持有一个接收者俄罗斯方块游戏对象的引用</span></span><br><span class="line">	<span class="keyword">private</span> TetrisMachine machine;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">LeftCommand</span><span class="params">(TetriMachine machine)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.machine = machine;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 调用游戏机里的具体方法执行操作</span></span><br><span class="line">		machine.toLeft();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体命令者：向右移的命令类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RightCommand</span> <span class="keyword">implements</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 持有一个接收者俄罗斯方块游戏对象的引用</span></span><br><span class="line">	<span class="keyword">private</span> TetrisMachine machine;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">RightCommand</span><span class="params">(TetriMachine machine)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.machine = machine;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 调用游戏机里的具体方法执行操作</span></span><br><span class="line">		machine.toRight();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体命令者：快速落下的命令类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FallCommand</span> <span class="keyword">implements</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 持有一个接收者俄罗斯方块游戏对象的引用</span></span><br><span class="line">	<span class="keyword">private</span> TetrisMachine machine;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">FallCommand</span><span class="params">(TetriMachine machine)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.machine = machine;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 调用游戏机里的具体方法执行操作</span></span><br><span class="line">		machine.fastToBottom();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体命令者：改变形状的命令类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransformCommand</span> <span class="keyword">implements</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 持有一个接收者俄罗斯方块游戏对象的引用</span></span><br><span class="line">	<span class="keyword">private</span> TetrisMachine machine;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">TransformCommand</span><span class="params">(TetriMachine machine)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.machine = machine;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 调用游戏机里的具体方法执行操作</span></span><br><span class="line">		machine.transform();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求者类：命令由按钮发起</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Buttons</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> LeftCommand leftCommand; <span class="comment">// 向左移动的命令对象引用</span></span><br><span class="line">	<span class="keyword">private</span> RightCommand rightCommand; <span class="comment">// 向右移动的命令对象引用</span></span><br><span class="line">	<span class="keyword">private</span> FallCommand fallCommand; <span class="comment">// 快速落下的命令对象引用</span></span><br><span class="line">	<span class="keyword">private</span> TransformCommand transformCommand; <span class="comment">// 变换形状的命令对象引用</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置向左移动的命令对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> leftCommand 向左移动的命令对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLeftCommand</span><span class="params">(LeftCommand leftCommand)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.leftCommand = leftCommand;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置向右移动的命令对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> rightCommand 向右移动的命令对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRightCommand</span><span class="params">(RightCommand rightCommand)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.rightCommand = rightCommand;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置快速落下的命令对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> fallCommand 向左移动的命令对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFallCommand</span><span class="params">(FallCommand fallCommand)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.fallCommand = fallCommand;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置变换形状的命令对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> transformCommand 向左移动的命令对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTransformCommand</span><span class="params">(TransformCommand transformCommand)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.leftCommand = leftCommand;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toLeft</span><span class="params">()</span> </span>&#123; <span class="comment">// 按下按钮向左移动</span></span><br><span class="line">		leftCommand.execute();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toRight</span><span class="params">()</span> </span>&#123; <span class="comment">// 按下按钮向右移动</span></span><br><span class="line">		rightCommand.execute();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fall</span><span class="params">()</span> </span>&#123; <span class="comment">// 按下按钮快速落下</span></span><br><span class="line">		fallCommand.execute();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transform</span><span class="params">()</span> </span>&#123; <span class="comment">// 按下按钮改变形状</span></span><br><span class="line">		transformCommand.execute();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Player</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 首先要有俄罗斯方块游戏</span></span><br><span class="line">		TetrisMachine machine = <span class="keyword">new</span> TetrisMachine();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 根据游戏我们构造 4 种命令</span></span><br><span class="line">		LeftCommand leftCommand = <span class="keyword">new</span> LeftCommand(machine);</span><br><span class="line">		RightCommand rightCommand = <span class="keyword">new</span> RightCommand(machine);</span><br><span class="line">		FallCommand fallCommand = <span class="keyword">new</span> FallCommand(machine);</span><br><span class="line">		TransformCommand transformCommand = <span class="keyword">new</span> TransformCommand(machine);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 按钮可以执行不同的命令</span></span><br><span class="line">		Buttons buttons = <span class="keyword">new</span> Buttons();</span><br><span class="line">		buttons.setLeftCommand(leftCommand);</span><br><span class="line">		buttons.setRightCommand(rightCommand);</span><br><span class="line">		buttons.setFallCommand(fallCommand);</span><br><span class="line">		buttons.setTransformCommand(transformCommand);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 具体按下哪个按钮玩家决定</span></span><br><span class="line">		buttons.toLeft();</span><br><span class="line">		buttons.toRight();</span><br><span class="line">		buttons.fall();</span><br><span class="line">		buttons.transform();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于大部分开发者来说，更愿意接受的形式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">TetrisMachine machine = <span class="keyword">new</span> TetrisMachine();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现怎样的控制方式，直接调用相关函数</span></span><br><span class="line"><span class="comment">// machine.toLeft();</span></span><br><span class="line"><span class="comment">// machine.toRight();</span></span><br><span class="line"><span class="comment">// machine.fastToBottom();</span></span><br><span class="line"><span class="comment">// machine.transform();</span></span><br><span class="line"></span><br><span class="line">machine.toLeft();</span><br></pre></td></tr></table></figure>
<p>调用逻辑做得如此复杂，其实是为了开发起来方便，即每次我们增加或修改游戏功能只需修改 TetrisMachine 类即可。<br>当然，其实这样做是有原因的，即设计模式种有一条重要的原则：对修改关闭对扩展开放。具体好处是：</p>
<ul>
<li>如修改功能、代码的具体逻辑，以上例为例，即修改 TetrisMachine 类即可。</li>
<li>此外，命令模式还可以实现命令记录的功能，如在 Buttons 里使用数据结构存储执行过的命令对象，需要时可恢复。</li>
</ul>
<h4 id="总结-8"><a href="#总结-8" class="headerlink" title="总结"></a>总结</h4><ul>
<li>命令模式的优缺点<ul>
<li>优点 - 更灵活的控制性以及更好的扩展性；更弱的耦合性。</li>
<li>缺点 - 类的膨胀，大量衍生类的创建。</li>
</ul>
</li>
</ul>
<h3 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h3><h4 id="观察者模式的定义"><a href="#观察者模式的定义" class="headerlink" title="观察者模式的定义"></a>观察者模式的定义</h4><p>定义对象间一种 <code>一对多</code> 的 <code>依赖关系</code>，使得每当一个对象改变状态，则所有依赖与它的对象都会得到通知并被自动更新。</p>
<h4 id="观察者模式的使用场景"><a href="#观察者模式的使用场景" class="headerlink" title="观察者模式的使用场景"></a>观察者模式的使用场景</h4><ul>
<li>关联行为场景，即关联行为是可拆分的，而不是“组合”关系。</li>
<li>事件多级触发场景。</li>
<li>跨系统的消息交换场景，如消息队列、事件总线的处理机制。</li>
</ul>
<h4 id="观察者模式的-UML-类图"><a href="#观察者模式的-UML-类图" class="headerlink" title="观察者模式的 UML 类图"></a>观察者模式的 UML 类图</h4><p>观察者模式的 UML 类图如图 2-23 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-23.svg" alt="观察者模式的UML类图"></p>
<center>图 2-23 观察者模式的 UML 类图</center>

<h4 id="观察者模式实战"><a href="#观察者模式实战" class="headerlink" title="观察者模式实战"></a>观察者模式实战</h4><h4 id="总结-9"><a href="#总结-9" class="headerlink" title="总结"></a>总结</h4><ul>
<li>观察者模式主要的作用就是对象解耦，将观察者与被观察者完全隔离，只依赖于 Observer 和 Obserable 抽象。</li>
</ul>
<blockquote>
<p>如：ListView 就是运用了 Adapter 和观察者模式，使之它的扩展性、灵活性增强，且耦合度却很低。</p>
</blockquote>
<ul>
<li>观察者模式的优缺点<ul>
<li>优点<br>1) 增强系统灵活性、可扩展性；<br>2) 将观察者与被观察者之间是抽象耦合，应对业务变换。</li>
<li>缺点 - 应用观察者模式，需考虑开放效率和运行效率问题 (一般考虑采用异步的方式)</li>
</ul>
</li>
</ul>
<h3 id="备忘录模式"><a href="#备忘录模式" class="headerlink" title="备忘录模式"></a>备忘录模式</h3><h4 id="备忘录模式的介绍"><a href="#备忘录模式的介绍" class="headerlink" title="备忘录模式的介绍"></a>备忘录模式的介绍</h4><ul>
<li>行为型设计模式。</li>
<li>用于保存对象当前状态，并在之后可再次恢复到此状态。</li>
<li>保证被保存的对象状态不能被对象从外部访问，目的是为了保护好被保存对象状态的完整性及内部实现不向外暴露。</li>
</ul>
<h4 id="备忘录模式的定义"><a href="#备忘录模式的定义" class="headerlink" title="备忘录模式的定义"></a>备忘录模式的定义</h4><p>在不破坏封闭的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态，这样以后就可将该对象恢复到原生保存的状态。</p>
<h4 id="备忘录模式的-UML-类图"><a href="#备忘录模式的-UML-类图" class="headerlink" title="备忘录模式的 UML 类图"></a>备忘录模式的 UML 类图</h4><p>备忘录模式的 UML 类图如图 2-24 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-24.svg" alt="备忘录模式的UML类图"></p>
<center>图 2-24 备忘录模式的 UML 类图</center>

<p><strong>Originator</strong><br>负责创建一个备忘录，可以记录、恢复自身的内部状态。同时 Originator 还可以根据需要决定 Memoto 存储自身的哪些内部状态。</p>
<p><strong>Memoto</strong><br>备忘录角色，用于储存 Originator 的内部状态，并且可以防止 Originator 以外的对象访问 Memoto。</p>
<p><strong>Caretaker</strong><br>负责储存备忘录，不能对备忘录的内容进行操作和访问，只能够将备忘录传递给其他对象。</p>
<h4 id="备忘录模式的简单实例"><a href="#备忘录模式的简单实例" class="headerlink" title="备忘录模式的简单实例"></a>备忘录模式的简单实例</h4><p>对于备忘录模式来说，比较贴切的场景应该是游戏中的存档功能，该功能就是将游戏进度存储到本地文件系统或者数据库中，下次再次进入时从本地加载进度，使得玩家能够继续上一次的游戏之旅。下面我们以“使命召唤”这款游戏为例简单演示备忘录模式的实现。</p>
<p>首先我们建立游戏类 CallOfDuty，备忘录类 Memoto 和负责管理 Memoto 的 CareTaker 类。玩游戏到某个节点对游戏进行存档，然后退出游戏，再重新进入时从存档中读取进度，并且进入存档时的进度。</p>
<p>便于理解，本示例的 UML 类图如图 2-25 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-25.svg" alt="使命召唤的存储功能实现"></p>
<center>图 2-25 使命召唤的存储功能实现</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ”使命召唤“ 游戏 ( 简化的数据模型，仅供简单演示 )</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CallOfDuty</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> mCheckPoint = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> mLifeValue = <span class="number">100</span>;</span><br><span class="line">	<span class="keyword">private</span> String mWeapon = <span class="string">"沙漠之鹰"</span>;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123; <span class="comment">// 玩游戏</span></span><br><span class="line">		<span class="comment">// 忽略实现细节</span></span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quit</span><span class="params">()</span> </span>&#123; <span class="comment">// 退出游戏</span></span><br><span class="line">		<span class="comment">// 忽略实现细节</span></span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> Memoto <span class="title">createMemoto</span><span class="params">()</span> </span>&#123; <span class="comment">// 创建备忘录</span></span><br><span class="line"> 		Memoto memoto = <span class="keyword">new</span> Memoto();</span><br><span class="line"> 		memoto.mCheckPoint = mCheckPoint;</span><br><span class="line"> 		memoto.mLifeValue = mLifeValue;</span><br><span class="line"> 		memoto.mWeapon = mWeapon;</span><br><span class="line"> 		<span class="keyword">return</span> memoto;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line"> 	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">restore</span><span class="params">(Memoto memoto)</span> </span>&#123; <span class="comment">// 恢复游戏</span></span><br><span class="line"> 		<span class="keyword">this</span>.mCheckPoint = memoto.mCheckPoint;</span><br><span class="line"> 		<span class="keyword">this</span>.mLifeValue = memoto.mLifeValue;</span><br><span class="line"> 		<span class="keyword">this</span>.mWeapon = memoto.mWeapon;</span><br><span class="line"> 		System.out.println(<span class="string">"恢复后的游戏属性: "</span> + <span class="keyword">this</span>.toString());</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line"> 	<span class="meta">@Overrride</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"CallOfDuty[mCheckPoint=..., mLifeValue=..., mWeapon=...]"</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 备忘录类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Memoto</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> mCheckPoint;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> mLifeValue;</span><br><span class="line">	<span class="keyword">public</span> String mWeapon;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Caretaker，负责管理 Memoto</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Caretaker</span> </span>&#123;</span><br><span class="line">	Memoto memoto = <span class="keyword">null</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">archive</span><span class="params">(Memoto memoto)</span> </span>&#123; <span class="comment">// 存档</span></span><br><span class="line">		<span class="keyword">this</span>.memoto = memoto;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Memoto <span class="title">getMemoto</span><span class="params">()</span> </span>&#123; <span class="comment">// 读取存档</span></span><br><span class="line">		<span class="keyword">return</span> memoto;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		CallOfDuty game = <span class="keyword">new</span> CallOfDuty();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// Step.01 游戏开始</span></span><br><span class="line">		game.play();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// Step.02 游戏存档</span></span><br><span class="line">		Caretaker caretaker = <span class="keyword">new</span> Caretaker();</span><br><span class="line">		caretaker.archive( game.createMemoto() );</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// Step.03 退出游戏</span></span><br><span class="line">		game.quit();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// Step.04 恢复游戏</span></span><br><span class="line">		CallOfDuty newGame = <span class="keyword">new</span> CallOfDuty();</span><br><span class="line">		newGame.restore( caretaker.getMemoto() );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="总结-10"><a href="#总结-10" class="headerlink" title="总结"></a>总结</h4><ul>
<li>备忘录模式是在不破坏封装的条件下，通过备忘录对象 (Memoto) 存储另外一个对象内部状态的快照，在需求的时候把对象还原到存储的状态。</li>
<li>备忘录的优缺点<ul>
<li>优点 - 恢复状态机制；信息封装</li>
<li>缺点 - 消耗内存 </li>
</ul>
</li>
</ul>
<h3 id="迭代器模式"><a href="#迭代器模式" class="headerlink" title="迭代器模式"></a>迭代器模式</h3><h4 id="迭代器模式的介绍"><a href="#迭代器模式的介绍" class="headerlink" title="迭代器模式的介绍"></a>迭代器模式的介绍</h4><ul>
<li>又称游标 (Cursor) 模式，行为型设计模式。</li>
<li><p>迭代器模式源于对容器的访问，若我们将遍历的方法封装在容器中，则存在问题：</p>
<ul>
<li>不仅维护自身内部数据且要对外提供遍历的接口方法。</li>
<li>不能对同一个容器同时进行多个遍历操作。</li>
<li><p>不提供遍历方法，而让使用者自行实现，必暴露内部细节。  </p>
<p>解决方案：在客户访问类与容器直接插入一个第三者 <code>迭代器</code>。</p>
</li>
</ul>
</li>
</ul>
<h4 id="迭代器模式的定义"><a href="#迭代器模式的定义" class="headerlink" title="迭代器模式的定义"></a>迭代器模式的定义</h4><p>提供一种方法顺序访问一个容器对象中的各个元素，而不需暴露该对象内部细节。</p>
<h4 id="迭代器模式的-UML-类图"><a href="#迭代器模式的-UML-类图" class="headerlink" title="迭代器模式的 UML 类图"></a>迭代器模式的 UML 类图</h4><p>迭代器模式的 UML 类图如图 2-26 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-26.svg" alt="迭代器模式的UML类图"></p>
<center>图 2-26 迭代器模式的 UML 类图</center>

<p><strong>Iterator：迭代器接口</strong><br>迭代器接口，负责定义、访问和遍历元素的接口。</p>
<p><strong>ConcreteIterator：具体迭代器类</strong><br>具体迭代器类，实现迭代器接口，并记录遍历的当前位置。  </p>
<p><strong>Aggregate：容器接口</strong><br>容器接口，负责提供创建具体迭代器角色的接口。</p>
<p><strong>ConcreteIterator：具体容器类</strong><br>具体容器类，具体迭代器角色与该容器相关联。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 迭代器接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Iterator</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 是否还有下一个元素</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> true 表示有，false 表示没有</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回当前位置的元素并将位置移至下一位</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> T 返回当前位置的元素</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">T <span class="title">next</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体迭代器类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteIterator</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> List&lt;T&gt; list = <span class="keyword">new</span> ArrayList&lt;T&gt;();</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> cursor = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ConcreteIterator</span><span class="params">(List&lt;T&gt; list)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.list = list;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> cursor != list.size();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> T <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		T obj = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">if</span>( <span class="keyword">this</span>.hasNext()) &#123;</span><br><span class="line">			obj = <span class="keyword">this</span>.list.get(cursor++);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> obj;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 容器接口</span></span><br><span class="line">pulbic <span class="class"><span class="keyword">interface</span> <span class="title">Aggregate</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 添加一个元素</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> obj 元素对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(T obj)</span></span>; </span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 移除一个元素</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> obj 元素对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(T obj)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取容器的迭代器</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 迭代器对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function">Iterator&lt;T&gt; <span class="title">Iterator</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体容器类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteAggregate</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Aggregate</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> List&lt;T&gt; list = <span class="keyword">new</span> ArrayList&lt;T&gt;();</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		list.add(obj);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		list.remove(obj);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Iterator&lt;T&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ConcreteIterator&lt;T&gt;(list);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Aggregate&lt;String&gt; aggregate = <span class="keyword">new</span> ConcreteAggregate&lt;&gt;();</span><br><span class="line">		</span><br><span class="line">		aggregate.add(<span class="string">"Aige "</span>);</span><br><span class="line">		aggregate.add(<span class="string">"Studio\n"</span>);</span><br><span class="line">		aggregate.add(<span class="string">"SM "</span>);</span><br><span class="line">		aggregate.add(<span class="string">"Brother\n"</span>);</span><br><span class="line">		</span><br><span class="line">		Iterator&lt;String&gt; iterator = aggregate.iterator();</span><br><span class="line">		<span class="keyword">while</span>( iterator.hasNext() ) &#123;</span><br><span class="line">			System.out.println(iterator.next());</span><br><span class="line">		&#125;	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="总结-11"><a href="#总结-11" class="headerlink" title="总结"></a>总结</h4><ul>
<li>迭代器模式的优缺点<ul>
<li>优点 - 支持以不同的方式遍容器对象，也可以有多个遍历，弱化了容器类与遍历算法之间的关系。</li>
<li>缺点 - 类文件的增加。  </li>
</ul>
</li>
<li>当然几乎每一种高级语言都有相应的内置迭代器实现，故本章的内容在于了解而非应用。</li>
</ul>
<h3 id="模板方法模式"><a href="#模板方法模式" class="headerlink" title="模板方法模式"></a>模板方法模式</h3><h4 id="模板方法模式的介绍"><a href="#模板方法模式的介绍" class="headerlink" title="模板方法模式的介绍"></a>模板方法模式的介绍</h4><p>若我们知道一个算法所需的关键步骤，并确定了这些步骤的执行顺序，但某些步骤的具体实现是未知的，或实现是随着环境变化的。</p>
<blockquote>
<p>例如，执行程度的流程大致为：<br>Step.01：检查代码正确性<br>Step.02：链接相关类库<br>Step.03：编译<br>Step.04：执行程序<br>即上述步骤不一样 ( 实现细节 )，但执行流程是固定的。</p>
</blockquote>
<h4 id="模板方法模式的定义"><a href="#模板方法模式的定义" class="headerlink" title="模板方法模式的定义"></a>模板方法模式的定义</h4><ul>
<li>定义一个操作的 <code>算法框架</code>。</li>
<li>将步骤延迟到子类，使子类不改变算法结构即可重定义该算法的某些特定步骤。</li>
</ul>
<h4 id="模板方法模式的使用场景"><a href="#模板方法模式的使用场景" class="headerlink" title="模板方法模式的使用场景"></a>模板方法模式的使用场景</h4><ul>
<li>多个子类有公有的方法，且逻辑基本相同。</li>
<li>重要复杂的算法，可把核心算法设计为模板方法，周边细节功能则由各个子类实现。</li>
<li><p>重构时，使用模板方法，即相同代码抽取到父类中，然后通过 <code>钩子函数</code> 约束其行为。</p>
<blockquote>
<p>钩子函数：普通的抽象类多态，即它在模板方法模式中提供了改变原始逻辑的空间。</p>
</blockquote>
</li>
</ul>
<h4 id="模板方法模式的-UML-类图"><a href="#模板方法模式的-UML-类图" class="headerlink" title="模板方法模式的 UML 类图"></a>模板方法模式的 UML 类图</h4><p>模板方法模式的 UML 类图如图 2-27 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-27.svg" alt="模板方法模式的UML类图"></p>
<center>图 2-27 模板方法模式的 UML 类图</center>

<h4 id="总结-12"><a href="#总结-12" class="headerlink" title="总结"></a>总结</h4><ul>
<li><p>模板方法模式：流程封装，即把某个固定的流程封装到一个 final 函数中，并让子类能够定制这个流程中的某些或者所有步骤。</p>
<blockquote>
<p>要求父类提供共同代码，即提高代码复用性、可扩展性。</p>
</blockquote>
</li>
<li><p>模板方法的优缺点</p>
<ul>
<li>优点<br>1) 封装不变部分，扩展可变部分。<br>2) 提取公共部分代码。  </li>
<li>缺点：代码阅读有难度？</li>
</ul>
</li>
</ul>
<h3 id="访问者模式"><a href="#访问者模式" class="headerlink" title="访问者模式"></a>访问者模式</h3><h4 id="访问者模式的介绍"><a href="#访问者模式的介绍" class="headerlink" title="访问者模式的介绍"></a>访问者模式的介绍</h4><ul>
<li>将 <code>数据操作</code> 与 <code>数据结构</code> 分离的设计模式。</li>
<li>软件系统拥有由许多对象构成的对象结构，这些对象类拥有一 accept() 方法接受访问者对象访问。</li>
<li><p>访问者是一接口，拥有一 visit() 方法对访问到的对象结构中不同类型的元素作出不同的处理。</p>
<blockquote>
<ul>
<li>在对象结构的一次访问中，遍历整个对象结构，对每个元素实施 accept() 方法。  </li>
<li>每一元素的 accept() 方法会调用访问者的 visit() 方法，即访问者可针对对象结构设计不同的访问类来完成不同操作。</li>
</ul>
</blockquote>
</li>
</ul>
<h4 id="访问者模式的定义"><a href="#访问者模式的定义" class="headerlink" title="访问者模式的定义"></a>访问者模式的定义</h4><p>封装用于某种数据结构中各元素操作，且在不改数据结构的前提下定义这些元素的新操作。</p>
<h4 id="访问者模式的使用场景"><a href="#访问者模式的使用场景" class="headerlink" title="访问者模式的使用场景"></a>访问者模式的使用场景</h4><ul>
<li>对一对象结构中的对象进行不同且不相关的操作。</li>
<li>需避免操作“污染”对象的类。</li>
<li>增加新操作是不修改这些类。</li>
<li>对象结构稳定，但经常需在对象结构上定义新操作。</li>
</ul>
<h4 id="访问者模式的-UML-类图"><a href="#访问者模式的-UML-类图" class="headerlink" title="访问者模式的 UML 类图"></a>访问者模式的 UML 类图</h4><p>访问者模式的 UML 类图如图 2-28 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-28.svg" alt="访问者模式的UML类图"></p>
<center>图 2-28 访问者模式的 UML 类图</center>

<h4 id="访问者模式的简单示例"><a href="#访问者模式的简单示例" class="headerlink" title="访问者模式的简单示例"></a>访问者模式的简单示例</h4><p>公司给员工进行业绩考核，评定由公司高层负责。但不同领域的管理人员对与员工的评定标准不一样。即我们把员工分为工程师和经理，评定员工分为 CTO 和 CEO。</p>
<p>假定 CTO 关注工程师的代码量，经理的新产品数量；CEO 关注工程师的 KPI，经理的 KPI 及新产品数量。</p>
<p>便于理解，本示例的 UML 类图如图 2-29 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-29.svg" alt="公司员工业绩考核"></p>
<center>图 2-29 公司员工业绩考核</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 员工基类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Staff</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> String name;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">int</span> kpi; <span class="comment">// 员工 KPI</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Staff</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		kpi = <span class="keyword">new</span> Random().nextInt(<span class="number">10</span>); <span class="comment">// 随机生成 10 内的值.</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 接受 Visitor 的访问</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor visitor)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 工程师类型</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Engineer</span> <span class="keyword">extends</span> <span class="title">Staff</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> codes; <span class="comment">// 代码量</span></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Engineer</span> <span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(name);</span><br><span class="line">		codes = <span class="keyword">new</span> Random().nextInt(<span class="number">100000</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor visitor)</span> </span>&#123;</span><br><span class="line">		visitor.visit(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCodeLines</span><span class="params">()</span> </span>&#123; <span class="comment">// 工程师一年内写的代码量</span></span><br><span class="line">		<span class="keyword">return</span> codes;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 经理类型</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Manager</span> <span class="keyword">extends</span> <span class="title">Staff</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> products; <span class="comment">// 产品数量</span></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Manager</span> <span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(name);</span><br><span class="line">		products = <span class="keyword">new</span> Random().nextInt(<span class="number">10</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor visitor)</span> </span>&#123;</span><br><span class="line">		visitor.visit(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getProducts</span><span class="params">()</span> </span>&#123; <span class="comment">// 经理一年内做的产品数量</span></span><br><span class="line">		<span class="keyword">return</span> products;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Visitor</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 访问工程师类型</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Engineer engineer)</span></span>; </span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 访问经理类型</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Manager leader)</span></span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CEO 访问者</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CEOVisitor</span> <span class="keyword">implements</span> <span class="title">Visitor</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Engineer engineer)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Name:..., KPI:..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Manager mgr)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Name:..., KPI:..., Products:..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CTO 访问者</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CTOVisitor</span> <span class="keyword">implements</span> <span class="title">Visitor</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Engineer engineer)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Name:..., Codes:..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Manager mgr)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Name:..., Products:..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BusinessReport</span> </span>&#123;</span><br><span class="line">	List&lt;Staff&gt; mStaffs = <span class="keyword">new</span> LinkedList&lt;Staff&gt;();</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">BusinessReport</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		mStaffs.add(<span class="keyword">new</span> Manager(<span class="string">"Manager Wang."</span>));</span><br><span class="line">		mStaffs.add(<span class="keyword">new</span> Manager(<span class="string">"Manager Lin."</span>));</span><br><span class="line">		mStaffs.add(<span class="keyword">new</span> Manager(<span class="string">"Engineer Kael."</span>));</span><br><span class="line">		mStaffs.add(<span class="keyword">new</span> Manager(<span class="string">"Engineer Chaos."</span>));</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 为访问者展示报表</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> visitor 公司高层，如 CEO、CTO</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showReport</span><span class="params">(Visitor visitor)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span>( Staff staff : mStaffs ) &#123;</span><br><span class="line">			staff.accept(visitor);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		BusinessReport report = <span class="keyword">new</span> BusinessReport();</span><br><span class="line">		report.showReport( <span class="keyword">new</span> CEOVisitor() );</span><br><span class="line">		report.showReport( <span class="keyword">new</span> CTOVisitor() );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="总结-13"><a href="#总结-13" class="headerlink" title="总结"></a>总结</h4><ul>
<li>对象结构足够稳定，需在对象结构上经常定义新操作，且需对对象结构中的对象进行很多不同且不相关的操作，考虑访问者模式。</li>
<li>访问者模式的优缺点<ul>
<li>优点<br>1) 单一职责原则，即各角色职责分离。<br>2) 数据结构和作用于该结构上的操作解耦。  </li>
<li>缺点<br>1) 具体元素对访问者公布细节。<br>2) 具体元素变更导致修改成本大。<br>3) 违反依赖倒置原则，即为了“区别对待”而依赖了具体类，没有依赖抽象，如上例中的 Engineer 与 Manager。  </li>
</ul>
</li>
</ul>
<h3 id="中介者模式"><a href="#中介者模式" class="headerlink" title="中介者模式"></a>中介者模式</h3><h4 id="中介者模式的介绍"><a href="#中介者模式的介绍" class="headerlink" title="中介者模式的介绍"></a>中介者模式的介绍</h4><ul>
<li>又称为调节者模式或调停者模式，行为型设计模式。</li>
</ul>
<h4 id="中介者模式的定义"><a href="#中介者模式的定义" class="headerlink" title="中介者模式的定义"></a>中介者模式的定义</h4><ul>
<li>包装一系列对象相互作用的方式，使这些对象不必相互明显作用。</li>
<li>将多对多的相互作用转化为一对多的相互作用。</li>
<li>将对象的行为和协作抽象化。</li>
</ul>
<h4 id="中介者模式的使用场景"><a href="#中介者模式的使用场景" class="headerlink" title="中介者模式的使用场景"></a>中介者模式的使用场景</h4><ul>
<li>对象间交互操作较多且每个对象的行为操作都依赖彼此时，为防止修改其中一对象的行为同时涉及修改很多其他对象的行为。</li>
<li>该模式将对象之间的多对多关系变成一对多关系。</li>
<li>中介者对象将系统从网状结构变成以调停者为中心的星形结构，以降低系统复杂性，提高可扩展性作用。</li>
</ul>
<h4 id="中介者模式的-UML-类图"><a href="#中介者模式的-UML-类图" class="headerlink" title="中介者模式的 UML 类图"></a>中介者模式的 UML 类图</h4><p>中介者模式的 UML 类图如图 2-30 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-30.svg" alt="中介者模式的UML类图"></p>
<center>图 2-30 中介者模式的 UML 类图</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象中介者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Mediator</span> </span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> ConcreteColleagueA colleagueA; <span class="comment">// 具体同事类 A</span></span><br><span class="line">	<span class="keyword">protected</span> ConcreteColleagueB colleagueB; <span class="comment">// 具体同事类 B</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 抽象中介方法、子类实现</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setColleagueA</span><span class="params">(ConcreteColleagueA colleagueA)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.colleagueA = colleagueA;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setColleagueB</span><span class="params">(ConcreteColleagueB colleagueB)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.colleagueB = colleagueB;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体中介者</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteMediator</span> <span class="keyword">extends</span> <span class="title">Mediator</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		colleagueA.action();</span><br><span class="line">		colleagueB.action();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象同事</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Colleague</span> </span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> Mediator mediator; <span class="comment">// 中介者对象</span></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Colleague</span><span class="params">(Mediator mediator)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.mediator = mediator;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 同事角色的具体行为，由子类去实现</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体同事 A</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteColleagueA</span> <span class="keyword">extends</span> <span class="title">Colleague</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ConcreteColleagueA</span><span class="params">(Mediator mediator)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(mediator);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Colleague A 将信息递交给中介者处理."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体同事 B</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteColleagueB</span> <span class="keyword">extends</span> <span class="title">Colleague</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ConcreteColleagueB</span><span class="params">(Mediator mediator)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(mediator);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Colleague B 将信息递交给中介者处理."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="中介者模式的简单实现"><a href="#中介者模式的简单实现" class="headerlink" title="中介者模式的简单实现"></a>中介者模式的简单实现</h4><p>便于理解，本示例的 UML 类图如图 2-31 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-31.svg" alt="电脑内部硬件的交互"></p>
<center>图 2-31 电脑内部硬件的交互</center>

<p>中介者模式就是用来协调多个对象之间的交互，就像上例中的主板，没有主板这个中介者，那么电脑里的每一个零部件都要与其他零部件建立关联。</p>
<p>比如 CPU 要与内存交互，与显卡交互以及与 IO 设备交互，那么这样一来就会构成一个错综复杂的网状图，而中介者模式即将网状图变成一个结构清晰的星形图。</p>
<h4 id="中介者模式实战"><a href="#中介者模式实战" class="headerlink" title="中介者模式实战"></a>中介者模式实战</h4><p>协调多个交互的对象，Android 中这么多形形色色控件也算是交互对象。其中社交、网商等应用的用户登录模块，账号框、密码框、登录按钮之间的相互制约、联系，正是中介者模式的表现，具体的实例样式可自行尝试。</p>
<h4 id="总结-14"><a href="#总结-14" class="headerlink" title="总结"></a>总结</h4><ul>
<li>中介者模式的优缺点<ul>
<li>优点 - 将网状般的依赖关系转化为以中介者为中心的星形结构，即使用中介者模式可对这种依赖关系进行解耦使逻辑结构清晰。</li>
<li>缺点 - 若几个类间的依赖关系并不复杂，使用中介者模式反而会使原本不复杂的逻辑结构变得复杂。</li>
</ul>
</li>
</ul>
<h3 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h3><h4 id="代理模式的定义"><a href="#代理模式的定义" class="headerlink" title="代理模式的定义"></a>代理模式的定义</h4><ul>
<li>结构型设计模式。</li>
<li>为其他对象提供一种代理以控制对这个对象的访问。</li>
</ul>
<h4 id="代理模式的使用场景"><a href="#代理模式的使用场景" class="headerlink" title="代理模式的使用场景"></a>代理模式的使用场景</h4><ul>
<li>无法或不想直接访问某个对象或访问某对象存在困难。</li>
<li>为保证客户端使用的透明性，委托对象与代理对象需实现相同的接口。</li>
</ul>
<h4 id="代理模式的-UML-类图"><a href="#代理模式的-UML-类图" class="headerlink" title="代理模式的 UML 类图"></a>代理模式的 UML 类图</h4><p>代理模式的 UML 类图如图 2-32 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-32.svg" alt="代理模式的UML类图"></p>
<center>图 2-32 代理模式的 UML 类图</center>

<p><strong>Subject：抽象主题类</strong><br>该类主要职责是声明真实主题与代理的共同接口方法，其可是抽象类或接口。</p>
<p><strong>RealSubject：真实主题类</strong><br>该类也被称为被委托类或者被代理类，该类定义了代理所表示的真实对象，由其执行具体的业务逻辑方法，而客户类则通过代理类间接地调用真实主题类中定义的方法。</p>
<p><strong>ProxySubject：代理类</strong><br>该类也称为委托类或者代理类，该类持有一个对真实主题类的引用，在其所实现的接口方法中调用真实主题类中相应的接口方法执行，以起到代理的作用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象主题类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 一个普通的业务方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现抽象主题的真实主题类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RealSubject</span> <span class="keyword">extends</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Real Subjetc!"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxySubject</span> <span class="keyword">extends</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> RealSubject mSubject; <span class="comment">// 持有真实主题的引用</span></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ProxySubject</span><span class="params">(RealSubject mSubject)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.mSubject = mSubject;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		mSubject.visit();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 构造一个真实主题对象</span></span><br><span class="line">		RealSubject real = <span class="keyword">new</span> RealSubject();</span><br><span class="line">		<span class="comment">// 通过真实主题对象构造一个代理对象</span></span><br><span class="line">		ProxySubject proxy = <span class="keyword">new</span> ProxySubject(real);</span><br><span class="line">		<span class="comment">// 调用代理的相关方法</span></span><br><span class="line">		proxy.visit(); </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="代理模式的简单实现"><a href="#代理模式的简单实现" class="headerlink" title="代理模式的简单实现"></a>代理模式的简单实现</h4><p>以生活中常有的例子，老板拖欠工资甚至克扣工资的情况，而最恰当的途径就是通过法律诉讼解决问题。一旦选择走法律途径解决该纠纷，那么不可避免地需请一个律师来作为自己的诉讼代理人。</p>
<p>便于理解，本示例的 UML 类图如图 2-33 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-33.svg" alt="律师作为诉讼代理人"></p>
<center>图 2-33 律师作为诉讼代理人</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 诉讼接口类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ILawsuit</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">submit</span><span class="params">()</span></span>; <span class="comment">// 提交申请</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">burden</span><span class="params">()</span></span>; <span class="comment">// 进行举证</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">defend</span><span class="params">()</span></span>; <span class="comment">// 开始辩护</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">finish</span><span class="params">()</span></span>; <span class="comment">// 诉讼完成</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体诉讼人</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XiaoMin</span> <span class="keyword">implements</span> <span class="title">ILawsuit</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">submit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"老板拖欠工资，特此申请仲裁!"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">burden</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"这是合同书和过去一年的银行工资流水!"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">defend</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"证据确凿!"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">finish</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"诉讼成功!"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理律师</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lawyer</span> <span class="keyword">implements</span> <span class="title">ILawsuit</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> ILawsuit mLawsuit; <span class="comment">// 持有一个具体被代理者的引用</span></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Lawyer</span><span class="params">(ILawsuit lawsuit)</span> </span>&#123;</span><br><span class="line">		mLawsuit = lawsuit;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">submit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		mLawsuit.submit();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">burden</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		mLawsuit.burden();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">defend</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		mLawsuit.defend();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">finish</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		mLawsuit.finish();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">		ILawsuit xiaomin = <span class="keyword">new</span> XiaoMin();</span><br><span class="line">		ILawsuit lawyer = <span class="keyword">new</span> Lawyer(xiaomin);</span><br><span class="line"></span><br><span class="line">		lawyer.submit();</span><br><span class="line">		lawyer.burden();</span><br><span class="line">		lawyer.defend();</span><br><span class="line">		lawyer.finish();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>静态代理<br>  代码由程序员自己或者通过一些自动化工具生成固定的代码再对其进行编译，即说在我们的代码运行前代理类的 Class 编译文件就已经存在。上述例子即为静态代理的实现模式。</p>
</li>
<li><p>动态代理<br>  通过反射机制动态地生成代理者的对象，即我们在编译阶段不需要知道代理者是谁，代理谁我们将在执行阶段决定。Java 提供了便捷的动态代理接口 InvocationHandler。<br>  同样，以动态代理方式实现上述例子，本示例的 UML 类图如图 2-34 所示。</p>
</li>
</ul>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-34.svg" alt="动态代理的实现案例"></p>
<center>图 2-34 动态代理的实现案例</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicProxy</span> <span class="keyword">implements</span> <span class="title">IncocationHandler</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Object obj; <span class="comment">// 被代理的类引用</span></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">DynamicProxy</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.obj = obj;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		Object result = method.invoke(obj, args);</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		ILawsuit xiaomin = <span class="keyword">new</span> XiaoMin();</span><br><span class="line">		DynamicProxy proxy = <span class="keyword">new</span> DynamicProxy(xiaomin);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 获取被代理类小民的 ClassLoader</span></span><br><span class="line">		ClassLoader loader = xiaomin.getClass().getClassLoader();</span><br><span class="line">		<span class="comment">// 动态构造一个代理者律师</span></span><br><span class="line">		ILawsuit lawyer =(ILawsuit) Proxy.newProxyInstance(loader,</span><br><span class="line">			<span class="keyword">new</span> Class[] &#123;ILawsuit.class&#125;, proxy);</span><br><span class="line">		)</span><br><span class="line">		<span class="comment">// 律师提交诉讼申请</span></span><br><span class="line">		lawyer.submit();</span><br><span class="line">		<span class="comment">// 律师进行举证</span></span><br><span class="line">		lawyer.burden();</span><br><span class="line">		<span class="comment">// 律师代替小民进行辩护</span></span><br><span class="line">		lawyer.defend();</span><br><span class="line">		<span class="comment">// 完成诉讼</span></span><br><span class="line">		lawyer.finish();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="总结-15"><a href="#总结-15" class="headerlink" title="总结"></a>总结</h4><ul>
<li>代理模式的优缺点<ul>
<li>优点 - 代理模式可看作一种针对性优化。</li>
<li>缺点 - 暂没有明显的缺点。</li>
</ul>
</li>
</ul>
<h3 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h3><h4 id="组合模式的介绍"><a href="#组合模式的介绍" class="headerlink" title="组合模式的介绍"></a>组合模式的介绍</h4><ul>
<li>又称部分整体模式，结构型设计模式。</li>
<li>它将一组相似的对象看作一个对象处理，并根据一个树状结构来组合对象，然后提供一个统一的方法去访问相应对象。</li>
</ul>
<p>例如公司组织结构的树状图，如图 2-35 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-35.svg" alt="公司组织结构的树状图"></p>
<center>图 2-35 公司组织结构的树状图</center>

<p>在组合模式中，我们将这样的一个拥有分支的节点称之为枝干构件，位于树状结构顶部的枝干结构比较特殊，我们称为根结构件，因其为整个树状图的始端。同样对于像行政部和研发部这样没有分支的结构，我们称之为叶子结构，这样的一个结构就是组合模式的雏形。如图 2-36 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-36.svg" alt="组合模式的雏形"></p>
<center>图 2-36 组合模式的雏形</center>

<h4 id="组合模式的定义"><a href="#组合模式的定义" class="headerlink" title="组合模式的定义"></a>组合模式的定义</h4><p>将对象组合成 <code>树状结构</code> 以表示 “部分-整体” 的 <code>层次结构</code>，使得用户对单个对象和组合对象的使用具有一致性。</p>
<h4 id="组合模式的使用场景"><a href="#组合模式的使用场景" class="headerlink" title="组合模式的使用场景"></a>组合模式的使用场景</h4><ul>
<li>表示对象的 <code>部分-整体</code> 层次结构时。</li>
<li>从一个整体中能够独立出部分模块或功能的场景。</li>
</ul>
<h4 id="组合模式的-UML-类图"><a href="#组合模式的-UML-类图" class="headerlink" title="组合模式的 UML 类图"></a>组合模式的 UML 类图</h4><p>组合模式的 UML 类图如图 2-37 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-37.svg" alt="组合模式的UML类图"></p>
<center>图 2-37 组合模式的 UML 类图</center>

<p>上述所讲与依赖倒置原则相违背，既然是面向接口编程，则我们就该把焦点放在接口设计上，即在 Composite 的一些实现方法定义到 Component 中。</p>
<p>这样，我们会得到一个不一样的组合模式，也称为安全的组合模式，该安全组合模式的 UML 类图见图 2-38 所示。</p>
<p>透明组合模式不管是叶子还是枝干节点都有相同的结构，那么意味着不能单一的 getChildren() 方法得到子字节的类型 (已是叶子节点)，则必须在方法实现的内部进行判断。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-38.svg" alt="安全的组合模式的UML类图"></p>
<center>图 2-38 安全的组合模式的 UML 类图</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 透明的组合模式抽象根节点</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> String name; <span class="comment">// 节点</span></span><br><span class="line">	</span><br><span class="line">	<span class="function">pulbic <span class="title">Component</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 具体的逻辑方法由子类实现</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 添加子节点</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@child</span> 子节点</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">addChild</span><span class="params">(Component child)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 移除子节点</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@child</span> 子节点</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">removeChild</span><span class="params">(Component child)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取子节点</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> index 子节点对应下标</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 子节点</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Component <span class="title">getChildren</span><span class="params">(<span class="keyword">int</span> index)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 透明的组合模式具体枝干节点</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Composite</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 存储节点的容器</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Component&gt; components = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Composite</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(name);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(name);</span><br><span class="line">		<span class="keyword">if</span>( <span class="keyword">null</span> != components ) &#123;</span><br><span class="line">			<span class="keyword">for</span>(Component c : components) &#123;</span><br><span class="line">				c.doSomething();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addChild</span><span class="params">(Component child)</span> </span>&#123;</span><br><span class="line">		components.add(child);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">removeChild</span><span class="params">(Component child)</span> </span>&#123;</span><br><span class="line">		components.remove(child);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Component <span class="title">getChildren</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> components.get(index);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 透明的组合模式叶子节点</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Leaf</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Leaf</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(name);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(name);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addChild</span><span class="params">(Component child)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"叶子节点没有子节点"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">removeChild</span><span class="params">(Component child)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"叶子节点没有子节点"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Component <span class="title">getChildren</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"叶子节点没有子节点"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 构造一个根节点</span></span><br><span class="line">		Component root = <span class="keyword">new</span> Composite(<span class="string">"Root"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 构造两个枝干节点</span></span><br><span class="line">		Component branch1 = <span class="keyword">new</span> Composite(<span class="string">"Branch1"</span>);</span><br><span class="line">		Component branch2 = <span class="keyword">new</span> Composite(<span class="string">"Branch2"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 构造两个叶子节点</span></span><br><span class="line">		Component leaf1 = <span class="keyword">new</span> Leaf(<span class="string">"Leaf1"</span>);</span><br><span class="line">		Component leaf2 = <span class="keyword">new</span> Leaf(<span class="string">"Leaf2"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 将叶子节点添加至枝干节点中</span></span><br><span class="line">		branch1.addChild(leaf1);</span><br><span class="line">		branch2.addChild(leaf2);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//将枝干节点添加到根节点中</span></span><br><span class="line">		root.addChild(branch1);</span><br><span class="line">		root.addChild(branch2);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 执行方法</span></span><br><span class="line">		root.doSomething();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="组合模式的简单实现"><a href="#组合模式的简单实现" class="headerlink" title="组合模式的简单实现"></a>组合模式的简单实现</h4><p>在操作系统中，文件系统其实就是一种典型的组合模式例子。</p>
<p>具体地，文件系统中文件就是可被具体程序执行的对象，文件夹就是可存放文件和文件夹的对象。文件系统的组合模式表示如图 2-39 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-39.svg" alt="文件系统的组合模式表示"></p>
<center>图 2-39 文件系统的组合模式表示</center>

<p>便于理解，本实例的 UML 类图如图 2-40 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-40.svg" alt="文件系统的组合模式实现"></p>
<center>图 2-40 文件系统的组合模式实现</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 表示文件或文件夹的抽象类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Dir</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 声明一个 List 成员变量存储文件夹下的所有元素</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">protected</span> List&lt;Dir&gt; dirs = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">	<span class="keyword">private</span> String name; <span class="comment">// 当前文件或文件夹的名称</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Dir</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 添加一个文件或文件夹</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> dir 文件或文件夹</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">addDir</span><span class="params">(Dir dir)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 移除一个文件或文件夹</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> dir 文件或文件夹</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">rmDir</span><span class="params">(Dir dir)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 清空文件夹下所有元素</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 输出文件夹目录结构</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取文件夹下所有的文件或文件夹</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 文件夹下所有的文件或文件夹</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> List&lt;Dir&gt; <span class="title">getFiles</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取文件或文件夹的名称</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 文件或文件夹的名称</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 表示文件夹的类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Folder</span> <span class="keyword">extends</span> <span class="title">Dir</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Folder</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(name);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addDir</span><span class="params">(Dir dir)</span> </span>&#123;</span><br><span class="line">		dirs.add(dir);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rmDir</span><span class="params">(Dir dir)</span> </span>&#123;</span><br><span class="line">		dirs.remove(dir);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		dirs.clear();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println( getName() + <span class="string">"("</span> );</span><br><span class="line">		Iterator&lt;Dir&gt; iterator = dirs.iterator();</span><br><span class="line">		<span class="keyword">while</span>( iterator.hasNext() ) &#123;</span><br><span class="line">			Dir dir = iterator.next();</span><br><span class="line">			dir.print();</span><br><span class="line">			<span class="keyword">if</span>( iterator.hasNext() ) &#123;</span><br><span class="line">				System.out.println(<span class="string">",\t"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">")"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Dir&gt; <span class="title">getFiles</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> dirs;</span><br><span class="line">	&#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 表示文件的类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">File</span> <span class="keyword">extends</span> <span class="title">Dir</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">File</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(name);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addDir</span><span class="params">(Dir dir)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(</span><br><span class="line">			<span class="string">"文件类不能作为文件夹类来使用，即文件不支持添加也不支持删除"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rmDir</span><span class="params">(Dir dir)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(</span><br><span class="line">			<span class="string">"文件类不能作为文件夹类来使用，即文件不支持添加也不支持删除"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(</span><br><span class="line">			<span class="string">"文件类不能作为文件夹类来使用，即文件不支持添加也不支持删除"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(getName());</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Dir&gt; <span class="title">getFiles</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(</span><br><span class="line">			<span class="string">"文件类不能作为文件夹类来使用"</span>);</span><br><span class="line">	&#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 构造一个目录对象表示 C 盘根目录</span></span><br><span class="line">		Dir diskC = <span class="keyword">new</span> Folder(<span class="string">"C"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// C 盘根目录下有一个文件 FileLog.txt</span></span><br><span class="line">		diskC.addDir( <span class="keyword">new</span> File(<span class="string">"Filelog.txt"</span>) );</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// C 盘根目录下有3个子目录 windows、perflogs 和 Program File</span></span><br><span class="line">		Dir dirWin = <span class="keyword">new</span> File(<span class="string">"windows"</span>);</span><br><span class="line">		Dir dirPerf = <span class="keyword">new</span> File(<span class="string">"perflogs"</span>);</span><br><span class="line">		Dir dirProg = <span class="keyword">new</span> File(<span class="string">"Program File"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// windows 目录下有文件 explorer.exe</span></span><br><span class="line">		<span class="comment">// perflogs 目录下有文件 perflogs.txt</span></span><br><span class="line">		<span class="comment">// Program File 目录下有文件 syslogs.txt</span></span><br><span class="line">		dirWin.addDir( <span class="keyword">new</span> File(<span class="string">"explorer.exe"</span>) );</span><br><span class="line">		dirPerf.addDir( <span class="keyword">new</span> File(<span class="string">"perflogs.txt"</span>) );</span><br><span class="line">		dirProg.addDir( <span class="keyword">new</span> File(<span class="string">"syslogs.txt"</span>) );</span><br><span class="line">		</span><br><span class="line">		diskC.add(dirWin);</span><br><span class="line">		diskC.add(dirPerf);</span><br><span class="line">		diskC.add(dirProg);</span><br><span class="line">		</span><br><span class="line">		diskC.print();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="总结-16"><a href="#总结-16" class="headerlink" title="总结"></a>总结</h4><ul>
<li>组合模式与解释器模式有一定的类同，两者在迭代对象时都涉及递归的调用，但组合模式所提供的属性层次结构使我们能 <code>一视同仁</code> 对待单个对象的对象集合。</li>
<li>组合模式的优缺点<ul>
<li>优点<br>1) 清楚定义分层次的复杂对象，表示对象的全部或部分层次，让高层模块忽略了层次差异，方便对整个层次结构进行控制。<br>2) 高层模块可一致地使用一个组合结构或其中单个对象。<br>3) 在组合模式中增加新的枝干结构和叶子构件很方便，无须对类库进行修改。<br>4) 通过叶子对象和枝干对象的递归组合，形成复杂的树形结构，但对其控制却非常简单。</li>
<li>缺点<br>1) 新增构件时，不好对枝干中的构件类型进行限制，不能依赖类型系统来施加这些约束，因为大多数情况下他们来自相同的抽象层。<br>2) 因此必须进行类型检查来实现。</li>
</ul>
</li>
</ul>
<h3 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h3><h4 id="适配器模式的介绍"><a href="#适配器模式的介绍" class="headerlink" title="适配器模式的介绍"></a>适配器模式的介绍</h4><ul>
<li>ListView、GirdView、RecyclerView 都需要使用 Adapter。</li>
<li>两个没有关系的类型之间交互，一种解决方法是修改各自类接口；另一种情况是使用一个 Adapter，在两种接口间创建一个 “混血儿” 接口，将两接口兼容。</li>
</ul>
<h4 id="适配器模式的定义"><a href="#适配器模式的定义" class="headerlink" title="适配器模式的定义"></a>适配器模式的定义</h4><p>把一个类的接口变换成客户端所期待的另一种接口，从而使原本因接口不匹配而无法一起工作的两个类能一起工作。</p>
<h4 id="适配器模式的使用场景"><a href="#适配器模式的使用场景" class="headerlink" title="适配器模式的使用场景"></a>适配器模式的使用场景</h4><ul>
<li>系统需要使用现存类，而此类接口不符系统需求，即接口不兼容。</li>
<li>需一个统一的输出接口，而输入端的类型不可预知。</li>
</ul>
<h4 id="适配器模式的-UML-类图"><a href="#适配器模式的-UML-类图" class="headerlink" title="适配器模式的 UML 类图"></a>适配器模式的 UML 类图</h4><p>适配器模式也分两种，即类适配器模式和对象适配器模式。</p>
<ul>
<li>类适配器模式，如图 2-41 所示。</li>
</ul>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-41.svg" alt="类适配器的UML类图"></p>
<center>图 2-41 类适配器的 UML 类图</center>

<p>目标接口需要的是 operation2()，而 Adaptee 对象中有一个 operation3()，因此不兼容。故通过 Adapter 实现一个 operation2() 将 Adapter 的 operation3() 转换为 Target() 需要的 operation2()。</p>
<ul>
<li>对象适配器模式，如图 2-42 所示。</li>
</ul>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-42.svg" alt="对象适配器的UML类图"></p>
<center>图 2-42 对象适配器的 UML 类图</center>

<p>这种实现方式直接将要被适配的对象传递到 Adapter 中，使用组合的形式实现接口兼容的效果。即带来的好处有，在被适配的对象中不暴露方法细节；且相对类适配器，由于继承了被适配对象，在 Adapter 类中出现一些奇怪接口。因此对象适配器模式的实现更加灵活。</p>
<h4 id="适配器模式的简单示例"><a href="#适配器模式的简单示例" class="headerlink" title="适配器模式的简单示例"></a>适配器模式的简单示例</h4><p>以电源适配器为例，分别以类适配器和对象适配器模式阐述具体情况。</p>
<ul>
<li>5V 电压是 Target 接口。</li>
<li>220V 电压是 Adaptee 类。</li>
<li>将电压 220V 转换到 5V 是 Adapter 类。 </li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 以类适配器模式实现</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Target 角色</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FiveVolt</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getvolt5</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Adaptee 角色，需被转换的对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Volt220</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">220</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Adapter 角色，将 220V 的电压转换为 5V 电压</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VoltAdapter</span> <span class="keyword">extends</span> <span class="title">Volt220</span> <span class="keyword">implements</span> <span class="title">FiveVolt</span> </span>&#123;</span><br><span class="line">	<span class="meta">@OVerride</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getVolt5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		VoltAdapter adpter = <span class="keyword">new</span> VoltAdapter();</span><br><span class="line">		System.out.println(输出电压：adapter.getVolt5);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 以对象适配器模式实现</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">// Target 角色</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FiveVolt</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getvolt5</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Adaptee 角色，需被转换的对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Volt220</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">220</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Adapter 角色，将 220V 的电压转换为 5V 电压</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VoltAdapter</span> <span class="keyword">implements</span> <span class="title">FiveVolt</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	Volt220 mVolt220;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">VoltAdapter</span><span class="params">(Volt220 adaptee)</span> </span>&#123;</span><br><span class="line">		mVolt220 = adaptee;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getVolt220</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mVolt220.getVolt220();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@OVerride</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getVolt5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		VoltAdapter adpter = <span class="keyword">new</span> VoltAdapter( <span class="keyword">new</span> Volt220() );</span><br><span class="line">		System.out.println(输出电压：adapter.getVolt5);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="总结-17"><a href="#总结-17" class="headerlink" title="总结"></a>总结</h4><ul>
<li>适配器模式的优缺点<ul>
<li>优点<br>1) 更好的复用性：系统需使用现有的类，而此类的接口不符系统需求，则通过适配器模式可让这些功能得到更好的复用。<br>2) 更好的扩展性。  </li>
<li>缺点 - 若可对系统重构，尽可能不使用适配器，过多使用适配器，容易让系统凌乱，不易整体把握。</li>
</ul>
</li>
</ul>
<h3 id="装饰模式"><a href="#装饰模式" class="headerlink" title="装饰模式"></a>装饰模式</h3><h4 id="装饰模式的介绍"><a href="#装饰模式的介绍" class="headerlink" title="装饰模式的介绍"></a>装饰模式的介绍</h4><ul>
<li>又称为包装模式，结构性设计模式。</li>
<li>使用一种对客户端透明的方式来动态地扩展对象的功能，同时它也是继承关系的一种替代方案。</li>
</ul>
<h4 id="装饰模式的定义"><a href="#装饰模式的定义" class="headerlink" title="装饰模式的定义"></a>装饰模式的定义</h4><p>动态地给一个对象添加一些额外的职责，就增加功能来说，装饰模式相比生成子类更为灵活。</p>
<h4 id="装饰模式的使用场景"><a href="#装饰模式的使用场景" class="headerlink" title="装饰模式的使用场景"></a>装饰模式的使用场景</h4><p>需要透明地、动态地扩展类的功能时，装饰模式不失一种理想方案。</p>
<h4 id="装饰模式的-UML-类图"><a href="#装饰模式的-UML-类图" class="headerlink" title="装饰模式的 UML 类图"></a>装饰模式的 UML 类图</h4><p>装饰模式的 UML 类图如图 2-43 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-43.svg" alt="装饰模式的UML类图"></p>
<center>图 2-43 装饰模式的 UML 类图</center>

<p><strong>Component：抽象组件</strong><br>可以是一个接口或者抽象类，充当被装饰的原始对象。</p>
<p><strong>ConcreteComponent：组件具体实现类</strong><br>该类是 Component 类的基本实现，也是我们装饰的具体对象。</p>
<p><strong>Decorator：抽象装饰者</strong><br>其承担的职责是为了装饰我们的组件对象，其内部一定要有一个指向组件对象的引用。</p>
<p><strong>ConcreteDecorator：抽象装饰者</strong><br>对抽象装饰者做出具体实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象组件类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 抽象的方法：自由增加你需要的抽象方法</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">operate</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组件具体实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 忽略实现细节</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象装饰者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Decorator</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Component component; <span class="comment">// 持有一个 Component 对象的引用</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 必要的构造方法，需要一个 Component 类型的对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> component Component 对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Decorator</span><span class="params">(Component component)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.component = component;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		component.operate();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装饰者具体实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteDecoratorA</span> <span class="keyword">extends</span> <span class="title">Decorator</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="title">ConcreteDecoratorA</span><span class="params">(Component component)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(component);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		operateA();</span><br><span class="line">		<span class="keyword">super</span>.operate();</span><br><span class="line">		operateB();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operateA</span><span class="params">()</span> </span>&#123; <span class="comment">// 自定义的装饰方法 A</span></span><br><span class="line">		<span class="comment">// 装饰方法逻辑</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operateB</span><span class="params">()</span> </span>&#123; <span class="comment">// 自定义的装饰方法 B</span></span><br><span class="line">		<span class="comment">// 装饰方法逻辑</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">		<span class="comment">// 构造被装饰的组件对象</span></span><br><span class="line">		Component component = <span class="keyword">new</span> ConcreteComponent();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 根据组件对象构造装饰者对象并调用，即给组件对象增加装饰者的功能方法</span></span><br><span class="line">		Decorator.decoratorA = <span class="keyword">new</span> ConcreteDecoratorA(component);</span><br><span class="line">		decoratorA.operate();</span><br><span class="line">		</span><br><span class="line">		Decorator.decoratorB = <span class="keyword">new</span> ConcreteDecoratorB(component);</span><br><span class="line">		decoratorB.operate();</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="装饰模式实战"><a href="#装饰模式实战" class="headerlink" title="装饰模式实战"></a>装饰模式实战</h4><p>其实装饰模式并不复杂，也不陌生，它就是一种 <code>类间的封装</code>，例如我们常在 Activity 的 onCreate() 方法中做一些相关的初始化操作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DecoratorActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle saveInstanceState)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>.onCreate(saveInstanceState);</span><br><span class="line">		</span><br><span class="line">		initViews();</span><br><span class="line">		findViews();</span><br><span class="line">		setListeners();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initViews</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		setContentView(R.layout.activity_main);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">findViews</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 匹配组件</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setListeners</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 设置组件的监听器</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="总结-18"><a href="#总结-18" class="headerlink" title="总结"></a>总结</h4><ul>
<li><p>装饰模式与代理模式的区别 (容易混淆)</p>
<ul>
<li>装饰模式：以对客户端透明的方式 <code>扩展对象的功能</code>，即继承关系的一个替代方案。</li>
<li><p>代理模式：给一个对象提供一个代理对象，并由 <code>代理对象</code> 来控制对原有对象引用。 </p>
<blockquote>
<p>代理模式，即对代理的对象施加控制。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h3 id="享元模式"><a href="#享元模式" class="headerlink" title="享元模式"></a>享元模式</h3><h4 id="享元模式的介绍"><a href="#享元模式的介绍" class="headerlink" title="享元模式的介绍"></a>享元模式的介绍</h4><ul>
<li>又称 FlyWeight，代表轻量级的意思，结构型设计模式。</li>
<li><code>对象池</code> 的一种实现。</li>
<li><p>享元模式用来是尽可能减少内存使用量，它适用于可能存在大量重复对象的场景。  </p>
<blockquote>
<p>目的：缓存可共享的对象，达到对象共享，避免过多创建对象，即提升性能、避免内存移除。</p>
</blockquote>
</li>
<li>享元对象<ul>
<li>内存状态：可共享，不随环境变化</li>
<li>外部状态：不可共享，随环境变化</li>
<li>对象容器：在经典的享元模式中，对象容器为一 Map，它的 <code>键</code> 是享元对象的<code>内部状态</code>，它的 <code>值</code> 是 <code>享元对象本身</code>。</li>
</ul>
</li>
<li>客户端通过这个内部状态从享元工厂中获取享元对象，若有缓存则使用缓存对象，否则创建一个享元对象并存入容器中。</li>
</ul>
<h4 id="享元模式的定义"><a href="#享元模式的定义" class="headerlink" title="享元模式的定义"></a>享元模式的定义</h4><p>使用共享对象可有效地支持大量的细粒度的对象。</p>
<h4 id="享元模式的使用场景"><a href="#享元模式的使用场景" class="headerlink" title="享元模式的使用场景"></a>享元模式的使用场景</h4><ul>
<li>系统中存在大量的 <code>相似对象</code>。</li>
<li>细粒度的对象都具备较接近的外部状态，且内部状态与环境无关，即对象没有特定身份。</li>
<li>需要 <code>缓冲池</code> 的场景。</li>
</ul>
<h4 id="享元模式的-UML-类图"><a href="#享元模式的-UML-类图" class="headerlink" title="享元模式的 UML 类图"></a>享元模式的 UML 类图</h4><p>享元模式的 UML 类图如图 2-44 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-44.svg" alt="享元模式的UML类图"></p>
<center>图 2-44 享元模式的 UML 类图</center>

<h4 id="享元模式的简单示例"><a href="#享元模式的简单示例" class="headerlink" title="享元模式的简单示例"></a>享元模式的简单示例</h4><p>例1. 过年回家买火车票，无数人在客户端上订票 (有多次购票、刷票的情况)，即不断向服务端发送请求。</p>
<p>而每次查询，服务器必须做出回应，具体地，用户查询输入出发地和目的地，查询结构返回值只有一趟列车的车票。而数以万计的人有同样需求，即不间断请求数据，每次重新创建一个查询的车票结果，即造成大量重复对象创建、销毁，使得服务器压力加重。</p>
<p>享元模式正好适合解决该情形的问题，例如 A 到 B 地的车辆是有限的，车上铺位分硬卧、软卧和坐票三种，将这些可公用的对象缓存起来。用户查询时优先使用缓存，反之则重新创建。</p>
<p>便于理解，本示例的 UML 类图如图 2-45 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-45.svg" alt="网上订票系统的UML类图"></p>
<center>图 2-45 网上订票系统的 UML 类图</center>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Ticket</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showTicketInfo</span><span class="params">(String bunk)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 火车票</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TrainTicket</span> <span class="keyword">implements</span> <span class="title">Ticket</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> String from; <span class="comment">// 始发地</span></span><br><span class="line">	<span class="keyword">public</span> String to; <span class="comment">// 目的地</span></span><br><span class="line">	<span class="keyword">public</span> String bunk; <span class="comment">// 铺位</span></span><br><span class="line">	</span><br><span class="line">	TrainTicket(String from, String to) &#123;</span><br><span class="line">		<span class="keyword">this</span>.from = from;</span><br><span class="line">		<span class="keyword">this</span>.to = to;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showTicketInfo</span><span class="params">(String bunk)</span> </span>&#123;</span><br><span class="line">		price = <span class="keyword">new</span> Random().nextInt(<span class="number">300</span>);</span><br><span class="line">		System.out.println(<span class="string">"From:"</span> + from</span><br><span class="line">			+ <span class="string">"To:"</span> + to</span><br><span class="line">			+ <span class="string">"Bunk:"</span> + bunk</span><br><span class="line">			+ <span class="string">"Price:"</span> + price);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TicketFactory</span> </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> Map&lt;String, Ticket&gt; sTicketMap = </span><br><span class="line">		<span class="keyword">new</span> ConcurrentHashMap&lt;String, Ticket&gt;();</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Ticket <span class="title">getTicket</span><span class="params">(String from, String to)</span> </span>&#123;</span><br><span class="line">		String key = from + <span class="string">"-"</span> + to;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>( sTicketMap.containsKey(key) ) &#123; <span class="comment">// 使用缓存</span></span><br><span class="line">			<span class="keyword">return</span> sTicketMap.get(key);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123; <span class="comment">// 创建对象</span></span><br><span class="line">			Ticket ticket = <span class="keyword">new</span> TrainTicket(from, to);</span><br><span class="line">			sTicketMap.put(key, ticket);</span><br><span class="line">			<span class="keyword">return</span> ticket;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>例2. 我们知道 Java 中 String 是存在于常量池中，即一个 String 被定义之后它就被缓存到了常量池中，当其他地方使用同样的字符串，则直接使用缓存，而非创建。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	String str1 = <span class="string">"Hello World"</span>;</span><br><span class="line">	String str2 = <span class="keyword">new</span> String(<span class="string">"Hello World"</span>);</span><br><span class="line">	String str3 = <span class="string">"Hello "</span> + <span class="string">"World"</span>;</span><br><span class="line">	</span><br><span class="line">	System.out.println( <span class="string">"\nStr1 - Str3: "</span> + str1.equals(str3)</span><br><span class="line">		+  <span class="string">"\nStr2 - Str3: "</span> + str2.equals(str3)</span><br><span class="line">		+  <span class="string">"\nStr1 - Str2: "</span> + str1.equals(str1));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 输出的结果分别是：true，false，false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="总结-19"><a href="#总结-19" class="headerlink" title="总结"></a>总结</h4><ul>
<li>享元模式的优缺点<ul>
<li>优点 - 大幅度地降低内存中对象的数量。</li>
<li>缺点<br>1) 为了使对象可共享，需将一些状态外部化，使程序的逻辑复杂化。<br>2) 将享元对象的状态外部化，而读取外部状态使得运行时间稍微变长。  </li>
</ul>
</li>
</ul>
<h3 id="外观模式"><a href="#外观模式" class="headerlink" title="外观模式"></a>外观模式</h3><h4 id="外观模式的介绍"><a href="#外观模式的介绍" class="headerlink" title="外观模式的介绍"></a>外观模式的介绍</h4><ul>
<li>又称门面模式 (Facade模式)，结构型设计模式。</li>
<li>通过一个外观类使得整个系统中接口只有一个 <code>统一的高层接口</code>，即这样降低用户使用成本，也对用户屏蔽了很多实现细节。</li>
<li>外观模式是 <code>封装API</code> 的常用手段。</li>
</ul>
<h4 id="外观模式的定义"><a href="#外观模式的定义" class="headerlink" title="外观模式的定义"></a>外观模式的定义</h4><ul>
<li>要求一个子系统的外部与其内部的通信必须通过一个统一的对象进行。</li>
<li>外观模式提供一个高层次接口，使得子系统更易于使用。</li>
</ul>
<h4 id="外观模式的使用场景"><a href="#外观模式的使用场景" class="headerlink" title="外观模式的使用场景"></a>外观模式的使用场景</h4><ul>
<li><p>为一个复杂的子系统提供一个简单接口。</p>
<blockquote>
<p>对于系统进行定制、修改，这种易变性，使得隐藏子系统的具体实现变得尤为重要，对外隐藏子系统的具体实现，隔离变化。</p>
</blockquote>
</li>
<li>构建一层次结构的子系统，子系统间相互依赖，则通过 Facade 接口进行通信，从而简化他们的依赖关系。</li>
</ul>
<h4 id="外观模式的-UML-类图"><a href="#外观模式的-UML-类图" class="headerlink" title="外观模式的 UML 类图"></a>外观模式的 UML 类图</h4><p>外观模式的 UML 类图如图 2-46 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-46.svg" alt="外观模式的UML类图"></p>
<center>图 2-46 外观模式的 UML 类图</center>

<h4 id="总结-20"><a href="#总结-20" class="headerlink" title="总结"></a>总结</h4><ul>
<li>外观模式的精髓在于 <code>封装</code>。通过一高层次结构为用户提供统一的 API 入口，使得用户通过一个类就基本能够操作整个系统。</li>
<li>外观模式的优缺点<ul>
<li>优点<br>1) 对客户端隐藏子系统细节，因而减少客户对于子系统的耦合。<br>2) 外观类对子系统的接口封装，使得系统更易于使用。  </li>
<li>缺点<br>1) 外观类没有遵循开闭原则，当业务出现变更时，可能需要直接修改外观类。</li>
</ul>
</li>
</ul>
<h3 id="桥接模式"><a href="#桥接模式" class="headerlink" title="桥接模式"></a>桥接模式</h3><h4 id="桥接模式的介绍"><a href="#桥接模式的介绍" class="headerlink" title="桥接模式的介绍"></a>桥接模式的介绍</h4><ul>
<li>又称桥梁模式，结构型设计模式。</li>
<li>承接者连接 <code>两边</code> 的作用，两边指抽象部分和实现部分。</li>
</ul>
<h4 id="桥接模式的定义"><a href="#桥接模式的定义" class="headerlink" title="桥接模式的定义"></a>桥接模式的定义</h4><p>将 <code>抽象部分</code> 和 <code>实现部分</code> 分离，使它们都可以独立地进行变化。</p>
<h4 id="桥接模式的使用场景"><a href="#桥接模式的使用场景" class="headerlink" title="桥接模式的使用场景"></a>桥接模式的使用场景</h4><ul>
<li>对于不希望使用继承或因多层次继承导致系统类的个数急剧增加的系统，考虑使用桥接模式。</li>
<li>需要在构件的抽象化角色和具体角色之间增加更多灵活性，避免两层次间建立静态的继承关系，可通过桥接模式使它们在抽象层建立一个关联关系。</li>
<li>一个类存在两个独立变化的维度，且这两个维度都需进行扩展。</li>
<li>任何多维度变化类或多个树状类之间的耦合可通过桥接模式解耦。</li>
</ul>
<h4 id="桥接模式的-UML-类图"><a href="#桥接模式的-UML-类图" class="headerlink" title="桥接模式的 UML 类图"></a>桥接模式的 UML 类图</h4><p>桥接模式的 UML 类图如图 2-47 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-47.svg" alt="桥接模式的UML类图"></p>
<center>图 2-47 桥接模式的 UML 类图</center>

<p><strong>Abstraction：抽象部分</strong><br>该类保持一个对实现部分对象的引用，抽象部分中的方法需要调用实现部分的对象来实现。该类一般为抽象类。</p>
<p><strong>RefinedAbstraction：优化的抽象部分</strong><br>抽象部分的具体实现，该类一般是对抽象部分的方法进行完善和扩展。</p>
<p><strong>Implementor：实现部分</strong><br>可以为接口或抽象类，其方法不一定要与抽象部分中的一致，一般情况下是由实现部分提供基本的操作，而抽象部分定义的则是基于实现部分这些基本操作的业务方法。</p>
<p><strong>ConcreteImplementorA/B：实现部分的具体实现</strong><br>完成实现部分中定义的具体逻辑。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现部分的抽象接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Implementor</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 实现抽象部分的具体方法</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operationImpl</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现部分具体的实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteImplementorA</span> <span class="keyword">implements</span> <span class="title">Implementor</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operationImpl</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 忽略实现逻辑</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象部分</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Abstraction</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 声明一私有成员变量引用实现部分的对象</span></span><br><span class="line">	<span class="keyword">private</span> Implementor mImplementor; </span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 通过实现部分对象的引用构造抽象部分的对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> implementor 实现部分对象的引用</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Abstraction</span><span class="params">(Implementor implementor)</span> </span>&#123;</span><br><span class="line">		mImplementor = implementor;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 通过调用实现部分具体的方法实现具体的功能</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		mImplementor.operationImpl();</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 优化的抽象部分</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RefinedAbstraction</span> <span class="keyword">extends</span> <span class="title">Abstraction</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">RefinedAbstraction</span><span class="params">(Implementor implementor)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(implementor);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 对 Abstraction 中的方法进行扩展</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refinedOperation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 忽略实现逻辑</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		RefinedAbstraction abstration = </span><br><span class="line">			<span class="keyword">new</span> RefinedAbstraction( <span class="keyword">new</span> ConcreteImplementorA );</span><br><span class="line">			</span><br><span class="line">		abstraction.operation();</span><br><span class="line">		abstraction.refinedOperation();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="桥接模式实战"><a href="#桥接模式实战" class="headerlink" title="桥接模式实战"></a>桥接模式实战</h4><p>View 的视图层级与执行真正的硬件绘制相关类之间的关系可看作是一种桥接模式。即模仿这种行为，我们可自定义控件以桥接的方式提供多种不同的实现机制。</p>
<p>以进度条为例，我们可继承 View 类来实现进度条控件，自定义水平、垂直和圆形等不同形式的进度条。</p>
<p>便于理解，本示例的 UML 类图如图 2-48 所示。</p>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_2-48.svg" alt="进度条框架的UML类图"></p>
<center>图 2-48 进度条框架的 UML 类图</center>

<h4 id="总结-21"><a href="#总结-21" class="headerlink" title="总结"></a>总结</h4><p>桥接模式，分离抽象与实现，其优点毋庸置疑，即灵活的扩展以及对客户来说透明的是实现。但不足之处在于运用桥接模式进行设计，是有一定难度的，需多加推敲与研究。</p>
<h2 id="叁-MVC-与-MVP-模式"><a href="#叁-MVC-与-MVP-模式" class="headerlink" title="叁 MVC 与 MVP 模式"></a>叁 MVC 与 MVP 模式</h2><h3 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h3><ul>
<li><p>模型 - 视图 - 控制器 (Model - View - Controller，MVC)，是一种 <code>框架模式</code> ，而非设计模式。</p>
<blockquote>
<p>GOF 把 MVC 看作3种设计模式，即观察者模式、策略模式与组合模式的合体，也就是一个基于 <code>发布/订阅者模型</code> 的框架。</p>
</blockquote>
</li>
<li><p>软件开发领域的3种级别重用：</p>
<ul>
<li>内部重用：同一应用中能公共使用的抽象块。</li>
<li>代码重用：将通用模块组合成库或工具集，以便在多个应用和领域都能使用。</li>
<li><p>应用框架重用：为专用领域提供通用的或者现成的基础结构，以获得最高级别的重用性。</p>
<blockquote>
<p>平时开发过程中，常见的框架模式除了 MVC 外，还有 MVVC、MTV、CBD、ORM 和 MVP。</p>
</blockquote>
</li>
</ul>
</li>
<li>MVC 模式的优缺点<ul>
<li>优点 - 表现层与业务层分离实现，各司其职。若在实际项目中，即前端工程师专注界面的研发，后端工程师致力于业务逻辑。</li>
<li>缺点：<br>1) Model 和 View 严格分离，在调试应用程序时较困难。<br>2) 小规模项目，采用 MVC 模式反而显得工序更加繁琐。  </li>
</ul>
</li>
</ul>
<h3 id="MVP"><a href="#MVP" class="headerlink" title="MVP"></a>MVP</h3><ul>
<li><p>数据的存取 - 用户界面 - 交互中间人 (Model - View - Presenter，MVP)，分离显示层和逻辑层，它们之间通过接口进行通信，降低耦合。</p>
</li>
<li><p>MVP 模式的三个角色</p>
<ul>
<li><p><strong>Presenter：交互中间人</strong><br>View 和 Model 沟通的桥梁。它从 Model 层检索数据后，返回给 View 层，使得 View 和 Model 之间没有耦合，也将业务逻辑从 View 角色上抽离。</p>
</li>
<li><p><strong>View：用户界面</strong><br>在 Android 中，通常指 Activity、Fragment 或某个 View 控件，它含有一个 Presenter 成员变量，且 View 需实现以逻辑接口。将 View 上操作通过转交给 Presenter 实现，最后 Presenter 调用 View 逻辑接口将结果返回给 View。 </p>
</li>
<li><p><strong>Model：数据的存取</strong><br>主要提供数据的存取功能。Presenter 需通过 Model 层存储、获取数据。</p>
</li>
</ul>
</li>
</ul>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_3-1.svg" alt="MVP模式的三个角色"></p>
<center>图 3-1 MVP模式的三个角色</center>

<ul>
<li><p>与 MVC 模式的区别</p>
<ul>
<li><p>MVC 特点<br>1) 用户可向 View 发送指令，再由 View 直接要求 Model 改变状态。<br>2) 用户可向 Controller 发送指令，再由 Controller 发送给 View。<br>3) Controller 起到时间路由的作用，同时业务逻辑都部署在 Controller 中。  </p>
<blockquote>
<p>View 可直接访问 Model，即 MVC 模式的耦合性还是相对较高的。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<p><img src="/images/illustration/Reading/2018/01/Design-Pattern-Based-on-Android_3-2.svg" alt="MVC模式的三个角色"></p>
<center>图 3-2 MVC模式的三个角色</center>
      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    Kofe
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://www.kofes.cn/2018/01/Design-Pattern-Based-on-Android.html" title="笔记 | 设计模式之 Android 实践与案例">http://www.kofes.cn/2018/01/Design-Pattern-Based-on-Android.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/UML/" rel="tag"># UML</a>
          
            <a href="/tags/Android/" rel="tag"># Android</a>
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
            <a href="/tags/设计模式/" rel="tag"># 设计模式</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/01/Hexo-Installation-Guide.html" rel="next" title="项目 | 基于 Hexo 框架在 Github 上搭建博客">
                <i class="fa fa-chevron-left"></i> 项目 | 基于 Hexo 框架在 Github 上搭建博客
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/03/Producting-An-Application.html" rel="prev" title="笔记 | 一个 APP 的诞生">
                笔记 | 一个 APP 的诞生 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/profile/society_face_version_1.jpg"
                alt="Kofe" />
            
              <p class="site-author-name" itemprop="name">Kofe</p>
              <p class="site-description motion-element" itemprop="description">More reading, pratice and thinking.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">24</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">76</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/ldxw8" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://dribbble.com/Kofe" target="_blank" title="Dribbble">
                      
                        <i class="fa fa-fw fa-dribbble"></i>Dribbble</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://weibo.com/ldxw8" target="_blank" title="Weibo">
                      
                        <i class="fa fa-fw fa-weibo"></i>Weibo</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://zhan-bin.cn" title="zhan-bin" target="_blank">zhan-bin</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.acxer.cn" title="zcxer" target="_blank">zcxer</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#更新进程"><span class="nav-number">1.</span> <span class="nav-text">更新进程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#内容总览"><span class="nav-number">2.</span> <span class="nav-text">内容总览</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#零-本书架构"><span class="nav-number">3.</span> <span class="nav-text">零 本书架构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#面向对象六大原则"><span class="nav-number">3.1.</span> <span class="nav-text">面向对象六大原则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二十三种设计模式"><span class="nav-number">3.2.</span> <span class="nav-text">二十三种设计模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#壹-面向对象编程六大原则"><span class="nav-number">4.</span> <span class="nav-text">壹 面向对象编程六大原则</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#单一职责原则"><span class="nav-number">4.1.</span> <span class="nav-text">单一职责原则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#开闭原则"><span class="nav-number">4.2.</span> <span class="nav-text">开闭原则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#里氏替换原则"><span class="nav-number">4.3.</span> <span class="nav-text">里氏替换原则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#依赖倒置原则"><span class="nav-number">4.4.</span> <span class="nav-text">依赖倒置原则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#接口隔离原则"><span class="nav-number">4.5.</span> <span class="nav-text">接口隔离原则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#迪米特原则"><span class="nav-number">4.6.</span> <span class="nav-text">迪米特原则</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#贰-二十三种设计模式解析"><span class="nav-number">5.</span> <span class="nav-text">贰 二十三种设计模式解析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#单例模式"><span class="nav-number">5.1.</span> <span class="nav-text">单例模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#单例模式的定义"><span class="nav-number">5.1.1.</span> <span class="nav-text">单例模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#单例模式-UML-类图"><span class="nav-number">5.1.2.</span> <span class="nav-text">单例模式 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#单例模式的简单示例"><span class="nav-number">5.1.3.</span> <span class="nav-text">单例模式的简单示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#单例模式的其他实现方式"><span class="nav-number">5.1.4.</span> <span class="nav-text">单例模式的其他实现方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#懒汉模式"><span class="nav-number">5.1.4.1.</span> <span class="nav-text">懒汉模式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Double-CheckLock-DCL"><span class="nav-number">5.1.4.2.</span> <span class="nav-text">Double CheckLock (DCL)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#静态内部类单例模式"><span class="nav-number">5.1.4.3.</span> <span class="nav-text">静态内部类单例模式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#枚举单例"><span class="nav-number">5.1.4.4.</span> <span class="nav-text">枚举单例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结"><span class="nav-number">5.1.5.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bulider-模式"><span class="nav-number">5.2.</span> <span class="nav-text">Bulider 模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Bulider-模式的定义"><span class="nav-number">5.2.1.</span> <span class="nav-text">Bulider 模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Builder-模式的使用场景"><span class="nav-number">5.2.2.</span> <span class="nav-text">Builder 模式的使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Builder-模式的UML类图"><span class="nav-number">5.2.3.</span> <span class="nav-text">Builder 模式的UML类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Builder-模式的简单实现"><span class="nav-number">5.2.4.</span> <span class="nav-text">Builder 模式的简单实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Builder-模式实战"><span class="nav-number">5.2.5.</span> <span class="nav-text">Builder 模式实战</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-1"><span class="nav-number">5.2.6.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#原型模式"><span class="nav-number">5.3.</span> <span class="nav-text">原型模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#原型模式的定义"><span class="nav-number">5.3.1.</span> <span class="nav-text">原型模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#原型模式的使用场景"><span class="nav-number">5.3.2.</span> <span class="nav-text">原型模式的使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#原型模式的-UML-类图"><span class="nav-number">5.3.3.</span> <span class="nav-text">原型模式的 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#原型模式的简单实现"><span class="nav-number">5.3.4.</span> <span class="nav-text">原型模式的简单实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#浅拷贝和深拷贝"><span class="nav-number">5.3.5.</span> <span class="nav-text">浅拷贝和深拷贝</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#原型模式实战"><span class="nav-number">5.3.6.</span> <span class="nav-text">原型模式实战</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-2"><span class="nav-number">5.3.7.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#工厂方法模式"><span class="nav-number">5.4.</span> <span class="nav-text">工厂方法模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#工厂方法模式的定义"><span class="nav-number">5.4.1.</span> <span class="nav-text">工厂方法模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#工厂方法模式的使用场景"><span class="nav-number">5.4.2.</span> <span class="nav-text">工厂方法模式的使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#工厂方法模式的-UML-类图"><span class="nav-number">5.4.3.</span> <span class="nav-text">工厂方法模式的 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#工厂方法模式的简单实现"><span class="nav-number">5.4.4.</span> <span class="nav-text">工厂方法模式的简单实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#工厂方法模式的实战"><span class="nav-number">5.4.5.</span> <span class="nav-text">工厂方法模式的实战</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#抽象工厂模式"><span class="nav-number">5.5.</span> <span class="nav-text">抽象工厂模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#抽象工厂模式的定义"><span class="nav-number">5.5.1.</span> <span class="nav-text">抽象工厂模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#抽象工厂模式的使用场景"><span class="nav-number">5.5.2.</span> <span class="nav-text">抽象工厂模式的使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#抽象工厂模式的-UML-类图"><span class="nav-number">5.5.3.</span> <span class="nav-text">抽象工厂模式的 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#抽象工厂模式的简单实现"><span class="nav-number">5.5.4.</span> <span class="nav-text">抽象工厂模式的简单实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-3"><span class="nav-number">5.5.5.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#策略模式"><span class="nav-number">5.6.</span> <span class="nav-text">策略模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#策略模式的介绍"><span class="nav-number">5.6.1.</span> <span class="nav-text">策略模式的介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#策略模式的使用场景"><span class="nav-number">5.6.2.</span> <span class="nav-text">策略模式的使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#策略模式的-UML-类图"><span class="nav-number">5.6.3.</span> <span class="nav-text">策略模式的 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#策略模式的简单实现"><span class="nav-number">5.6.4.</span> <span class="nav-text">策略模式的简单实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#策略模式的实战应用"><span class="nav-number">5.6.5.</span> <span class="nav-text">策略模式的实战应用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-4"><span class="nav-number">5.6.6.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#状态模式"><span class="nav-number">5.7.</span> <span class="nav-text">状态模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#状态模式的定义"><span class="nav-number">5.7.1.</span> <span class="nav-text">状态模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#状态模式的使用场景"><span class="nav-number">5.7.2.</span> <span class="nav-text">状态模式的使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#状态模式的-UML-类图"><span class="nav-number">5.7.3.</span> <span class="nav-text">状态模式的 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#状态模式的简单示例"><span class="nav-number">5.7.4.</span> <span class="nav-text">状态模式的简单示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#状态模式实战"><span class="nav-number">5.7.5.</span> <span class="nav-text">状态模式实战</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-5"><span class="nav-number">5.7.6.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#责任链模式"><span class="nav-number">5.8.</span> <span class="nav-text">责任链模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#责任链模式的定义"><span class="nav-number">5.8.1.</span> <span class="nav-text">责任链模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#责任链模式的使用场景"><span class="nav-number">5.8.2.</span> <span class="nav-text">责任链模式的使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#责任链模式的-UML-类图"><span class="nav-number">5.8.3.</span> <span class="nav-text">责任链模式的 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#责任链模式的简单实现"><span class="nav-number">5.8.4.</span> <span class="nav-text">责任链模式的简单实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#责任链模式实战"><span class="nav-number">5.8.5.</span> <span class="nav-text">责任链模式实战</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-6"><span class="nav-number">5.8.6.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解释器模式"><span class="nav-number">5.9.</span> <span class="nav-text">解释器模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#解释器模式的定义"><span class="nav-number">5.9.1.</span> <span class="nav-text">解释器模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#解释器模式的使用场景"><span class="nav-number">5.9.2.</span> <span class="nav-text">解释器模式的使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#解释器模式的-UML-类图"><span class="nav-number">5.9.3.</span> <span class="nav-text">解释器模式的 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-7"><span class="nav-number">5.9.4.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#命令模式"><span class="nav-number">5.10.</span> <span class="nav-text">命令模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#命令模式的定义"><span class="nav-number">5.10.1.</span> <span class="nav-text">命令模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#命令模式的使用场景"><span class="nav-number">5.10.2.</span> <span class="nav-text">命令模式的使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#命令模式的-UML-类图"><span class="nav-number">5.10.3.</span> <span class="nav-text">命令模式的 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#命令模式的简单实现"><span class="nav-number">5.10.4.</span> <span class="nav-text">命令模式的简单实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-8"><span class="nav-number">5.10.5.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#观察者模式"><span class="nav-number">5.11.</span> <span class="nav-text">观察者模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#观察者模式的定义"><span class="nav-number">5.11.1.</span> <span class="nav-text">观察者模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#观察者模式的使用场景"><span class="nav-number">5.11.2.</span> <span class="nav-text">观察者模式的使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#观察者模式的-UML-类图"><span class="nav-number">5.11.3.</span> <span class="nav-text">观察者模式的 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#观察者模式实战"><span class="nav-number">5.11.4.</span> <span class="nav-text">观察者模式实战</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-9"><span class="nav-number">5.11.5.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#备忘录模式"><span class="nav-number">5.12.</span> <span class="nav-text">备忘录模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#备忘录模式的介绍"><span class="nav-number">5.12.1.</span> <span class="nav-text">备忘录模式的介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#备忘录模式的定义"><span class="nav-number">5.12.2.</span> <span class="nav-text">备忘录模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#备忘录模式的-UML-类图"><span class="nav-number">5.12.3.</span> <span class="nav-text">备忘录模式的 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#备忘录模式的简单实例"><span class="nav-number">5.12.4.</span> <span class="nav-text">备忘录模式的简单实例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-10"><span class="nav-number">5.12.5.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#迭代器模式"><span class="nav-number">5.13.</span> <span class="nav-text">迭代器模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#迭代器模式的介绍"><span class="nav-number">5.13.1.</span> <span class="nav-text">迭代器模式的介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#迭代器模式的定义"><span class="nav-number">5.13.2.</span> <span class="nav-text">迭代器模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#迭代器模式的-UML-类图"><span class="nav-number">5.13.3.</span> <span class="nav-text">迭代器模式的 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-11"><span class="nav-number">5.13.4.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模板方法模式"><span class="nav-number">5.14.</span> <span class="nav-text">模板方法模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#模板方法模式的介绍"><span class="nav-number">5.14.1.</span> <span class="nav-text">模板方法模式的介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#模板方法模式的定义"><span class="nav-number">5.14.2.</span> <span class="nav-text">模板方法模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#模板方法模式的使用场景"><span class="nav-number">5.14.3.</span> <span class="nav-text">模板方法模式的使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#模板方法模式的-UML-类图"><span class="nav-number">5.14.4.</span> <span class="nav-text">模板方法模式的 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-12"><span class="nav-number">5.14.5.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#访问者模式"><span class="nav-number">5.15.</span> <span class="nav-text">访问者模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#访问者模式的介绍"><span class="nav-number">5.15.1.</span> <span class="nav-text">访问者模式的介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#访问者模式的定义"><span class="nav-number">5.15.2.</span> <span class="nav-text">访问者模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#访问者模式的使用场景"><span class="nav-number">5.15.3.</span> <span class="nav-text">访问者模式的使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#访问者模式的-UML-类图"><span class="nav-number">5.15.4.</span> <span class="nav-text">访问者模式的 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#访问者模式的简单示例"><span class="nav-number">5.15.5.</span> <span class="nav-text">访问者模式的简单示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-13"><span class="nav-number">5.15.6.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#中介者模式"><span class="nav-number">5.16.</span> <span class="nav-text">中介者模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#中介者模式的介绍"><span class="nav-number">5.16.1.</span> <span class="nav-text">中介者模式的介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#中介者模式的定义"><span class="nav-number">5.16.2.</span> <span class="nav-text">中介者模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#中介者模式的使用场景"><span class="nav-number">5.16.3.</span> <span class="nav-text">中介者模式的使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#中介者模式的-UML-类图"><span class="nav-number">5.16.4.</span> <span class="nav-text">中介者模式的 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#中介者模式的简单实现"><span class="nav-number">5.16.5.</span> <span class="nav-text">中介者模式的简单实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#中介者模式实战"><span class="nav-number">5.16.6.</span> <span class="nav-text">中介者模式实战</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-14"><span class="nav-number">5.16.7.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#代理模式"><span class="nav-number">5.17.</span> <span class="nav-text">代理模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#代理模式的定义"><span class="nav-number">5.17.1.</span> <span class="nav-text">代理模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#代理模式的使用场景"><span class="nav-number">5.17.2.</span> <span class="nav-text">代理模式的使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#代理模式的-UML-类图"><span class="nav-number">5.17.3.</span> <span class="nav-text">代理模式的 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#代理模式的简单实现"><span class="nav-number">5.17.4.</span> <span class="nav-text">代理模式的简单实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-15"><span class="nav-number">5.17.5.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#组合模式"><span class="nav-number">5.18.</span> <span class="nav-text">组合模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#组合模式的介绍"><span class="nav-number">5.18.1.</span> <span class="nav-text">组合模式的介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#组合模式的定义"><span class="nav-number">5.18.2.</span> <span class="nav-text">组合模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#组合模式的使用场景"><span class="nav-number">5.18.3.</span> <span class="nav-text">组合模式的使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#组合模式的-UML-类图"><span class="nav-number">5.18.4.</span> <span class="nav-text">组合模式的 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#组合模式的简单实现"><span class="nav-number">5.18.5.</span> <span class="nav-text">组合模式的简单实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-16"><span class="nav-number">5.18.6.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#适配器模式"><span class="nav-number">5.19.</span> <span class="nav-text">适配器模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#适配器模式的介绍"><span class="nav-number">5.19.1.</span> <span class="nav-text">适配器模式的介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#适配器模式的定义"><span class="nav-number">5.19.2.</span> <span class="nav-text">适配器模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#适配器模式的使用场景"><span class="nav-number">5.19.3.</span> <span class="nav-text">适配器模式的使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#适配器模式的-UML-类图"><span class="nav-number">5.19.4.</span> <span class="nav-text">适配器模式的 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#适配器模式的简单示例"><span class="nav-number">5.19.5.</span> <span class="nav-text">适配器模式的简单示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-17"><span class="nav-number">5.19.6.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#装饰模式"><span class="nav-number">5.20.</span> <span class="nav-text">装饰模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#装饰模式的介绍"><span class="nav-number">5.20.1.</span> <span class="nav-text">装饰模式的介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#装饰模式的定义"><span class="nav-number">5.20.2.</span> <span class="nav-text">装饰模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#装饰模式的使用场景"><span class="nav-number">5.20.3.</span> <span class="nav-text">装饰模式的使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#装饰模式的-UML-类图"><span class="nav-number">5.20.4.</span> <span class="nav-text">装饰模式的 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#装饰模式实战"><span class="nav-number">5.20.5.</span> <span class="nav-text">装饰模式实战</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-18"><span class="nav-number">5.20.6.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#享元模式"><span class="nav-number">5.21.</span> <span class="nav-text">享元模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#享元模式的介绍"><span class="nav-number">5.21.1.</span> <span class="nav-text">享元模式的介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#享元模式的定义"><span class="nav-number">5.21.2.</span> <span class="nav-text">享元模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#享元模式的使用场景"><span class="nav-number">5.21.3.</span> <span class="nav-text">享元模式的使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#享元模式的-UML-类图"><span class="nav-number">5.21.4.</span> <span class="nav-text">享元模式的 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#享元模式的简单示例"><span class="nav-number">5.21.5.</span> <span class="nav-text">享元模式的简单示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-19"><span class="nav-number">5.21.6.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#外观模式"><span class="nav-number">5.22.</span> <span class="nav-text">外观模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#外观模式的介绍"><span class="nav-number">5.22.1.</span> <span class="nav-text">外观模式的介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#外观模式的定义"><span class="nav-number">5.22.2.</span> <span class="nav-text">外观模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#外观模式的使用场景"><span class="nav-number">5.22.3.</span> <span class="nav-text">外观模式的使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#外观模式的-UML-类图"><span class="nav-number">5.22.4.</span> <span class="nav-text">外观模式的 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-20"><span class="nav-number">5.22.5.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#桥接模式"><span class="nav-number">5.23.</span> <span class="nav-text">桥接模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#桥接模式的介绍"><span class="nav-number">5.23.1.</span> <span class="nav-text">桥接模式的介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#桥接模式的定义"><span class="nav-number">5.23.2.</span> <span class="nav-text">桥接模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#桥接模式的使用场景"><span class="nav-number">5.23.3.</span> <span class="nav-text">桥接模式的使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#桥接模式的-UML-类图"><span class="nav-number">5.23.4.</span> <span class="nav-text">桥接模式的 UML 类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#桥接模式实战"><span class="nav-number">5.23.5.</span> <span class="nav-text">桥接模式实战</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结-21"><span class="nav-number">5.23.6.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#叁-MVC-与-MVP-模式"><span class="nav-number">6.</span> <span class="nav-text">叁 MVC 与 MVP 模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MVC"><span class="nav-number">6.1.</span> <span class="nav-text">MVC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MVP"><span class="nav-number">6.2.</span> <span class="nav-text">MVP</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kofe</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>








        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: true,
        notify: true,
        appId: 'STGXfYUEVVq1AoccxhumXjsB-gzGzoHsz',
        appKey: 'jbgIHEzUigo8apYgTon6xXE8',
        placeholder: '写下你的评论...',
        avatar:'hide',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("STGXfYUEVVq1AoccxhumXjsB-gzGzoHsz", "jbgIHEzUigo8apYgTon6xXE8");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
