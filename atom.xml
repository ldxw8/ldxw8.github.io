<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Kofe</title>
  
  <subtitle>Reading / Project / Paper</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.kofes.cn/"/>
  <updated>2018-07-30T01:45:00.133Z</updated>
  <id>http://www.kofes.cn/</id>
  
  <author>
    <name>Kofe</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>彩蛋 -  MacOS VMware 安装 OpenWrt ( 从软路由到硬路由的过渡 )</title>
    <link href="http://www.kofes.cn/2018/07/Vmware-OpenWrt.html"/>
    <id>http://www.kofes.cn/2018/07/Vmware-OpenWrt.html</id>
    <published>2018-07-26T06:52:45.000Z</published>
    <updated>2018-07-30T01:45:00.133Z</updated>
    
    <content type="html"><![CDATA[<p>配置一台 VMware 上运作的路由系统，启发式从软路由到硬路由的进阶之旅。</p><a id="more"></a><h2 id="更新进度"><a href="#更新进度" class="headerlink" title="更新进度"></a>更新进度</h2><ul><li>2018.07.25：完成初稿；</li><li>2018.07.26：安装 OpenWrt 系统，配置 MySQL、FTP 插件，并形成文档；</li><li>2018.07.27：购置路由开发板，了解系统版本支持信息；</li><li>2018.07.29：鉴于之前的理解有偏差，修正固件系统章节的内容；</li></ul><h2 id="固件系统"><a href="#固件系统" class="headerlink" title="固件系统"></a>固件系统</h2><h3 id="OpenWrt"><a href="#OpenWrt" class="headerlink" title="OpenWrt"></a>OpenWrt</h3><h4 id="支持文档"><a href="#支持文档" class="headerlink" title="支持文档"></a>支持文档</h4><ul><li><a href="https://openwrt.org/" target="_blank" rel="noopener">官方使用指南 (英文)</a> | <a href="https://openwrt.org/zh/start" target="_blank" rel="noopener">官方使用指南 (中文)</a></li><li><p><a href="https://openwrt.org/toh/views/toh_fwdownload" target="_blank" rel="noopener">硬件支持表格</a>：查阅硬件支持表格，若您的硬件已被支持，可参考官方的 OpenWrt <a href="https://openwrt.org/docs/guide-quick-start/begin_here" target="_blank" rel="noopener">安装教程</a>，开始安装。 </p><blockquote><p>在表格顶部的白色区域可以输入筛选标准进行条件筛选。若找到目标型号后， <code>Firmware OpenWrt Install URL</code> 列中存放的是固件的最新版本下载地址。</p></blockquote></li><li><p><a href="https://openwrt.org/faq/start" target="_blank" rel="noopener">常见问题解答</a>：包含常见问题，安装前、安装后问题，无线网络问题等。</p></li></ul><h4 id="固件版本"><a href="#固件版本" class="headerlink" title="固件版本"></a>固件版本</h4><p>固件版本：每种型号的路由一般会提供多种版本的固件 $^{[8]}$。</p><ul><li><code>XXX-factory</code> / <code>XXX-kernel</code>：对应于内核的固件，必须把它刷入一个OEM (原厂) 固件。</li><li><code>XXX-jffs2</code> / <code>XXX-squashfs</code>：对应于文件系统的固件。这两种不同格式的固件区别在于 $^{[9]}$：<ul><li><code>Squashfs</code>：安装后占用一定空间来存放系统的一些必要文件，这些文件都只是可读的，其作用是帮助恢复系统；</li><li><code>Jffs2</code>：而 Jffs2 则不会存储这些文件，好处在于节省了空间。一般推荐使用 Squashfs 格式的固件，以方便恢复系统到初始状态。</li></ul></li><li><code>XXX-sysupgrade</code>：对应于完整的固件，用于固件升级，要求您的设备必须已安装较旧的 LEDE 或 OpenWrt 固件。</li></ul><blockquote><p>固件的后缀名也有很多种，例如 <code>xxx.img</code>、<code>xxx.bin</code>、<code>xxx.trx</code> 等，虽然整体内容是相同的，但它们的文件头的信息是有差异的 $^{[10]}$。</p></blockquote><h4 id="烧写方式"><a href="#烧写方式" class="headerlink" title="烧写方式"></a>烧写方式</h4><p>烧写方式：根据不同的路由硬件环境，选择不同的方式将固件烧写进路由。</p><ul><li>OEM (原厂) 管理界面：完整安装 OpenWrt / LEDE / Padavan 设备。</li><li><a href="https://openwrt.org/docs/guide-quick-start/sysupgrade.luci" target="_blank" rel="noopener">LUCI ( Web 管理界面 )</a>：升级现有的 OpenWrt / LEDE 设备。(Pavadan 有自己的 Web 管理界面)</li><li>Bootloader 引导加载器：路由系统里常见有 Breed、U-Boot。即开机初始化时加载的最小系统，用于识别基础硬件和设置环境信息，以引导方式烧写固件 ( 集成 HTTP、TFTP 协议 )。</li></ul><h3 id="Padavan"><a href="#Padavan" class="headerlink" title="Padavan"></a>Padavan</h3><h4 id="支持文档-1"><a href="#支持文档-1" class="headerlink" title="支持文档"></a>支持文档</h4><ul><li>Padavan：<a href="http://p4davan.80x86.io/" target="_blank" rel="noopener">荒野无灯.Padavan</a> | <a href="https://bitbucket.org/padavan/rt-n56u/overview" target="_blank" rel="noopener">Bitbucket.Padavan</a></li></ul><h2 id="软路由篇"><a href="#软路由篇" class="headerlink" title="软路由篇"></a>软路由篇</h2><p>了解了相关路由系统的事宜后，找准定位，你是配置用来开发 ( 推荐 OpenWrt ) 的，还是家用 ( 推荐 Pavadan ) 等，即选择一款迎合需求的路由开始你的 “改造旅程”。</p><p>软路篇即以 VMware 为例展开实践，而本文主要是记录实践过程中的基本过程和要点。</p><h3 id="固件信息"><a href="#固件信息" class="headerlink" title="固件信息"></a>固件信息</h3><ul><li><p>系统版本：<a href="http://archive.openwrt.org/chaos_calmer/15.05.1/x86/" target="_blank" rel="noopener">OpenWrt-15.05.1-x86</a></p><blockquote><p>虚拟机上运行的，我们选择 x86 架构的即可 ( x64 架构也是可以的 )。</p></blockquote></li><li><p>固件版本：<a href="http://archive.openwrt.org/chaos_calmer/15.05.1/x86/generic/openwrt-15.05.1-x86-generic-combined-squashfs.img" target="_blank" rel="noopener">openwrt-15.05.1-x86-generic-combined-squashfs</a></p></li></ul><h3 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h3><p>此章节是基于 MacOS 的 VMware 展开实践的，WIndows 版本可自行百度、谷歌，或者参考下述文章 $^{[1,2]}$。</p><p>当然，OpenWrt 安装步骤可参考引用文章 $^{[1,2,7]}$，这里不详细阐述，仅对核心的配置部分进行说明。 </p><ul><li><p>本机 VMware 得配置两张虚拟网卡，暂且命名为：</p><ul><li>网络适配器 1 (MAC 地址)：<code>00:50:56:28:EF</code></li><li><p>网络适配器 2 (MAC 地址)：<code>00:50:56:3B:0E:CD</code></p><blockquote><p>MAC 地址可让我们判断 OpenWrt 中外网接口 <code>WAN</code> 和内网接口 <code>LAN</code> 口的映射情况。</p></blockquote></li></ul></li><li><p>在 OpenWrt 默认配置中，外网接口 WAN 对应于 Eth1，内网接口 LAN 对应于 Eth0，即：</p><ul><li>外网接口 WAN：<code>Eth1</code></li><li><p>内网接口 LAN：<code>Eth0</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 如何查看虚拟主机的网卡与外网、内外接口的关系：</span><br><span class="line">   </span><br><span class="line"><span class="meta">#</span> OpenWrt 下执行下述代码：</span><br><span class="line"><span class="meta">#</span> 查看网卡的具体信息，即可以查到虚拟机网卡 MAC 地址</span><br><span class="line">ifconfig | more</span><br><span class="line"><span class="meta">#</span> 查看网络配置信息，即可查看外网、内外接口 (Ethx) 与虚拟主机的网卡的绑定情况</span><br><span class="line">cat /etc/config/network</span><br></pre></td></tr></table></figure></li></ul></li><li><p>在 OpenWrt 中，配置外网、内外接口 (Ethx) 信息：</p><blockquote><p>提示：使用 WAN 口的网卡桥接到宿主机的网卡即可访问外网。</p></blockquote>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 环路地址，不用配置</span><br><span class="line">config interface 'loopback'</span><br><span class="line">   option ifname 'lo'</span><br><span class="line">option ipaddr '127.0.0.1'</span><br><span class="line">option netmask '255.255.255.0'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 内网接口</span><br><span class="line">config interface 'lan'</span><br><span class="line">option ifname 'eth0'</span><br><span class="line">option type 'bridge'</span><br><span class="line">option proto 'static'</span><br><span class="line">option ipaddr '192.168.1.1'</span><br><span class="line">option netmask '255.255.255.0'</span><br><span class="line">option ip6assign '60'</span><br><span class="line">   </span><br><span class="line"><span class="meta">#</span> 外网接口</span><br><span class="line">config interface 'wan'</span><br><span class="line">option ifname 'eth1'</span><br><span class="line">option proto 'dhcp'</span><br><span class="line">   </span><br><span class="line"><span class="meta">#</span> 其他配置默认，不作修改</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>关于配置中的一些批注：</p></blockquote><ul><li>Note.01：配置完成后，记得重启下网络服务 <code>./etc/init.d/network restart</code> 。</li><li><p>Note.02：若需要让宿主机访问本 OpenWrt 系统，你可以配置 (关闭) 防火墙。</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 让防火墙开机不自启</span><br><span class="line">./etc/init.d/firewall disable</span><br><span class="line"><span class="meta">#</span> 关闭防火墙服务</span><br><span class="line">./etc/init.d/firewall stop</span><br></pre></td></tr></table></figure></li></ul><ul><li>本机 OpenWrt 信息：<ul><li>本机地址：<code>192.168.0.100</code></li><li>路由地址：<code>192.168.0.x (192.168.0.161)</code> — 与宿主机在同一局域网就对了。</li><li>路由管理用户：<code>root</code></li><li>路由管理密码：<code>123321</code></li></ul></li></ul><h2 id="硬路由篇"><a href="#硬路由篇" class="headerlink" title="硬路由篇"></a>硬路由篇</h2><p>选择一款合适的路由器很重要。这里瞎折腾太久，很多产品不太满意 ( 价格贵 )，最后选择了定制的产品。路由开发板：基于 Newifi D1 板件定制 ( 芯片：MT7621A / 闪存：32M / 内存：256MB )。</p><p>当然，你对路由器刷固件，固件版本一定要配对你的设备，具体细节请查阅：<a href="https://openwrt.org/toh/views/toh_fwdownload" target="_blank" rel="noopener">设备支持信息表单</a></p><blockquote><p>值得注意的是，你需要对下载的固件文件进行 <a href="https://openwrt.org/docs/guide-quick-start/verify_firmware_checksum" target="_blank" rel="noopener">MD5/SHA256 验证</a>，以防止文件破损或其他原因，使得你的路由器 <code>变砖</code> ！</p></blockquote><h3 id="固件信息-1"><a href="#固件信息-1" class="headerlink" title="固件信息"></a>固件信息</h3><ul><li>OpenWrt<ul><li>系统版本：<a href="http://downloads.openwrt.org/releases/17.01.5/targets/ramips/mt7621/" target="_blank" rel="noopener">LEDE 17.01.5 Ramips MT7621</a></li><li>固件版本：基于 Breed / Uboot 刷完整固件：<a href="http://downloads.openwrt.org/releases/17.01.5/targets/ramips/mt7621/lede-17.01.5-ramips-mt7621-newifi-d1-initramfs-kernel.bin" target="_blank" rel="noopener">newifi-d1-initramfs-kernel.bin</a></li></ul></li><li>Padavan<ul><li>固件版本：<a href="http://p4davan.80x86.io/download/" target="_blank" rel="noopener">荒野无灯.Padavan.NEWIFI-D1</a></li></ul></li></ul><h3 id="安装过程-1"><a href="#安装过程-1" class="headerlink" title="安装过程"></a>安装过程</h3><p>此章节是基于 <code>Newifi D1 (MT7621A)</code>  板件定制的路由开发板展开实践的，采用 Breed 形式引导刷固件。</p><h2 id="拓展功能"><a href="#拓展功能" class="headerlink" title="拓展功能"></a>拓展功能</h2><ul><li><p>关于插件的批注：</p><ul><li>默认情况，插件会安装在：<code>/etc/init.d/</code> 目录下；</li><li><p>其相应的配置文件放置在： <code>/etc/config/</code> 目录下。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">etc</span><br><span class="line">├── config# 配置目录</span><br><span class="line">└── init.d# 插件目录</span><br><span class="line">└── xxx.cnf# 有些插件的配置文件在根目录下</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="安装-FTP-服务"><a href="#安装-FTP-服务" class="headerlink" title="安装 FTP 服务"></a>安装 FTP 服务</h3><ul><li><p>快速引导：<a href="https://wiki.openwrt.org/doc/howto/ftp.overview" target="_blank" rel="noopener">官方指南</a></p><ul><li>可通过 Web 交互界面安装或者命令行安装 <code>VSFTPD</code>。</li><li>安装完成后，即可使用；<code>ftp://Your route IP adress</code>。</li><li><p>配置文件位于 <code>/etc/vsftpd.conf</code>，配置可参考：</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">chown_uploads=YES       # 上传后更改文件所属权</span><br><span class="line">chown_username=root     # 上传后更改文件所属权</span><br><span class="line">ftp_username=nobody     # 定义匿名用户名</span><br><span class="line">anonymous_enable=YES            # 允许匿名用户访问</span><br><span class="line">anon_upload_enable=YES          # 允许匿名上传</span><br><span class="line">anon_mkdir_write_enable=YES     # 允许匿名创建目录</span><br><span class="line">anon_root=/mnt/anymous          # 匿名用户根目录</span><br><span class="line">anon_max_rate=512000            # 匿名用户限速</span><br><span class="line">local_enable=YES    # 允许本地用户登录 (必须)</span><br><span class="line">local_root=/mnt/ftp # 本地用户的默认访问路径 (必须)</span><br><span class="line">write_enable=YES    # 允许上传</span><br><span class="line">local_umask=022     # 允许上传</span><br><span class="line">check_shell=NO</span><br></pre></td></tr></table></figure></li></ul></li></ul><ul><li><p>命令操作细节如下：</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 第一次使用 opkg 需更新资源</span><br><span class="line">opkg update</span><br><span class="line">opkg install vsftpd</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> FTP 服务操作</span><br><span class="line">/etc/init.d/vsftpd start        # Start the service</span><br><span class="line">/etc/init.d/vsftpd stop         # Stop the service</span><br><span class="line">/etc/init.d/vsftpd restart      # Restart the service</span><br><span class="line">/etc/init.d/vsftpd reload       # Reload configuration files or restart if that fails</span><br><span class="line">/etc/init.d/vsftpd enable       # Enable service autostart)</span><br><span class="line">/etc/init.d/vsftpd disable      # Disable service autostart)</span><br><span class="line">   </span><br><span class="line"><span class="meta">#</span> 附：修改文件权限</span><br><span class="line">chown root /mnt/ftp</span><br><span class="line">chmod 666 /mnt/ftp</span><br></pre></td></tr></table></figure></li></ul><ul><li>当然，除了 FTP 服务外，还有 Samba 服务，具体配置可参考 [4] 。</li></ul><h3 id="安装-Samba-服务"><a href="#安装-Samba-服务" class="headerlink" title="安装 Samba 服务"></a>安装 Samba 服务</h3><h3 id="安装-Shadowsocks"><a href="#安装-Shadowsocks" class="headerlink" title="安装 Shadowsocks"></a>安装 Shadowsocks</h3><blockquote><p>科学上网 (FQ)，践行社会主义核心价值观。</p></blockquote><h3 id="安装-MySQL"><a href="#安装-MySQL" class="headerlink" title="安装 MySQL"></a>安装 MySQL</h3><ul><li><p>通过命令行安装：</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 第一次使用 opkg 需更新资源</span><br><span class="line">opkg update</span><br><span class="line">opkg install mysql-server</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>设置数据库数据存储目录：</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 配置 Mysql 数据库的存储目录</span><br><span class="line">cd /mnt</span><br><span class="line">mkdir -p /mysql/data /mysql/tmp</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 当然也可把数据放到 U 盘或 SD 卡上</span><br><span class="line"><span class="meta">#</span> 详细教程可查看 USB 挂载相关教程，参考 [6]</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>配置 MySql：</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br><span class="line"><span class="meta">#</span> 找到 datadir 和 tmpdir 字段，并修改其值</span><br><span class="line">datadir = /mnt/mysql/data</span><br><span class="line">tmpdir = /mnt/mysql/tmp</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 给文件夹赋予权限</span><br><span class="line">chmod 750 -R mysql/data mysql/tmp</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 找到 bind-address，修改为 0.0.0.0，以允许远程访问</span><br><span class="line">bind-address = 0.0.0.0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>  记得保存再退出</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 初始化建库 ( Database )</span><br><span class="line">/usr/bin/mysql_install_db --force</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>启动 MySQL 数据库：</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 启动 mysql 守护进程</span><br><span class="line">/etc/init.d/mysqld enable# 开启自启动</span><br><span class="line">/etc/init.d/mysqld start# 启动 MySQL 服务</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 当重新修改配置时，需要重启 Mysql 服务，可这样处理</span><br><span class="line"><span class="meta">#</span> killall mysqld</span><br><span class="line"><span class="meta">#</span> /etc/init.d/mysqld start</span><br><span class="line"><span class="meta">#</span> 或者重新加载配置信息</span><br><span class="line"><span class="meta">#</span> /etc/init.d/mysqld reload</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>使用 MySQL 数据库和修改账户密码：</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 提示输入密码，进入即可数据库操作</span><br><span class="line">mysql -u root -p</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 当然，刚配置的 MySQL 用户名账号密码不是还没有配置么？</span><br><span class="line"><span class="meta">#</span> 故我们需要以非授权的方式进入 MySQL 进行权限设置</span><br><span class="line">/etc/init.d/mysqld --skip-grant &amp;</span><br><span class="line">mysql -u root</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 注意：命名行里面的形式已经变成【mysql&gt;】提示符，即可继续下步操作</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 显示数据库，选择 mysql 数据库</span><br><span class="line">SHOW databases;</span><br><span class="line">USE mysql;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 修改账户连接权限：</span><br><span class="line">UPDATE user </span><br><span class="line">SET host = '%', password = PASSWORD("Your Password")</span><br><span class="line">WHERE user = 'root';</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> (非必要操作) 当你的数据库需要远程访问时，你还需要建立一个新用户</span><br><span class="line"><span class="meta">#</span> grant all privileges on *.* to  kofe@"%"</span><br><span class="line"><span class="meta">#</span> identified by "pwd123"</span><br><span class="line"><span class="meta">#</span> with grant option;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Grant 是授权命令</span><br><span class="line"><span class="meta">#</span> 其中 kofe 是我们连接用的用户名、pwd123 是连接密码</span><br><span class="line"><span class="meta">#</span> @ 后接的 “%” 通用符表示允许各 host 操作</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 清理数据库缓存</span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 退出 mysql</span><br><span class="line">quit;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 重启 Mysql 服务</span><br><span class="line">/etc/init.d/mysqld restart</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 此时重新执行 mysql -u root -p</span><br><span class="line"><span class="meta">#</span> 输入你修改过后的密码能进入 【mysql&gt;】模式即成功。</span><br></pre></td></tr></table></figure></li><li><p>MySQL 数据库管理软件推荐： <a href="http://www.sequelpro.com/" target="_blank" rel="noopener">Sequel Pro</a> 或者 <a href="https://dbeaver.io/download/" target="_blank" rel="noopener">Dbeaver</a>。</p></li></ul><h3 id="安装-Python"><a href="#安装-Python" class="headerlink" title="安装 Python"></a>安装 Python</h3><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li>[1] <a href="https://www.cnblogs.com/codeinsight/p/openwrt_vmware.html" target="_blank" rel="noopener">Code Insight. HowTo 虚拟机上尝试 OpenWrt 开源路由. cnblogs.com</a></li><li>[2] <a href="https://github.com/luoqeng/OpenWrt-on-VMware" target="_blank" rel="noopener">luoqeng. OpenWrt-on-VMware. github.com</a></li><li>[3] <a href="https://blog.csdn.net/whatday/article/details/78920494" target="_blank" rel="noopener">whatday. 路由、交换机等嵌入设备软件包管理 OPKG. csdn.net</a></li><li>[4] <a href="http://www.cnblogs.com/double-win/p/3848797.html" target="_blank" rel="noopener">Double WIn. Samba 服务 &amp; vsFTP 服务. cnblogs.com</a></li><li>[5] <a href="http://www.cnblogs.com/double-win/p/3866189.html" target="_blank" rel="noopener">Double Win. MySQL配置. cnblogs.com</a></li><li>[6] <a href="http://www.cnblogs.com/double-win/p/3841801.html" target="_blank" rel="noopener">Double Win. USB挂载 &amp; U盘启动. cnblogs.com</a></li><li>[7] <a href="http://www.cnblogs.com/double-win/p/3888399.html" target="_blank" rel="noopener">Double Win. Openwrt 项目开发笔记. cnblogs.com</a></li><li>[8] <a href="https://openwrt.org/zh-cn/doc/howto/obtain.firmware.download" target="_blank" rel="noopener">OpenWrt. Howtos 下载固件中文说册. openwrt.org</a></li><li>[9] <a href="https://blog.csdn.net/qinpeng_zbdx/article/details/8570488" target="_blank" rel="noopener">Keep Silence. TP-LINK WR703N 刷 OpenWrt 及配置、安装插件. csdn.net</a></li><li>[10] <a href="https://openwrt.org/start?id=docs/techref/header" target="_blank" rel="noopener">OpenWrt. TRX vs. TRX2 vs. BIN. openwrt.org</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;配置一台 VMware 上运作的路由系统，启发式从软路由到硬路由的进阶之旅。&lt;/p&gt;
    
    </summary>
    
      <category term="Technique" scheme="http://www.kofes.cn/categories/Technique/"/>
    
    
      <category term="MAC" scheme="http://www.kofes.cn/tags/MAC/"/>
    
      <category term="OpenWrt" scheme="http://www.kofes.cn/tags/OpenWrt/"/>
    
      <category term="Vmware" scheme="http://www.kofes.cn/tags/Vmware/"/>
    
      <category term="mysql" scheme="http://www.kofes.cn/tags/mysql/"/>
    
      <category term="python" scheme="http://www.kofes.cn/tags/python/"/>
    
      <category term="路由器" scheme="http://www.kofes.cn/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>框架 - Java EE 之 SSH 框架配置与使用</title>
    <link href="http://www.kofes.cn/2018/07/J2EE-SSH-SSI-1.html"/>
    <id>http://www.kofes.cn/2018/07/J2EE-SSH-SSI-1.html</id>
    <published>2018-07-24T06:48:22.000Z</published>
    <updated>2018-08-05T15:12:44.759Z</updated>
    
    <content type="html"><![CDATA[<h2 id="序言"><a href="#序言" class="headerlink" title="序言"></a>序言</h2><p>本文章主要围绕 J2EE 中 SSH ( Spring、Struts、Hibernate ) 框架的配置以及使用问题展开学习的，最终目的是输出可复用的版本，以供后续的项目复用。当然，学习和配置的过程难免有不恰当或错误之处，还望朋友指出、斧正。</p><h2 id="更新进度"><a href="#更新进度" class="headerlink" title="更新进度"></a>更新进度</h2><ul><li>2018.07.17：完成初稿，IDE 搭建、框架初识章节；</li><li>2018.07.18：完成 SSH 框架 Hibernate 部分的初稿；</li><li>2018.07.20：更新 SSH 框架 Hibernate 部分内容；</li><li>2018.07.28：完成 SSH 框架 Spring 部分的初稿；</li><li>2018.07.31：更新 SSH 框架 Spring 部分内容；</li><li>2018.08.03：整合 SSH 框架；</li></ul><h2 id="教学视频"><a href="#教学视频" class="headerlink" title="教学视频"></a>教学视频</h2><ul><li><a href="https://www.bilibili.com/video/av14839030" target="_blank" rel="noopener">黑马程序员. J2EE 进阶. 60 集精通 Spring 框架. 2017. bilibili.com</a></li><li><a href="https://www.bilibili.com/video/av13748042" target="_blank" rel="noopener">黑马程序员. J2EE 进阶. Struts2 框架精品教程. 2017. bilibili.com</a></li><li><p><a href="https://www.bilibili.com/video/av14626440" target="_blank" rel="noopener">黑马程序员. J2EE 进阶. 4 天精通 Hibernate 框架. 2017. bilibili.com</a></p><blockquote><p>本框架的学习笔记是基于此系列教学视频所得的。</p></blockquote></li></ul><a id="more"></a><h2 id="IDE-搭建"><a href="#IDE-搭建" class="headerlink" title="IDE 搭建"></a>IDE 搭建</h2><ul><li>Step.01：安装 JDK；</li><li>Step.02：安装 IDE ( <code>IntelliJ Idea</code> / Eclipse / MyEclipse )；</li><li>Step.03：配置 Tomcat 环境；</li><li><p>Step.04：配置 MySQL / SQL Server 数据库；</p><ul><li>命名规范：数据库 <code>db_dbname</code>；数据表 <code>t_tablename</code>；属性 <code>attribute</code></li><li><p>访问外网：若在虚拟机或者本机测试，让数据库允许外网访问，注意得关闭防火墙或添加规则允许某端口的访问权限。</p><blockquote><p>Case.01：本机和服务器端互相 <code>Ping</code> 对方 IP，以检验网络是否畅通、是否拒绝访问。<br>Case.02：若网络畅通、没有拒绝访问，还要留意对应端口是否有权限访问，通过 <code>nc -vz IP 端口</code>  检验，返回 <code>Succeeded</code> 即成功。  </p></blockquote></li><li><p>数据库权限：若 MySQL 通过命令安装，需特别注意的权限问题，即账号和密码是默认配置的，用户可自行修改，具体修改细节见参考 [6] - [8] 中的方法。</p></li></ul></li><li><p>Step.05：以 IntelliJ Idea IDE 为参考搭建框架，参考 [1] - [3] 中的方法；</p><ul><li>[1] - [3] 的搭建方法都是 <code>导 Jar 包形式</code>，但千万要注意相对应的 Jar 包是否已经下载到本地。</li><li>当然，推荐 <code>Maven</code> 管理项目，即它是添加依赖库的方式配置环境的，下述的内容也是基于 Maven 构建框架。</li></ul></li></ul><h2 id="版本信息"><a href="#版本信息" class="headerlink" title="版本信息"></a>版本信息</h2><ul><li>框架版本：<ul><li>Struts：2.3.x</li><li>Spring：5.0.x</li><li>Hibernate：5.2.x</li></ul></li><li>其他组件：<ul><li>MySQL：5.7.x / SQL Server：2008 R2</li><li>Tomcat：9.0.x</li><li>Maven：3.3.9</li><li>JDK：1.8</li></ul></li><li><p>构建框架，还需要相关依赖库 ( Jar 包 )，详细请参阅 <a href="#ioC-入门案例">ioC 入门案例</a>。</p><blockquote><p>为便于你下载 Jar 包或校对依赖是否齐全，具体地，以下列举了 SSH 框架所需要的依赖库。</p></blockquote></li></ul><div class="table-container"><table><thead><tr><th style="text-align:left">Spring</th><th style="text-align:left">Struts2</th><th style="text-align:left">Hibernate</th></tr></thead><tbody><tr><td style="text-align:left">spring-core</td><td style="text-align:left">asm</td><td style="text-align:left">antlr</td></tr><tr><td style="text-align:left">spring-beans</td><td style="text-align:left">asm-commons</td><td style="text-align:left">dom4j</td></tr><tr><td style="text-align:left">spring-context</td><td style="text-align:left">asm-tree</td><td style="text-align:left">geronimo-jta_1.1_spec</td></tr><tr><td style="text-align:left">spring-expression</td><td style="text-align:left">commons-fileupload</td><td style="text-align:left">hibernate-commons-annotation</td></tr><tr><td style="text-align:left">log4j</td><td style="text-align:left">commons-io</td><td style="text-align:left">hibernate-core</td></tr><tr><td style="text-align:left">commons-logging</td><td style="text-align:left">commons-lang3</td><td style="text-align:left">hibernate-jpa</td></tr><tr><td style="text-align:left">spring-web (整合 Web)</td><td style="text-align:left">freemarker</td><td style="text-align:left">jandex</td></tr><tr><td style="text-align:left">spring-aop ( 整合 Aop)</td><td style="text-align:left">javassist</td><td style="text-align:left">javassist</td></tr><tr><td style="text-align:left">spring-aspect ( 整合 Aop)</td><td style="text-align:left">log4j-api</td><td style="text-align:left">jboss-logging</td></tr><tr><td style="text-align:left">aopalliance ( 整合 Aop)</td><td style="text-align:left">log4j-core</td><td style="text-align:left">&nbsp;</td></tr><tr><td style="text-align:left">aspectjweaver ( 整合 Aop)</td><td style="text-align:left">ognl</td><td style="text-align:left">&nbsp;</td></tr><tr><td style="text-align:left">spring-jdbc (整合 Hibernate)</td><td style="text-align:left">struts-core</td><td style="text-align:left">&nbsp;</td></tr><tr><td style="text-align:left">spring-tx (整合事务)</td><td style="text-align:left">xwork-core</td><td style="text-align:left">&nbsp;</td></tr><tr><td style="text-align:left">c3p0 (数据源支持)</td><td style="text-align:left">&nbsp;</td><td style="text-align:left">&nbsp;</td></tr><tr><td style="text-align:left">spring-orm</td><td style="text-align:left">&nbsp;</td><td style="text-align:left">&nbsp;</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th style="text-align:left">其他依赖库 ( Jar 包 )</th><th style="text-align:left">备注</th></tr></thead><tbody><tr><td style="text-align:left">junit</td><td style="text-align:left">Junit 单元测试</td></tr><tr><td style="text-align:left">mysql-connector</td><td style="text-align:left">添加 MySQL 数据库支持</td></tr><tr><td style="text-align:left">struts2-spring-plugin</td><td style="text-align:left">Struts 整合 Spring 插件</td></tr><tr><td style="text-align:left">struts2-junit-plugin</td><td style="text-align:left">便于浏览项目中所有 action 及其与 Jsp View 的映射</td></tr><tr><td style="text-align:left">jstl</td><td style="text-align:left">标签库</td></tr><tr><td style="text-align:left">taglibs-standard-impl</td><td style="text-align:left">标签库</td></tr></tbody></table></div><h2 id="框架初识"><a href="#框架初识" class="headerlink" title="框架初识"></a>框架初识</h2><h3 id="ORM-框架"><a href="#ORM-框架" class="headerlink" title="ORM 框架"></a>ORM 框架</h3><ul><li>对象关系映射（Object Relational Mapping，O/R Mapping，ORM）是通过使用描述对象和数据库之间映射的 <code>元数据</code>，将面向对象语言程序中的 <code>对象</code> 自动 <code>持久化</code> 到 <code>关系数据库</code> 中。本质上就是将数据从一种形式转换到另外一种形式。 </li><li>让 <code>实体类</code> 和 <code>数据库表</code> 进行一一对应关系 (映射关系)，<code>实体类属性</code> 和 <code>表里面的字段</code> 对应。操作表对应实体类对象，而不需操作数据库表。</li></ul><h3 id="SSH-框架"><a href="#SSH-框架" class="headerlink" title="SSH 框架"></a>SSH 框架</h3><p>SSH 框架：<a href="http://spring.io/" target="_blank" rel="noopener">Spring</a>、<a href="http://struts.apache.org/" target="_blank" rel="noopener">Struts2</a>、<a href="http://hibernate.org/" target="_blank" rel="noopener">Hibernate</a> </p><p>集成 SSH 框架的系统从职责上分为四层：<code>表示层</code>、<code>业务逻辑层</code>、<code>数据持久层</code> 和 <code>域模块层</code>，以帮助开发人员在短期内搭建结构清晰、可复用性好、维护方便的 Web 应用程序。其中使用 <code>Struts</code> 作为 <code>系统的整体基础架构</code>，负责 MVC 的分离，在 Struts 框架的模型部分，控制业务跳转，利用 <code>Hibernate</code> 框架对 <code>持久层</code> 提供支持，<code>Spring</code> 做管理，<code>管理 Struts 和 Hibernate</code>。</p><p>具体做法是：用面向对象的分析方法根据需求提出一些模型，将这些模型实现为基本的 Java 对象，然后编写基本的 DAO (Data Access Objects) 接口，并给出 Hibernate 的 DAO 实现，采用 Hibernate 架构实现的 DAO 类来实现 Java 类与数据库之间的转换和访问，最后由 Spring 做管理，管理 Struts 和 Hibernate。</p><hr><h4 id="Struts"><a href="#Struts" class="headerlink" title="Struts"></a>Struts</h4><p>主要是用来做 <code>表示层</code>，也就所谓的 <code>界面</code>，和用户直接打交道，用来处理用户的请求和请求后返回给用户的模型数据。 Struts 对 Model，View 和 Controller 都提供了对应的组件。</p><hr><h4 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h4><p><code>业务逻辑层</code>，是一个轻量级的控制反转 (IoC) 和面向切面 (AOP) 的容器框架。</p><h5 id="Spring-概念"><a href="#Spring-概念" class="headerlink" title="Spring 概念"></a>Spring 概念</h5><ul><li>一站式轻量级开源框架，在 Java EE 三层结构中，每一层提供不通的解决技术。<ul><li><code>Web 层</code>：Spring MVC</li><li><code>Service 层</code>：ioC</li><li><code>DAO 层</code>：Spring 的 JdbcTemplate</li></ul></li><li>AOP：<code>面向切面编程</code>，扩展功能不是通过修改源码实现的，即通过 <code>动态代理技术</code>，把各类通知 / 增强织入到它所约定的流程当中。事实上，是通过引入其他类的方法来实现的。</li><li>ioC：<code>控制反转</code>，例如：对象的创建不通过 new 方式实现，而是通过 Spring 配置创建类对象。</li></ul><h5 id="Spring-ioC"><a href="#Spring-ioC" class="headerlink" title="Spring ioC"></a>Spring ioC</h5><p>控制反转 (ioC)，是一种通过描述 (在 Java 中可以是 XML 或者注解) 并通过第三方去产生或获取特定对象的方式。</p><h6 id="ioC-底层原理"><a href="#ioC-底层原理" class="headerlink" title="ioC 底层原理"></a>ioC 底层原理</h6><ul><li>使用技术：<ul><li>XML 配置文件；</li><li>Dom4j 解析 XML；</li><li>工厂设计模式；</li><li>类的反射.</li></ul></li><li>代码实现：<ul><li>创建 XML 配置文件，配置要创建对象类。</li><li>创建工厂类，使用 Dom4j 解析配置文件，通过反射创建类对象。</li></ul></li></ul><h6 id="ioC-入门案例"><a href="#ioC-入门案例" class="headerlink" title="ioC 入门案例"></a>ioC 入门案例</h6><ul><li><p>Maven 中添加依赖库 ( 对应导入 Jar 包 )：</p><blockquote><p>下载 Jar 包：到 <a href="http://mvnrepository.com/" target="_blank" rel="noopener">Maven Pository</a> 中搜索目标 Jar 包，在具体页面中的 Files 一栏可下载。例如：<a href="http://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-core/2.11.0" target="_blank" rel="noopener">log4j-core.2.11.0</a></p></blockquote>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- porm.xml --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Version Control of Jar Dependency  --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>5.0.7.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hibernate.version</span>&gt;</span>5.2.17.Final<span class="tag">&lt;/<span class="name">hibernate.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">struts2.version</span>&gt;</span>2.3.34<span class="tag">&lt;/<span class="name">struts2.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Foundation of SSH ( Spring、Struts 2、Hibernate ) --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- spring --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-expression<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       </span><br><span class="line">    <span class="comment">&lt;!-- 以下依赖包为下文所需要的，为方便起见这里统一配置 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- struts2 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.struts<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>struts2-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;struts2.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.struts.xwork<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xwork-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;struts2.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.ow2.asm<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>asm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.ow2.asm<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>asm-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.ow2.asm<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>asm-tree<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.freemarker<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.28<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.javassist<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javassist<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.22.0-GA<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ognl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ognl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javaee-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.taglibs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>taglibs-standard-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- config-browser-plugin 插件方便浏览项目中的所有 Action 及其与 Jsp View 的映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.struts<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>struts2-junit-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;struts2.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Hibernate --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;hibernate.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate.common<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-commons-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.4.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate.javax.persistence<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-jpa-2.1-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.2.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jboss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jandex<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.5.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jboss.logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jboss-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.2.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>antlr<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>antlr<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dom4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dom4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.geronimo.specs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>geronimo-jta_1.1_spec<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Combining with SSH ( Spring、Struts 2、Hibernate ) framework --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Spring 整合 Hibernate 和事务 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-orm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Spring 整合 AOP --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>aopalliance<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aopalliance<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib-nodep<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Spring 整合 Web --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Sturts 2 整合 Spring 框架 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.struts<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>struts2-spring-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;struts2.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Others --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 添加对 MySQL 数据库的支持 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 添加对数据源的支持 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.mchange/c3p0 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mchange<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- c3p0数据库连接池的辅助包 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mchange<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mchange-commons-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 日志系统 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Junit --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>创建 Spring 配置文件：在 Src 目录下 (建议)，创建 Spring 核心配置文件 applicationContext.xml。</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- applicationContext.xml --&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans-2.5.xsd&gt;</span></span></span><br><span class="line"><span class="tag"><span class="string">    &lt;bean id="</span><span class="attr">operator</span>" <span class="attr">class</span>=<span class="string">"cn.entity.UserOperator"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>再配置创建类，对象创建 (方便演示，以单元测试形式呈现)：</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单元测试类</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class <span class="title">ioCTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Step.01.加载 Spring 配置文件</span></span><br><span class="line">        ApplicationContext context  = </span><br><span class="line">            <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">            </span><br><span class="line">        <span class="comment">// Step.02. 得到配置创建的对象</span></span><br><span class="line">        UserOperator operator = </span><br><span class="line">            (UserOperator) context.getBean(<span class="string">"operator"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="Spring-Bean-管理-XML"><a href="#Spring-Bean-管理-XML" class="headerlink" title="Spring Bean 管理 (XML)"></a>Spring Bean 管理 (XML)</h5><h6 id="Bean-标签常用属性"><a href="#Bean-标签常用属性" class="headerlink" title="Bean 标签常用属性"></a>Bean 标签常用属性</h6><ul><li>ID 属性：Bean 标签的名称，要求只含数字和大小写英文字母。</li><li>Class 属性：常见对象所在类的全路径。</li><li>Name 属性：功能和 ID 属性一样，Name 属性可包含特殊字符值。</li><li>Scope 属性：<ul><li><code>singleton</code>：单例的 ( 默认值 )。</li><li><code>prototype</code>：多例的。</li></ul></li></ul><h6 id="Bean-实例化的方式"><a href="#Bean-实例化的方式" class="headerlink" title="Bean 实例化的方式"></a>Bean 实例化的方式</h6><ul><li><p>使用类的无参数构造创建对象</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserOperator</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">UserOperator</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>使用静态工厂创建对象</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserOperatorFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UserOperator <span class="title">getOperator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String className = <span class="string">"classValue"</span>; <span class="comment">// cn.entity.UserOperator</span></span><br><span class="line">        Class clz = Class.forName(className);</span><br><span class="line">        <span class="keyword">return</span> clz.newInstance();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>上述实例化方法在 applicationContext.xml 中的配置：</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 无参数构造创建对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"operator"</span> <span class="attr">class</span>=<span class="string">"cn.kofes.entity.UserOperator"</span> <span class="attr">scope</span>=<span class="string">"singleton"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">&lt;!-- 静态工厂创建对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"operator"</span> <span class="attr">class</span>=<span class="string">"cn.kofes.entity.UserOperatorFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getOperator"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h6 id="属性注入方式"><a href="#属性注入方式" class="headerlink" title="属性注入方式"></a>属性注入方式</h6><ul><li><p>Set() 方法注入</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserOperator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String operationType;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String operationType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.operationType = operationType;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>有参数构造注入</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserOperator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String operationType;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserOperator</span><span class="params">(String operationType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.operationType = operationType;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>注入 <code>对象属性</code> 类型：</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserOperator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> User user;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.user = user;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operatorTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">        UserOperator operator = (UserOperator) context.getBean(<span class="string">"operator"</span>);</span><br><span class="line">        <span class="comment">// TODO</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>注入 <code>复杂类型</code> 属性：</p><ul><li>数组</li><li>List 集合</li><li>Map 集合</li><li><p>Properties 类型</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserOperatorXML</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String arrs;<span class="comment">// 数组</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; list;<span class="comment">// List 集合</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; map;<span class="comment">// Map 集合</span></span><br><span class="line">    <span class="keyword">private</span> Properties properties;<span class="comment">// Properties 类型</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Setter() 方法此处省略...</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operatorTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ApplicationContext context = </span><br><span class="line">        <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">        UserOperatorXML operator =</span><br><span class="line">         (UserOperatorXML) context.getBean(<span class="string">"operator"</span>);</span><br><span class="line">        <span class="comment">// TODO</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><ul><li><p>上述 <code>注入方法</code> 在 applicationContext.xml 中的配置：</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- -- 有参数构造注入属性 -- --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"operator"</span> <span class="attr">class</span>=<span class="string">"cn.kofes.entity.UserOperatorXML"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"operationType"</span> <span class="attr">value</span>=<span class="string">"modify"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   </span><br><span class="line"><span class="comment">&lt;!-- -- Set 方法注入属性 -- --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"operator"</span> <span class="attr">class</span>=<span class="string">"cn.kofes.entity.UserOperatorXML"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"operationType"</span> <span class="attr">value</span>=<span class="string">"modify"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- -- 注入 对象属性 类型 -- --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"cn.kofes.entity.User"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"operator"</span> <span class="attr">class</span>=<span class="string">"cn.kofes.entity.UserOperatorXML"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">     | Name 属性值：类里面的定义属性的名称</span></span><br><span class="line"><span class="comment">     | Ref 属性：定义属性在 Bean 标签中的 ID 值</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">ref</span>=<span class="string">"user"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- -- 注入 复杂类型 属性 -- --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"complex"</span> <span class="attr">class</span>=<span class="string">"cn.kofes.entity.UserOperatorXML"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 数组、List 集合适用 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"arrs"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">lsit</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>Arrs0<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">lsit</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">lsit</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>Arrs1<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">lsit</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">lsit</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>Arrs2<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">lsit</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Map 集合 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"seq1"</span> <span class="attr">value</span>=<span class="string">"str1"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"seq2"</span> <span class="attr">value</span>=<span class="string">"str2"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"seq3"</span> <span class="attr">value</span>=<span class="string">"str3"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Properties：例如我们要配置数据库 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"properties"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"driverclass"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"password"</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h6 id="Spring-DI"><a href="#Spring-DI" class="headerlink" title="Spring DI"></a>Spring DI</h6><p>ioC 与 DI 的区别</p><ul><li><code>ioC</code>：<code>控制反转</code>，把对象创建交给 Spring 进行配置。</li><li><p><code>DI</code>：<code>依赖注入</code>，向类中的属性设置属性值。</p><blockquote><p>关系：依赖注入不能单独存在，需在 ioC 基础之上完成操作。</p></blockquote></li></ul><h5 id="Spring-Bean-管理-注解"><a href="#Spring-Bean-管理-注解" class="headerlink" title="Spring Bean 管理 (注解)"></a>Spring Bean 管理 (注解)</h5><ul><li>注解格式：<code>@注解名称(value=&quot;属性值&quot;)</code> 或者 <code>@注解名称(&quot;属性值&quot;)</code> </li><li><p><code>@Component(&quot;user&quot;)</code> 相当于 <code>&lt;bean id=&quot;user&quot; class=&quot;&quot; /&gt;</code>，其三个衍生注解为：</p><ul><li>@Controller：Web 层，相当于 Struts 中的 Action 层。</li><li>@Service：业务层 ，业务逻辑处理。</li><li><p>@Repository：持久层，标注数据访问组件，即 DAO 组件。</p><blockquote><p>功能目前来说是一致的，即创建对象。</p></blockquote></li></ul></li><li><p><code>@Scope(&quot;prototype&quot;)</code> 或 <code>@Scope(&quot;singleton&quot;)</code>：即配置的对象是单实例还是多实例。</p></li></ul><h6 id="基本内容"><a href="#基本内容" class="headerlink" title="基本内容"></a>基本内容</h6><ul><li>使用注解创建对象</li><li>使用注解注入对象</li><li>xml 和注解方式混合使用</li></ul><h6 id="小试牛刀"><a href="#小试牛刀" class="headerlink" title="小试牛刀"></a>小试牛刀</h6><ul><li><p>创建类和方法</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123; <span class="comment">/* 省略实体类的属性 */</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123; <span class="comment">/* 省略实体类的属性 */</span> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Firm</span> </span>&#123; <span class="comment">/* 省略实体类的属性 */</span> &#125;</span><br></pre></td></tr></table></figure></li><li><p>创建 Spring 配置文件，并引入约束 (在上述 applicationContext.xml 中追加)</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- applicationContext.xml --&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context-2.5.xsd"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 注解扫描：扫描属性上面的注解 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">     | 注解扫描：到包里扫描类、方法、属性上面的注解，</span></span><br><span class="line"><span class="comment">     | 即使用 Annotation 自动注册 Bean</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.kofes"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.kofes.entity"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>注解中创建对象</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此方式相当于 &lt;bean id="user" class="cn.kofes.entity.User" /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(value=<span class="string">"user"</span>)  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123; </span><br><span class="line">    <span class="comment">// 省略实体类的属性...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserOperatorAnn</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operatorTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ApplicationContext context = </span><br><span class="line">        <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">        System.out.println(user); <span class="comment">// 直接调用 user 对象</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>注解注入属性</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实体操作类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserOperatorAnn</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 相当于 Set 方法注入属性：</span></span><br><span class="line">    <span class="comment">// @Autowired 或者 @Resource(name = "user") </span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operatorTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        System.out.println(customer);</span><br><span class="line">        System.out.println(firm);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>XML 配置文件和注解混合使用</p><ul><li>创建对象操作使用 XML 配置文件方式实现；</li><li><p>注入属性的操作使用注解方式实现.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Start：applicationContext.xml */</span></span><br><span class="line"></span><br><span class="line">&lt;bean id=<span class="string">"user"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"cn.kofes.entity.User"</span> /&gt;</span><br><span class="line">&lt;bean id=<span class="string">"customer"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"cn.kofes.entity.Customer"</span> /&gt;</span><br><span class="line">&lt;bean id=<span class="string">"firm"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"cn.kofes.entity.Firm"</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* End：applicationContext.xml */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserOperatorAnn</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 注解方式注入属性</span></span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"user"</span>) </span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"customer"</span>) </span><br><span class="line">    <span class="keyword">private</span> Customer customer;</span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"firm"</span>) </span><br><span class="line">    <span class="keyword">private</span> Firm firm;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operatorTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ApplicationContext context = </span><br><span class="line">        <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        System.out.println(customer);</span><br><span class="line">        System.out.println(firm);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h5 id="Spring-AOP"><a href="#Spring-AOP" class="headerlink" title="Spring AOP"></a>Spring AOP</h5><h6 id="AOP-概述"><a href="#AOP-概述" class="headerlink" title="AOP 概述"></a>AOP 概述</h6><p>面向切面编程 (Aspect Oriented Programing，AOP)，扩展功能不通过修改代码实现。AOP 采取 <code>横向抽取机制</code> 取代传统 <code>纵向继承体系</code> 重复性代码。</p><ul><li>纵向继承体系：通过继承获得父类的功能 (方法)。</li><li><p>横向抽取机制：动态代理方式。</p><ul><li>针对有接口的情况，使用 JDK 动态代理。</li><li><p>针对没有接口情况，使用 Cglib 动态代理。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Dao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaoImpl</span> <span class="keyword">implements</span> <span class="title">Dao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 具体逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h6 id="AOP-相关术语"><a href="#AOP-相关术语" class="headerlink" title="AOP 相关术语"></a>AOP 相关术语</h6><p>便于理解，引入实体类进行说明：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAll</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>连接点 (Join Point)：指那些被拦截到的点，在 Spring 这些点指的是方法，因 Spring 只支持方法类型的连接点。</p><blockquote><p>类中有哪些方法可被增强，这些方法称为连接点。</p></blockquote></li><li><p><code>切入点 (Pointcut)</code>：指我们要对哪些 <code>Join Point</code> 进行拦截的定义。</p><blockquote><p>类中有很多方法被增强，例如实际操作中，只是增强了类中的 add() 和 update() 方法，即称为切入点。</p></blockquote></li><li><p>引介 (Introduction)：一种特殊的通知在不修改类代码的前提下， Introduction 可为类动态地添加一些方法或 Field。</p></li><li><p><code>通知/增强 (Advice)</code>：指拦截到 <code>Join Point</code> 之后要做的事情就是通知。通知分为前置通知、后置通知、异常通知、最终通知、环绕通知 (切面要完成的功能)。</p><blockquote><p>增强的逻辑称为增强，例如扩展日志功能，这个日志功能称为增强。<br>前置通知，在方法之前执行；后置通知，在方法之后执行；<br>异常通知，方法出现异常；最终通知，在后置之后执行；<br>环绕通知，在方法之前和之后执行.  </p></blockquote></li><li><p>目标对象 (Target)：代理的目标对象 (要增强的类)。</p></li><li><p>织入 (Weaving)：把增强应用到目标的过程，即把 Advice 应用到 Target 的过程。</p></li><li><p><code>切面 (Aspect)</code>：切入点和通知 (引介) 的结合。</p><blockquote><p>把增强应用到具体方法上，此过程称为切面。例如把日志功能写进 add() 方法中。</p></blockquote></li><li><p>代理 (Proxy)：一个类被 AOP 织入增强后，产生一个结果代理类。</p></li></ul><h6 id="Spring-AOP-操作"><a href="#Spring-AOP-操作" class="headerlink" title="Spring AOP 操作"></a>Spring AOP 操作</h6><blockquote><p>(1) 基于 AspectJ 的 Spring AOP 操作。</p></blockquote><p>ASpectJ：面向切面的框架，其扩展了 Java 语言。AspectJ 定义了 AOP 语法，故它有一个专门的编译器来生成遵守 Java 字节编码规范的 Class 文件。 </p><p>AspectJ 并不是 Spring 一部分，和 Spring 一起使用进行 AOP 操作。</p><p>使用 AspectJ 实现 AOP 有两种方式：1) 基于 AspectJ 的 XML 配置；2) 基于 AspectJ 的注解方式。</p><blockquote><p>(2) 操作基本流程 ( XML 方式 )：</p></blockquote><ul><li><p>使用表达式配置切入点</p><ul><li><p>execution( &lt;访问修饰符&gt;?&lt;返回类型&gt;&lt;方法名&gt;(&lt;参数&gt;)(异常) )</p><blockquote><p>execution( * cn.kofes.UserOpertor.add(..) )  — UserOperator 类中 add() 方法增强<br>execution( * cn.kofes.UserOperator.*(..) )  — UserOperator 类中所有方法增强<br>execution( * *.*(..) )  — 所有类中所有方法增强<br>execution( * save*(..) ) — 所有 save 开头的方法增强</p></blockquote></li></ul></li><li><p>代码实现</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// strengthenUserOperator.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">strengthenUserOperator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">strengthenUserOperator</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * This's an aspect inserting to the method() the front.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listBeforeOperatorType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Inserting to the method() the front."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * This's an aspect inserting to the method() the front and latter.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> proceedingJoinPoint 执行被增强的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listArroundOperatorType</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Inserting to the method() the front."</span>);</span><br><span class="line">        proceedingJoinPoint.proceed();</span><br><span class="line">        System.out.println(<span class="string">"Inserting to the method() the latter."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UserOperatorXML.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserOperatorXML</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123; <span class="keyword">this</span>.user = user; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> user; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operatorTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">        UserOperatorXML operator = (UserOperatorXML) context.getBean(<span class="string">"operator"</span>);</span><br><span class="line">        <span class="comment">// 会在用户信息之前输出 “前置增强” 的信息。</span></span><br><span class="line">        System.out.println( operator.getUser() );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建 Spring 配置文件，并引入约束 (在上述 applicationContext.xml 中追加)</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- applicationContext.xml --&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context-2.5.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop/spring-aop-2.5.xsd"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 无参数构造创建对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"operator"</span> <span class="attr">class</span>=<span class="string">"cn.kofes.entity.UserOperatorXML"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"strengthenoperator"</span> <span class="attr">class</span>=<span class="string">"cn.kofes.entity.strengthenUserOperator"</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 配置 AOP 操作 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置切入点：匹配 UserOperator 类中所有方法 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"pointcutA"</span> <span class="attr">expression</span>=<span class="string">"execution( * cn.kofes.UserOperatorXML.*(..))"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置切面：把增强用到方法上面 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"strengthenoperator"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 配置增强类型</span></span><br><span class="line"><span class="comment">             | Aop：增强类型有 before、after、arroud 等</span></span><br><span class="line"><span class="comment">             | Method：增强类里面使用哪个方法作为前置</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"listAllOperatorType"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pointcutA"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><blockquote><p>(3) 操作基本流程 ( 注解方式 )：</p></blockquote><ul><li><p>创建 Spring 配置文件 (在上述 applicationContext.xml 中追加)，XML 配置创建对象，并开启 AOP 操作：</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 无参数构造创建对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"strengthenoperator"</span> <span class="attr">class</span>=<span class="string">"cn.kofes.entity.strengthenUserOperator"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 开启 AOP 操作 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>在增强类上面使用注解完成 AOP 操作：</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// strengthenUserOperator.java</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">strengthenUserOperator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">strengthenUserOperator</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * This's an aspect inserting to the method() the front.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listBeforeOperatorType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Inserting to the method() the front."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * This's an aspect inserting to the method() the front and latter.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> proceedingJoinPoint 执行被增强的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around</span>(value=<span class="string">"execution( * cn.kofes.entity.UserOperatorXML.*(..) )"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listArroundOperatorType</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Inserting to the method() the front."</span>);</span><br><span class="line">        proceedingJoinPoint.proceed();</span><br><span class="line">        System.out.println(<span class="string">"Inserting to the method() the latter."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="Spring-整合-Web-项目"><a href="#Spring-整合-Web-项目" class="headerlink" title="Spring 整合 Web 项目"></a>Spring 整合 Web 项目</h5><p><code>诉求</code>：在 Spring 运作中，首先加载 Spring 核心配置文件，再创建对象。而创建对象可通过 New 的方式创建，但效率太低，则我们可以把加载配置文件和创建对象过程，在服务器启动时完成。</p><h6 id="问题引入"><a href="#问题引入" class="headerlink" title="问题引入"></a>问题引入</h6><ul><li>Action 调用 Service，Service 调用 Dao。而每次 Action 时都会加载 Spring 配置文件，影响性能。</li></ul><h6 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h6><ul><li>ServletContext 对象</li><li>监听器 (观察者模式)</li></ul><h6 id="操作简叙"><a href="#操作简叙" class="headerlink" title="操作简叙"></a>操作简叙</h6><ul><li>在服务器启动时，为每个项目创建一 ServletContext 对象；</li><li>在 ServletContext 对象创建时，使用监听器监听 ServletContext 对象在什么时创建；</li><li>监听到 ServletContext 对象创建时，加载 Spring 配置文件，把配置文件配对象创建；</li><li>把创建的对象放置 ServletContext 域对象里；</li><li>到 ServletContext 域中，通过 getAttribute() 方法获取对象。</li></ul><h6 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h6><ul><li><p>在 <code>web.xml</code> 配置文件中添加监听器，并指定 Spring 配置文件 的位置。</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 指定 Spring 配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">   </span><br><span class="line"><span class="comment">&lt;!-- 监听器模块 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h5 id="Spring-JdbcTemplate-操作"><a href="#Spring-JdbcTemplate-操作" class="headerlink" title="Spring JdbcTemplate 操作"></a>Spring JdbcTemplate 操作</h5><ul><li>Spring 对不同的持久化层技术都进行了封装：<ul><li><code>Jdbc</code></li><li><code>Hibernate 5.x</code></li><li><code>iBatis / MyBatis</code></li><li><code>JPA</code></li></ul></li><li>JdbcTemplate 对 Jdbc 进行了封装，以下为实际操作介绍。</li></ul><h6 id="JdbcTemplate-增删改查"><a href="#JdbcTemplate-增删改查" class="headerlink" title="JdbcTemplate 增删改查"></a>JdbcTemplate 增删改查</h6><ul><li>Step.01.创建对象，设置数据库信息</li><li>Step.02.创建 jdbcTemplate 对象，设置数据源</li><li><p>Step.03.调用 jdbcTemplate 对象，实现其中的方法实现增、删、改、查操作。</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Jdbc 模板依赖连接池获得数据库连接，所以必须先构造连接池</span></span><br><span class="line">DriverManagerDataSource dataSource = <span class="keyword">new</span> DriverManagerDataSource();</span><br><span class="line">dataSource.setDriverClassName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">dataSource.setUrl(<span class="string">"jdbc:mysql://192.168.x.x/db_testdb"</span>);</span><br><span class="line">dataSource.setUsername(<span class="string">"root"</span>);</span><br><span class="line">dataSource.setPassword(<span class="string">"123456"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 Jdbc 模板</span></span><br><span class="line">JdbcTemplate jdbcTemplate = <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 建表 SQL 语句</span></span><br><span class="line">String sql_create = <span class="string">"CREATE TABLE "</span> + </span><br><span class="line"><span class="string">"t_user(id int primary key auto_increment, username varchar(20), password varchar(20))"</span>;</span><br><span class="line">String sql_insert = <span class="string">"INSERT INTO t_user VALUES(?, ?, ?)"</span>;</span><br><span class="line">String sql_update = <span class="string">"UPDATE t_user password = ? WHERE username = ?"</span>;</span><br><span class="line">String sql_delete = <span class="string">"DELETE FROM t_user WHERE username = ?"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// JdbcTemplate 实现增、删、改操作</span></span><br><span class="line">jdbcTemplate.execute(sql_create); </span><br><span class="line">jdbcTemplate.update(sql_insert, <span class="string">"Lucy"</span>, <span class="string">"123456"</span>); </span><br><span class="line">jdbcTemplate.update(sql_update, <span class="string">"Lucy"</span>, <span class="string">"abc123"</span>);</span><br><span class="line">jdbcTemplate.update(sql_delete, <span class="string">"Lucy"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JdbcTemplate 实现查询操作，使用 RowMapper 接口，</span></span><br><span class="line"><span class="comment"> * 但 JdbcTemplate 没有针对这个接口提供实现类，得到不同的类型数据需要进行数据封装</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询返回某一个值 </span></span><br><span class="line">sql_select_certain = <span class="string">"SELECT count(*) FROM t_user"</span>;</span><br><span class="line"><span class="comment">// args0：SQL 语句，args1：返回类型 Class</span></span><br><span class="line">jdbcTemplate.queryForObject(sql_select_certain, Integer.class);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 查询返回 list 集合</span></span><br><span class="line">sql_select_all = <span class="string">"SELECT * FROM t_user"</span>;</span><br><span class="line">List&lt;User&gt; list = jdbcTemplate.query( sql_select_all, <span class="keyword">new</span> MyRowMapper() );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询返回 list 集合，需要创建类实现 RowMapper 接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRowMapper</span> <span class="keyword">implements</span> <span class="title">RowMapper</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> num)</span> <span class="keyword">throws</span> SQLExpection </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setUsername( rs.getString(<span class="string">"username"</span>) );</span><br><span class="line">        user.setPassword( rs.getString(<span class="string">"password"</span>) );</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="Spring-配置连接池"><a href="#Spring-配置连接池" class="headerlink" title="Spring 配置连接池"></a>Spring 配置连接池</h5><ul><li><p>创建 Spring 配置文件，配置连接池：</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 为便于修改配置，可在根目录下新建文件 c3p0.properties，填写格式如下：</span></span><br><span class="line"><span class="comment"> | datasource.driverClass=com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="comment"> | datasource.jdbcUrl=jdbc:mysql://192.168.x.x:3306/db_testdb?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="comment"> | datasource.user=root</span></span><br><span class="line"><span class="comment"> | ...</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:c3p0.properties"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Data Connection Setting --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 引用 c3p0.properties 的键值对即可 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.driverClass&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.jdbcUrl&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.user&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.password&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置数据库连接池的最大连接数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxPoolSize"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.maxPoolSize&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置数据库连接池的最小连接数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minPoolSize"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.minPoolSize&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置数据库连接池的初始化连接数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"initialPoolSize"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.initialPoolSize&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置数据库连接池的连接最大空闲时间 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdleTime"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.maxIdleTime&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- c3p0缓存Statement的数量数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxStatements"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.maxStatements&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 当连接池的连接用完的，从 C3p0 下获取新的连接数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"acquireIncrement"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.acquireIncrement&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"checkoutTimeout"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.checkoutTimeout&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"idleConnectionTestPeriod"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.idleConnectionTestPeriod&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- JdbcTemplate 类中封装了 DataSource 类，以 XML 配置形式注解关系即可 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">"jdbcTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>代码引用：</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span>(name = <span class="string">"jdbcTemplate"</span>)</span><br><span class="line"><span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">String sql = <span class="string">"SELECT * FROM t_user"</span>;</span><br><span class="line">    List&lt;User&gt; list = jdbcTemplate.query(sql, <span class="keyword">new</span> MyRowMapper());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="Spring-事务管理"><a href="#Spring-事务管理" class="headerlink" title="Spring 事务管理"></a>Spring 事务管理</h5><h6 id="编程式事务管理"><a href="#编程式事务管理" class="headerlink" title="编程式事务管理"></a>编程式事务管理</h6><p>此部分省略。</p><h6 id="声明式事务管理"><a href="#声明式事务管理" class="headerlink" title="声明式事务管理"></a>声明式事务管理</h6><ul><li><p>创建 Service 类和 Dao 类，再添加注入关系：<br>  1) Service 层，又称业务逻辑层；<br>  2) Dao 层，数据持久层，单纯对数据库进行操作.  </p></li><li><p>引入问题：ServiceTest 类中制造的异常，即造成了转账的不一致问题，细节如下：</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ServiceTest.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DaoTest daotest;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDaotest</span><span class="params">(DaoTest daotest)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.daotest = daotest;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* @Transactional 注解方式时填写 */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">executeUpdateInDB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        GrowUp();</span><br><span class="line">        <span class="keyword">int</span> exception = <span class="number">10</span> / <span class="number">0</span>;<span class="comment">// 人为制造异常</span></span><br><span class="line">        Dealth();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GrowUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        daotest.updateOneTuple(<span class="string">"UPDATE t_user SET age=age+1 where username = ?"</span>,</span><br><span class="line">        <span class="keyword">new</span> Object[]&#123;<span class="string">"诸葛亮"</span>&#125;, <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;Types.VARCHAR&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Dealth</span><span class="params">()</span></span>&#123;</span><br><span class="line">        daotest.updateOneTuple(<span class="string">"UPDATE t_user SET age=0 where username = ?"</span>,</span><br><span class="line">        <span class="keyword">new</span> Object[]&#123;<span class="string">"诸葛亮"</span>&#125;, <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;Types.VARCHAR&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DaoTest.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaoTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJdbcTemplate</span><span class="params">(JdbcTemplate jdbcTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.jdbcTemplate = jdbcTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sql 插入元组的 SQL 语句</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> obj 插入的属性值，与 SQL 中填写属性名的顺序相同</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> types 对应属性值的数据类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateOneTuple</span><span class="params">(String sql, Object[] obj, <span class="keyword">int</span>[] types)</span> </span>&#123;</span><br><span class="line">        jdbcTemplate.update(sql, obj, types);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>基于 XML 配置文件形式实现 ( AOP 的思想 )</p><blockquote><p>目前为止，Spring 配置文件中约束添加完毕，以后配置复制此段即可。</p></blockquote>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 目前为止，Spring 配置文件中约束添加完毕，以后的程序复制此段即可 --&gt;</span></span><br><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context-2.5.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop/spring-aop-2.5.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/tx/spring-tx-2.5.xsd"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- set 方法注入属性 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"service"</span> <span class="attr">class</span>=<span class="string">"cn.kofes.service.ServiceTest"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"daotest"</span> <span class="attr">ref</span>=<span class="string">"dao"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dao"</span> <span class="attr">class</span>=<span class="string">"cn.kofes.dao.DaoTest"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 引用上例的 jdbcTemplate bean 即可 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcTemplate"</span> <span class="attr">ref</span>=<span class="string">"jdbcTemplate"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!-- 配置事务管理器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注入 dataSource  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置事务增强 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txadvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 做事务操作 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">             | 事务操作方法的匹配规则，若事务操作的方法有规范命名，可以简写为：</span></span><br><span class="line"><span class="comment">             | &lt;tx:method name="execute*" /&gt;</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"executeTrading()"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 配置 AOP 操作 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 切点 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"poitncutB"</span> <span class="attr">expression</span>=<span class="string">"execution( * cn.kofes.service.ServiceTest.executeTrading(..) )"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 切面 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txadvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pointcutB"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>基于注解形式实现</p><p>  在需要事务操作的类上配置注解 <code>@Transactional</code>，再配置 applicationContext.xml：</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在 applicationContext.xml 中配置事务管理器 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置事务管理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注入 dataSource  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 开启注解事务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span> /&gt;</span></span><br></pre></td></tr></table></figure></li></ul><hr><h4 id="Hibernate"><a href="#Hibernate" class="headerlink" title="Hibernate"></a>Hibernate</h4><p><code>数据持久层</code>，Hibernate 是一个开放源码的 <code>ORM</code> 持久层框架。简单的说，Hibernate 只是一个将持久化类与数据库表相映射的工具，<code>每个持久化类实例均对应于数据库表中的一个数据行而已</code>。用户只需直接使用面向对象的方法操作此持久化类实例，即可完成对数据库表数据的插入、删除、修改、读取等操作。</p><h5 id="Hibernate-配置"><a href="#Hibernate-配置" class="headerlink" title="Hibernate 配置"></a>Hibernate 配置</h5><ul><li><p>使用配置文件将映射关系对应起来；</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置文件命名规范：*.hbm.xml --&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC </span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">     | 配置类和表相对应：Class 标签</span></span><br><span class="line"><span class="comment">     | name 属性：实体类全路径</span></span><br><span class="line"><span class="comment">     | table 属性：数据库表名称</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"cn.entity.User"</span> <span class="attr">table</span>=<span class="string">"t_user"</span>&gt;</span>          </span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">         | 配置实体类 ID 与表 ID 对应：ID 标签</span></span><br><span class="line"><span class="comment">         | Hibernate 要求实体类有一个属性唯一值，且要求表有字段作为唯一值</span></span><br><span class="line"><span class="comment">         | name 属性：实体类的 id 属性名称</span></span><br><span class="line"><span class="comment">         | column 属性：生产的表字段名称</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"uid"</span> <span class="attr">column</span>=<span class="string">"uid"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 设置数据库表 id 增长策略：Class 标签</span></span><br><span class="line"><span class="comment">             | 属性有：increment、hilo、squence、identity、native、uuid、guid 等。</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                   </span><br><span class="line">        <span class="comment">&lt;!-- 配置其他属性和表字段对应：Property 标签 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 若使用的是 SQL Server 数据库系统，Property 映射对的顺序要和数据库中列 (属性) 的顺序相对应 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span> <span class="attr">type</span>=<span class="string">"string"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">column</span>=<span class="string">"age"</span> <span class="attr">type</span>=<span class="string">"int"</span> /&gt;</span>       </span><br><span class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><blockquote><p>关于映射配置的一些批注：</p></blockquote><ul><li>Note.01：就映射配置来说，这里千万要记住，若访问的是 SQL Server 数据库系统，则 <strong><property> 映射对的顺序要和数据库中列 (属性) 的顺序相对应</property></strong>。( 其他数据库系统没有出现此类问题，鉴于阅读与编程的规范，则不管使用哪种数据库系统驱动，都以此种方式编辑 Property 映射对 )</li><li>Note.02：关于配置中实体类的主键生成策略有多种形式，详细见参考 [4]。</li><li><p>Note.03：User 实体类对象的状态：</p><ul><li><code>瞬时态</code>：对象没有 ID 值，且其与 Session 没有关联。</li><li><code>持久态</code>：对象有 ID 值，且其与 Session 有关联。</li><li><p><code>托管态</code>：对象有 ID 值，但其与 Session 没有关联。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 下述代码只列举了细节不同的部分，其他细节见源代码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line">           </span><br><span class="line"><span class="comment">// 瞬时态：即插入元组</span></span><br><span class="line">user.setUserName(<span class="string">"Sample"</span>);</span><br><span class="line">user.setAge(<span class="number">25</span>);</span><br><span class="line">session.saveOrUpdate(user);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 托管态：对数据表中具体 ID 的元组进行数据修改，即更新元祖</span></span><br><span class="line">user.setUid(attr_id);</span><br><span class="line">user.setUserName(<span class="string">"Sample"</span>);</span><br><span class="line">user.setAge(<span class="number">25</span>);</span><br><span class="line">session.saveOrUpdate(user);</span><br><span class="line"><span class="comment">// session.save(user); // 注意：此操作为新增元组，但不是全部属性都修改，会引入空值</span></span><br><span class="line">           </span><br><span class="line"><span class="comment">// 持久态：对数据表中具体 ID 的元组进行数据修改，即更新元祖</span></span><br><span class="line">user = session.get(User.class, attr_id);</span><br><span class="line">user.setUserName(<span class="string">"Sample"</span>);</span><br><span class="line">user.setAge(<span class="number">25</span>);</span><br><span class="line">session.saveOrUpdate(user);</span><br><span class="line">           </span><br><span class="line"><span class="comment">// 启示：从持久态和托管态态的实验结果可知，修改元组，先查再改，防止空值。</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>创建 Hibernate 的核心配置文件；</p><p>  核心配置文件格式是 XML，且核心配置文件名称和位置是 <code>固定的</code> ( Src 根目录下，且名称为 <code>hibernate.cfg.xml</code> )。Hibernate 操作过程中，仅加载核心配置文件。</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置文件命名规范：hibernate.cfg.xml --&gt;</span></span><br><span class="line">               </span><br><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- (必填) 配置数据库信息：从 hibernate.property 中获取 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span> /&gt;</span></span><br><span class="line">           </span><br><span class="line">        <span class="comment">&lt;!-- SQL Server 数据库管理系统的 Driver </span></span><br><span class="line"><span class="comment">        &lt;property name="hibernate.connection.driver_class"&gt;com.microsoft.sqlserver.jdbc.SQLServerDriver&lt;/property&gt;</span></span><br><span class="line"><span class="comment">        &lt;property name="hibernate.connection.url"&gt;</span></span><br><span class="line"><span class="comment">            jdbc:sqlserver://192.168.0.133:1433;DatabaseName=testDB</span></span><br><span class="line"><span class="comment">        &lt;/property&gt;</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">           </span><br><span class="line">        <span class="comment">&lt;!-- MySQL 数据库管理系统的 Driver --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span></span><br><span class="line">            jdbc:mysql://192.168.0.163:3306/testDB?serverTimezone=UTC</span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">           </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>sa<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>pztech753<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                   </span><br><span class="line">        <span class="comment">&lt;!-- (可选) 配置 Hibernate 信息：从 hibernate.property 中获取 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 操作数据库时，向控制台输出 SQL 语句 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="comment">&lt;!-- 操作数据库时，向控制台输出格式化的 SQL 语句 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Hibernate 配置自动建表：Update，有表更新没表建立 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span> =<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">         | 例如，实现分页功能：</span></span><br><span class="line"><span class="comment">         | MySQL 里面使用 LIMIT 关键字，Oracle 中使用 ROWNUM 关键字</span></span><br><span class="line"><span class="comment">         | 让 Hibernate 识别不同数据库中特有的语句</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                   </span><br><span class="line">        <span class="comment">&lt;!-- (必填) 把映射文件放到核心配置文件中 ( 填 Src 之后的路径 ) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"cn/entity/User.hbm.xml"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><blockquote><p>关于核心配置的一些批注：</p><p>面对不同的数据库管理系统，对应的配置属性也存在差异，详细见参考 [5]。</p></blockquote><ul><li><p>通过 Session 保存实体类数据到数据库表中；</p><p>  简单演示，详细见下一章节：<a href="#Hibernate-使用">Hibernate 使用</a></p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line">user.setUsername(<span class="string">"Lucy"</span>);</span><br><span class="line">user.setAge(<span class="number">25</span>);</span><br><span class="line">Session.save(user);</span><br></pre></td></tr></table></figure></li></ul><h5 id="Hibernate-使用"><a href="#Hibernate-使用" class="headerlink" title="Hibernate 使用"></a>Hibernate 使用</h5><ul><li><p>以下代码为 Hibernate 最基本的使用方法，后续将通过优化 Configuration，以及规范事务来优化 Hibernate。</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Step.01：加载 Hibernate 核心配置文件 hibernate.cfg.xml</span></span><br><span class="line">Configuration cfg = <span class="keyword">new</span> Configuration();</span><br><span class="line">cfg.configure();</span><br><span class="line">   </span><br><span class="line"><span class="comment">// Step.02：创建 SessionFactory 对象；</span></span><br><span class="line"><span class="comment">// 在此过程中，根据映射关系在数据库中把表创建起来</span></span><br><span class="line">SessionFactory sessionFactory = cfg.buildSessionFactory();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Step.03：使用 SessionFactory 创建 Session 对象；</span></span><br><span class="line">Session session = sessionFactory.openSession();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Step.04：手动开始事务；</span></span><br><span class="line">Transaction trans = session.beginTransaction();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Step.05：写具体逻辑，例如：增删改查；</span></span><br><span class="line"><span class="comment">// 例如添加操作 ( 不操作数据表，而操作实体类 )</span></span><br><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line">user.setUsername(<span class="string">"Lucy"</span>);</span><br><span class="line">user.setAge(<span class="number">25</span>);</span><br><span class="line">session.save(user);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Step.06：提交事务；</span></span><br><span class="line">trans.commit();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Step.07：关闭资源；</span></span><br><span class="line">session.close();</span><br><span class="line">sessionFactory.close();</span><br></pre></td></tr></table></figure></li><li><p>Configuration</p><ul><li>到 Src 目录下加载核心配置文件 <code>hibernate.cfg.xml</code>；</li></ul></li><li><p>SessionFactory</p><ul><li>根据核心配置文件中数据库配置、映射配置，且根据映射关系，到数据库中把表创建起来。</li><li><p>创建 SessionFactory 过程中，特别消耗资源，故应该采取优化措施：</p><p>在 Hibernate 操作中，建议一个项目创建一个 SessionFacotry 对象，以静态的工具类形式封装使用。  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateUtils</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Configuration cfg = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> SessionFactory sessionFactory = <span class="keyword">null</span>;            </span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    cfg = <span class="keyword">new</span> Configuration();</span><br><span class="line">    cfg.configure();</span><br><span class="line">    sessionFactory = cfg.buildSessionFactory();</span><br><span class="line">&#125;</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SessionFactory <span class="title">getSessionFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sessionFactory;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>Session</p><ul><li>类似 Jdbc 中的 Connection，可调用 Session 中的不同方法实现 <code>增、删、改、查</code> 操作。 <ul><li>增加：save()；</li><li>修改：update()；</li><li>删除：delete()；</li><li>查询：get()；</li></ul></li><li><p>Session 为单线程对象，即不能共用，仅自己使用。</p><ul><li><p>Hibernate 已实现本地线程与 Session 的绑定：在 Hibernate 的核心配置文件中，再调用 sessionFactory 的方法得到。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.current_session_context_class"</span>&gt;</span>thread<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在 HibernateUtils 静态工具类中追加静态方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 返回与本地线程绑定的 Session</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title">getSessionObject</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sessionFactory.getCurrentSession();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">      </span><br><span class="line"><span class="comment">/* 在其他类中调用该方法 */</span></span><br><span class="line">Session session = HibernateUtils.getSessionObject();</span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p>Transaction</p><ul><li>事务概念；</li><li><p>事务特性：原子性、一致性、隔离性、持久性；</p><blockquote><p>隔离性：不考虑隔离性会产生的问题，如脏读、不可重复读和虚读。当然，可以设置隔离的级别来解决问题。</p></blockquote></li><li><p>Hibernate 使用 Transaction 创建事务对象；</p></li><li><p>事务的 commit() 与 rollback() 方法 ( <code>规范用法</code> )；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">SessionFactory sessionFactory = <span class="keyword">null</span>;</span><br><span class="line">Session session = <span class="keyword">null</span>;</span><br><span class="line">Transaction trans = nu</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    sessionFactory = HibernateUtils.getSessionFactory()</span><br><span class="line">    session = sessionFactory.openSession();</span><br><span class="line">    <span class="comment">// 开启事务</span></span><br><span class="line">    trans = session.beginTransaction();</span><br><span class="line">           </span><br><span class="line">    <span class="comment">// 人为制造异常，被除数不能为零</span></span><br><span class="line">    User user = <span class="function">ne0w <span class="title">User</span><span class="params">()</span></span>;</span><br><span class="line">    user.setAge(<span class="number">50</span>/<span class="number">0</span>);</span><br><span class="line">    session.save(user);</span><br><span class="line">           </span><br><span class="line">    <span class="comment">// 提交事务</span></span><br><span class="line">    trans.commit();</span><br><span class="line">&#125; <span class="keyword">catch</span>(Exception ex) &#123;</span><br><span class="line">    <span class="comment">// 发生异常</span></span><br><span class="line">    trans.rollback();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    session.close();</span><br><span class="line">    sessionFactory.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h5 id="Hibernate-优化"><a href="#Hibernate-优化" class="headerlink" title="Hibernate 优化"></a>Hibernate 优化</h5><h6 id="Hibernate-缓存机制"><a href="#Hibernate-缓存机制" class="headerlink" title="Hibernate 缓存机制"></a>Hibernate 缓存机制</h6><ul><li>一级缓存：默认是打开的，其使用的范围为 Session 创建到关闭的范围，且存储数据必须为持久态数据。</li><li><p>一级缓存的特性：持久态的数据会自动更新数据库 ( 不用 session.update(user)、session.save(user) )，过程细节如下：</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Get() 操作后，将返回持久态对象 user 存于一级缓存中，</span></span><br><span class="line"><span class="comment">// 及存一份到缓存中的快照区 (副本)。</span></span><br><span class="line">user = session.get(User.class, attr_id);</span><br><span class="line"><span class="comment">// setXXX() 操作，同时修改持久态对象的值和一级缓存中的内容。</span></span><br><span class="line">user.setUserName(<span class="string">"Sample"</span>);</span><br><span class="line"><span class="comment">// 当提交事务时，会比较一级缓存和快照区，</span></span><br><span class="line"><span class="comment">// 若不相同，会触发更新数据库操作。</span></span><br><span class="line">trans.commit();</span><br></pre></td></tr></table></figure></li></ul><ul><li>二级缓存 (替代技术：<code>redis</code> )：默认关闭，SessionFactroy 的使用范围。</li></ul><h5 id="Hibernate-查询"><a href="#Hibernate-查询" class="headerlink" title="Hibernate 查询"></a>Hibernate 查询</h5><blockquote><p>在 <code>Hibernate 查询方式</code> 小节将详细阐述。</p></blockquote><h6 id="Query-对象"><a href="#Query-对象" class="headerlink" title="Query 对象"></a>Query 对象</h6><blockquote><p>推荐使用</p></blockquote><ul><li><p>使用 Query 对象，不需要写 SQL 语句，以 HQL 替代。</p><blockquote><p>HQL：Hibernate Query Language，有别于 SQL 语句，即：SQL 操作表和表字段，而 HQL 操作实体类和属性。</p></blockquote></li><li><p>Query 对象的使用：</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 Query 对象</span></span><br><span class="line">Query query = session.createQuery(<span class="string">"from User"</span>);</span><br><span class="line"><span class="comment">// 调用 query 对象的方法得到结果</span></span><br><span class="line">List&lt;User&gt; list = query.list();</span><br></pre></td></tr></table></figure></li></ul><h6 id="Criteria-对象"><a href="#Criteria-对象" class="headerlink" title="Criteria 对象"></a>Criteria 对象</h6><ul><li><p>Ceiteria 对象的使用： </p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 Criteria 对象　</span></span><br><span class="line">Criteria criteria = session.createCriteria(User.class);</span><br><span class="line"><span class="comment">// 调用 criteria 对象的方法得到结果</span></span><br><span class="line">List&lt;User&gt; list = criteria.list();</span><br></pre></td></tr></table></figure></li></ul><h6 id="SQLQuery-对象"><a href="#SQLQuery-对象" class="headerlink" title="SQLQuery 对象"></a><del>SQLQuery 对象</del></h6><ul><li><p>SQLQuery 对象的使用：</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 SQLQuery 对象</span></span><br><span class="line">String sql = <span class="string">"SELECT * FROM t_user t WHERE t.username= ? AND t.age = ?"</span>;</span><br><span class="line">SQLQuery sqlQuery = session.createSQLQuery(sql)</span><br><span class="line">    .setParameter(<span class="number">0</span>, <span class="string">"ABC"</span>).setParameter(<span class="number">1</span>, <span class="number">15</span>);</span><br><span class="line">   </span><br><span class="line"><span class="comment">// Case.01. 以数组形式接收结果</span></span><br><span class="line"><span class="comment">// List&lt;Object []&gt; list = sqlQuery.list();</span></span><br><span class="line">   </span><br><span class="line"><span class="comment">// Case.02. 返回目标的 User 对象 </span></span><br><span class="line">sqlQuery.addEntity(User.class);</span><br><span class="line">List&lt;User&gt; list = sqlQuery.list();</span><br></pre></td></tr></table></figure></li></ul><h5 id="Hibernate-多表操作"><a href="#Hibernate-多表操作" class="headerlink" title="Hibernate 多表操作"></a>Hibernate 多表操作</h5><ul><li>数据库的多表查询<ul><li>外键<ul><li>指定外键关键字： Foreign Key(列名)</li><li>引用外键关键字： References &lt;主表名&gt;(主表主键)</li></ul></li><li>关系<ul><li>一对一</li><li>一对多</li><li>多对多</li></ul></li></ul></li></ul><h6 id="一对多操作"><a href="#一对多操作" class="headerlink" title="一对多操作"></a>一对多操作</h6><ul><li><p>一对多映射配置：<code>实体类配置</code></p><ul><li>创建两个实体类，例如：公司和客户 ( 公司是一，客户是多 )；</li><li><p>让两个实体类间互相表示；  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户实体类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123; </span><br><span class="line">    <span class="comment">// 省略其他属性</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 在客户实体类中表示所属公司，一个客户只属于一个公司</span></span><br><span class="line">    <span class="keyword">private</span> Firm firm;</span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirm</span><span class="params">(Firm firm)</span> </span>&#123; <span class="keyword">this</span>.frim = firm; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Firm <span class="title">getFirm</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> firm; &#125;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line"><span class="comment">// 公司实体类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Firm</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 省略其他属性</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Set 集合：无序，元素不可重复</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;Customer&gt; customerSet = <span class="keyword">new</span> HanSet&lt;Customer&gt;();    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;Customer&gt; <span class="title">getCustomerSet</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> customerSet; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomerSet</span><span class="params">(Set&lt;Customer&gt; customerSet)</span> </span>&#123; <span class="keyword">this</span>.customerSet = customerSet; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><ul><li><p>一对多映射配置：<code>XML 配置文件</code>，一个实体类对应一个映射文件，除了映射文件的基本配置之外，且要在映射文件中配置一对多的关系。</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- firm.bhm.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"cn.kofes.entity.Firm"</span> <span class="attr">table</span>=<span class="string">"t_firm"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">     | 表示公司的所有客户</span></span><br><span class="line"><span class="comment">     | Name 属性：属性值写公司实体类里表示客户 Set 集合的对象名称</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"customerSet"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">         | 一对多关系建表，有外键</span></span><br><span class="line"><span class="comment">         | Hibernate 机制，双向维护外键，即在一和多方都配置外键</span></span><br><span class="line"><span class="comment">         | Column 属性：属性值为外键的名称，名称可自定义</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"f_fid"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 公司的所有客户，即 Class 里写客户实体类全路径 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"cn.entity.Customer"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- customer.bhm.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"cn.kofes.entity.Customer"</span> <span class="attr">table</span>=<span class="string">"t_customer"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">     | 表示客户所属公司</span></span><br><span class="line"><span class="comment">     | Name 属性：客户实体类中使用 firm 对象表示</span></span><br><span class="line"><span class="comment">     | Class 属性：Firm 实体类的全路径</span></span><br><span class="line"><span class="comment">     | Column 属性：外键名称，名称可自定义</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"firm"</span> <span class="attr">class</span>=<span class="string">"cn.entity.Firm"</span> <span class="attr">column</span>=<span class="string">"c_fid"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>核心配置文件中，加入 customer.bhm.xml 和 firm.bhm.xml。</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- (必填) 把映射文件放到核心配置文件中 ( 填 Src 之后的路径 ) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"cn/entity/firm.hbm.xml"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"cn/entity/customer.hbm.xml"</span> /&gt;</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>一对多级联的操作实现</p><blockquote><p>在原生数据库中，对包含外键的元组直接删除，是无法成功执行的。正确操作方式为：先删除外键约束，再删除对应元组。但在 Hibernate 中，不用考虑此类问题，因为内置封装了相关功能组件。</p></blockquote><ul><li><p>一对多级联的保存</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Step.01.建立公司对象和客户对象的关系</span></span><br><span class="line">Firm firm = <span class="keyword">new</span> Firm();</span><br><span class="line">Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line"><span class="comment">// Step.02.把客户对象放到公司对象的 Set 集合里</span></span><br><span class="line">firm.getCustomerSet().add(customer);</span><br><span class="line"><span class="comment">// Step.03.把公司对象放到客户对象里</span></span><br><span class="line">customer.setFirm(firm);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 级联保存：即一方和多方都需配置数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">   </span><br><span class="line">session.save(customer);</span><br><span class="line">session.save(firm);</span><br></pre></td></tr></table></figure></li><li><p>一对多级联的删除：在一方 ( 与多方对立 ) 即公司对象，修改其配置文件。</p><p>最后，直接在代码中进行删除操作即可。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- firm.bhm.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"cn.kofes.entity.Firm"</span> <span class="attr">table</span>=<span class="string">"t_firm"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 对 Set 标签的 casade 值为 delete --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"customerSet"</span> <span class="attr">cascade</span>=<span class="string">"delete"</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">   <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><ul><li><p>优化步骤之 <code>Inverse 属性</code></p><blockquote><p>因为 Hibernate 是双向维护外键，在公司和客户里面都需维护外键 ( 从级联删除的执行过程中可体验出来 )。故我们可以设置其中的一方 <code>放弃</code> 维护外键，以优化性能。</p></blockquote>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- firm.bhm.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"cn.kofes.entity.Firm"</span> <span class="attr">table</span>=<span class="string">"t_firm"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"> | Inverse 属性</span></span><br><span class="line"><span class="comment"> | Flase，表示不放弃关系维护</span></span><br><span class="line"><span class="comment"> | True，表示放弃关系维护</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"customerSet"</span> <span class="attr">cascade</span>=<span class="string">"save-update, delete"</span> <span class="attr">inverse</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h6 id="多对多操作"><a href="#多对多操作" class="headerlink" title="多对多操作"></a>多对多操作</h6><ul><li><p>多对多映射配置：实体类配置</p><ul><li>创建两个实体类，例如：用户和角色 ( 一个用户可扮演多个角色，一个角色可由多个用户扮演 )；</li><li><p>让两个实体类间互相表示；  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户实体类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> User &#123;</span><br><span class="line"><span class="comment">// 省略其他属性</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">private</span> Set&lt;Role&gt; roleSet = <span class="keyword">new</span> HanSet&lt;Role&gt;();</span><br><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;Role&gt; <span class="title">getRoleSet</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> roleSet; &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoleSet</span><span class="params">(Set&#123;Role&#125; roleSet)</span> </span>&#123; <span class="keyword">this</span>.roleSet = roleSet; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 角色实体类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> Role &#123;</span><br><span class="line"><span class="comment">// 省略其他属性</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">private</span> Set&lt;User&gt; userSet = <span class="keyword">new</span> HanSet&lt;User&gt;();</span><br><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;User&gt; <span class="title">getUserSet</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> userSet; &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserSet</span><span class="params">(Set&lt;User&gt; userSet &#123; <span class="keyword">this</span>.userSet = userSet; &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span></span></span><br></pre></td></tr></table></figure></li></ul></li></ul><ul><li><p>多对多映射配置：<code>XML 配置文件</code>，一个实体类对应一个映射文件，除了映射文件的基本配置之外，且要在映射文件中配置多对多的关系。</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- user.bhm.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"cn.kofes.entity.User"</span> <span class="attr">table</span>=<span class="string">"t_user"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">     | 在用户中，表示所有的角色</span></span><br><span class="line"><span class="comment">     | Name 属性：属性值写用户实体类里表角色 Set 集合的对象名称</span></span><br><span class="line"><span class="comment">     | Table 属性：填写多对多时，两实体的联系转化成表 ( 第三张表 )</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"roleSet"</span> <span class="attr">table</span>=<span class="string">"t_user_role"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">         | 多对多关系建表，有外键</span></span><br><span class="line"><span class="comment">         | Column 属性：当前用户实体，在第三张表中的外键名称 </span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"u_fid"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">         | Class 属性：填写角色实体类全路径</span></span><br><span class="line"><span class="comment">         | Column 属性：角色实体，在第三张表中的外键名称</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">class</span>=<span class="string">"cn.entity.Role"</span> <span class="attr">column</span>=<span class="string">"r_fid"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- role.bhm.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"cn.kofes.entity.Role"</span> <span class="attr">table</span>=<span class="string">"t_role"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">     | 在角色中，表示所有的用户</span></span><br><span class="line"><span class="comment">     | Name 属性：属性值写角色实体类里表示用户 Set 集合的对象名称</span></span><br><span class="line"><span class="comment">     | Table 属性：填写多对多时，两实体的联系转化成表 ( 第三张表 )</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"userSet"</span> <span class="attr">table</span>=<span class="string">"t_user_role"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">         | 多对多关系建表，有外键</span></span><br><span class="line"><span class="comment">         | Column 属性：当前角色实体，在第三张表中外键的名称</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"r_fid"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">         | Class 属性：填写用户实体类全路径</span></span><br><span class="line"><span class="comment">         | Column 属性：用户实体，在第三张表中外键的名称</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">class</span>=<span class="string">"cn.entity.User"</span> <span class="attr">column</span>=<span class="string">"u_fid"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>核心配置文件中，加入 customer.bhm.xml 和 firm.bhm.xml。</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- (必填) 把映射文件放到核心配置文件中 ( 填 Src 之后的路径 ) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"cn/entity/user.hbm.xml"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"cn/entity/role.hbm.xml"</span> /&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>多对多级联的操作实现</p><ul><li><p>多对多级联保存</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 和一对多级联操作一样，在用户配置文件 user.hbm.xml 中，</span></span><br><span class="line"><span class="comment">// 对 Set 标签的 casade 值为 save-update</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 多对多级联保存</span></span><br><span class="line">User user_1 = <span class="keyword">new</span> User();</span><br><span class="line">User user_2= <span class="keyword">new</span> User();</span><br><span class="line">Role role_1 = <span class="keyword">new</span> Role();</span><br><span class="line">Role role_2 = <span class="keyword">new</span> Role();</span><br><span class="line">Role role_3 = <span class="keyword">new</span> Role();</span><br><span class="line"></span><br><span class="line"><span class="comment">// user_1 拥有角色 1、2，user_2 拥有角色 2、3</span></span><br><span class="line">user_1.getRoleSet().add(role_1);</span><br><span class="line">user_1.getRoleSet().add(role_2);</span><br><span class="line">user_2.getRoleSet().add(role_2);</span><br><span class="line">user_2.getRoleSet().add(role_3);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保存用户即可 ( 对应于配置文件中设置了 casade 值的实体 )</span></span><br><span class="line">session.save(user_1);</span><br><span class="line">session.save(user_2);</span><br></pre></td></tr></table></figure></li><li><p>多对多级联删除 ( 不推荐 )：配置文件；最后，直接在代码中进行删除操作即可。</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 和一对多级联操作一样，在用户配置文件 user.hbm.xml 中，</span><br><span class="line">// 对 Set 标签的 casade 值为 delete ( 可以与保存的属性共存 )</span><br><span class="line"><span class="comment">&lt;!-- user.bhm.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"cn.kofes.entity.User"</span> <span class="attr">table</span>=<span class="string">"t_user"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"roleSet"</span> <span class="attr">table</span>=<span class="string">"t_user_role"</span> <span class="attr">casade</span>=<span class="string">"save-update, delete"</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>维护多对多的关系，通过维护 <code>第三张表</code> ( 两实体的联系转化成的表 ) 实现。</p></li></ul></li></ul><h5 id="Hibernate-HQL-查询详解"><a href="#Hibernate-HQL-查询详解" class="headerlink" title="Hibernate HQL 查询详解"></a>Hibernate HQL 查询详解</h5><ul><li><code>OID</code> 查询和 <code>对象导航</code> 查询 </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单元测试类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelect1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SessionFactory sessionFactory = <span class="keyword">null</span>;</span><br><span class="line">        Session session = <span class="keyword">null</span>;</span><br><span class="line">        Transaction trans = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sessionFactory = HibernateUtils.getSessionFactory();</span><br><span class="line">            session = sessionFactory.openSession();</span><br><span class="line">            trans = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 需求：根据 ID 查询某个公司，再查询这个公司的所有客户</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// OID 查询：查询 ID 为 1 的公司</span></span><br><span class="line">            Firm firm = session.get(Firm.class, <span class="number">1</span>); <span class="comment">// </span></span><br><span class="line">            <span class="comment">// 对象导航查询：根据某条记录的 ID，返回对象 (公司的客户)</span></span><br><span class="line">            Set&lt;Customer&gt; customer = firm.getCustomerSet();</span><br><span class="line">            System.out.print( customer.toString() );</span><br><span class="line"></span><br><span class="line">            trans.commit();</span><br><span class="line">        &#125; <span class="keyword">catch</span>(Exception ex) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            transaction.rollback();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            session.close();</span><br><span class="line">            sessionFactory.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="HQL-查询"><a href="#HQL-查询" class="headerlink" title="HQL 查询"></a>HQL 查询</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Step.01.创建 Query 对象，写 HQL 语句实现查询</span></span><br><span class="line"><span class="comment">// Step.02.调用 query 对象的方法得到结果</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询所有</span></span><br><span class="line">Query query = session.createQuery(<span class="string">"FROM t_user"</span>);</span><br><span class="line">List&lt;User&gt; list = query.list();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 条件查询</span></span><br><span class="line">String sql_obscure = <span class="string">"FROM t_user WHERE username LIKE ?"</span>; <span class="comment">// 模糊查询</span></span><br><span class="line">String sql_accurate = <span class="string">"FROM t_user WHERE age = ? AND username = ?"</span>; <span class="comment">// 精确查询</span></span><br><span class="line">Query query = session.createQuery(sql_accurate);</span><br><span class="line"><span class="comment">// arg0 为占位符位置，arg1 为参数</span></span><br><span class="line">query.setParameter(<span class="number">0</span>, <span class="number">25</span>).setParameter(<span class="number">1</span>, <span class="string">"Lucy"</span>);</span><br><span class="line">List&lt;User&gt; list = query.list();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 排序查询：ASC，升序 / DESC，降序</span></span><br><span class="line">String sql = <span class="string">"FROM t_user ORDER BY uid ASC"</span>; </span><br><span class="line">Query query = session.createQuery(sql);</span><br><span class="line">List&lt;User&gt; list = query.list();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 分页查询：LIMIT 关键字</span></span><br><span class="line">String sql = <span class="string">"FROM t_user"</span>;</span><br><span class="line">Query query = session.createQuery(sql);</span><br><span class="line">query.setFirstResult(<span class="number">0</span>);</span><br><span class="line">query,.setMaxResults(<span class="number">10</span>);</span><br><span class="line">List&lt;User&gt; list = query.list();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 投影查询</span></span><br><span class="line">String sql = <span class="string">"SELECT username, age FROM t_user"</span>;</span><br><span class="line">Query query = session.createQuery(sql);</span><br><span class="line">List&lt;Object&gt; list = query.list();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 聚集函数</span></span><br><span class="line"><span class="comment">// COUNT()、SUM()、MAX()、MIN()...</span></span><br><span class="line">String sql = <span class="string">"SELECT COUNT(*) FROM t_user"</span>;</span><br><span class="line">Query query = session.createQuery(sql);</span><br><span class="line"><span class="comment">// 将结果以对象形式返回</span></span><br><span class="line">Object obj = query.uniqueResult();</span><br></pre></td></tr></table></figure><h6 id="HQL-多表查询"><a href="#HQL-多表查询" class="headerlink" title="HQL 多表查询"></a>HQL 多表查询</h6><ul><li><p>内连接：连接两个表有关联的数据，忽略两个表中对应不起来的数据。</p><ul><li>SQL：SELECT * FROM t_user AS u, t_role AS r ON  u.uid = r.uid;<ul><li>或者：SELECT * FROM t_user u INNER JOIN t_role r ON  u.uid = r.uid;</li></ul></li></ul></li><li><p>左外链接：左边表所有元组，右边表关联数据。</p><ul><li>若左表与右表没有关联数据，则右边表数据补 NULL 值，多了则删除</li><li>SQL：SELECT * FROM t_user u LEFT OUTER JOIN t_role r ON  u.uid = r.uid;</li></ul></li><li>右外链接：与左外链接同理。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HQL 内连接 ( 左、右外链接同理 )</span></span><br><span class="line">String sql_inner_join = <span class="string">"FROM t_user u INNER JOIN u.roleSet"</span>;</span><br><span class="line">Query query = session.createQuery(sql_inner_join);</span><br><span class="line">List list = query.list(); <span class="comment">// list 返回的每部分都是数组</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// HQL 迫切内连接</span></span><br><span class="line">String sql_inner_join_fetch = <span class="string">"FROM t_user u INNER JOIN FETCH u.roleSet"</span>;</span><br><span class="line">Query query = session.createQuery(sql_inner_join_fetch);</span><br><span class="line">List list = query.list();  <span class="comment">// list 返回的每部分都是对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// HQL 迫切左外连接  ( 没有迫切右外连接 )</span></span><br><span class="line">String sql_inner_join_fetch = <span class="string">"FROM t_user u LEFT OUTER JOIN FETCH u.roleSet"</span>;</span><br></pre></td></tr></table></figure><h5 id="Hibernate-检索策略"><a href="#Hibernate-检索策略" class="headerlink" title="Hibernate 检索策略"></a>Hibernate 检索策略</h5><h6 id="立即查询"><a href="#立即查询" class="headerlink" title="立即查询"></a>立即查询</h6><p>根据 ID 查询，调用 get() 方法，则马上发送语句查询数据库。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Debug 方式可检验，即执行代码马上发送 SQL 语句</span></span><br><span class="line">User user = session.get(User.class, <span class="number">1</span>);</span><br></pre></td></tr></table></figure><h6 id="延迟查询"><a href="#延迟查询" class="headerlink" title="延迟查询"></a>延迟查询</h6><p>根据 ID 查询，调用 load() 方法，不会马上发送语句查询数据库，只有得到对象的值时，才发送语句查询数据库。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用 load() 方法之后，并不会马上发送 SQL 语句</span></span><br><span class="line">User user = session.load(User.class, <span class="number">1</span>);</span><br><span class="line">System.out.println( user.getUid() );</span><br><span class="line"><span class="comment">// 当得到对象里其他值时，即非 ID 值，才发送 SQL 语句进行查询</span></span><br><span class="line">System.out.println( user.getUsername() );</span><br></pre></td></tr></table></figure><ul><li>类级别延迟：例如，根据 ID 查询返回实体类对象，调用 load() 方法不会马上发送 SQL 语句。 </li><li><p>关联级别查询：例如上述 <code>对象导航查询</code>，查询某个公司后，再查询这间公司的所有客户，查询公司所有客户的过程是否需要延迟，则称其为关联级别延迟。</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment"> | 在配置文件中实现关联级别延迟</span></span><br><span class="line"><span class="comment"> | fetch 属性：select</span></span><br><span class="line"><span class="comment"> | lazy 属性：true / false / extra</span></span><br><span class="line"><span class="comment"> | - True，当得到对象里其他值时，即非 ID 值，才发送 SQL 语句进行查询。</span></span><br><span class="line"><span class="comment"> | - False，反之，会多执行一次查询 ( getUid() )。</span></span><br><span class="line"><span class="comment"> | - Extra，需要什么属性，查询什么属性 ( 仅需少量属性时推荐使用 )</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"cn.kofes.entity.User"</span> <span class="attr">table</span>=<span class="string">"t_user"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"roleSet"</span> <span class="attr">table</span>=<span class="string">"t_user_role"</span> <span class="attr">fetch</span>=<span class="string">"select"</span> <span class="attr">lazy</span>=<span class="string">"true"</span> &gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h6 id="批量抓取"><a href="#批量抓取" class="headerlink" title="批量抓取"></a>批量抓取</h6><ul><li><p>例如，我们需要查询所有公司的所有客户，代码实现如下：</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Criteria criteria = session.createCriteria(User.class);</span><br><span class="line">List&lt;Firm&gt; list = criteria.list();</span><br><span class="line"><span class="keyword">for</span>(Firm firm : list) &#123;</span><br><span class="line">    System.out.println( firm.getId() + <span class="string">":"</span> + firm.getName() );</span><br><span class="line">    Set&lt;Customer&gt; customerSet = firm.getCustomerSet();</span><br><span class="line">    <span class="keyword">for</span>(Customer customer : customerSet) &#123;</span><br><span class="line">        System.out.println( customer.getUid() + <span class="string">":"</span> + customer.getUsername() );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 但在执行过程中，暴露的问题时：每次循环都执行一次查询，拖沓性能</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>故我们只需要在实体映射配置文件中，对 Set 标签进行设置属性即可：</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- firm.bhm.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"cn.kofes.entity.Firm"</span> <span class="attr">table</span>=<span class="string">"t_firm"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- batch-size 的值为整数即可 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"customerSet"</span> <span class="attr">batch-size</span>=<span class="string">"10"</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><hr><h4 id="SSH-框架总结"><a href="#SSH-框架总结" class="headerlink" title="SSH 框架总结"></a>SSH 框架总结</h4><h5 id="Struts-1"><a href="#Struts-1" class="headerlink" title="Struts"></a>Struts</h5><ul><li>Action 操作<ul><li>Action 创建 (三种方式)：继承 <code>ActionSupport</code> 类。</li><li>Action 访问路径：创建 <code>struts.xml</code> 配置文件，文件名称和位置 ( Src 目录 ) 固定。</li><li>访问 Action 的多个方法：使用 <code>通配符方式</code> 配置。</li><li>Action 获取表单提交数据：<ul><li>获取 Request 对象 ( 使用 <code>ServletAction</code> 类 )；</li><li>属性封装；</li><li>模型驱动；</li></ul></li><li>Action 操作域对象：使用 <code>ServletAction</code> 类。</li><li>配置 Struts2 过滤器。</li></ul></li><li>值栈<ul><li>向值栈放数据：<ul><li>Set 方法；</li><li>Push 方法；</li><li>定义变量，生成 Get 方法.</li></ul></li><li>从值栈获取数据：在 JSP 中使用 Struts2 标签 + Ognl 获取<ul><li><code>&lt;s:property /&gt;</code></li><li><code>&lt;s:iterator /&gt;</code></li></ul></li></ul></li><li>拦截器<ul><li>AOP 和责任链模式；</li><li>自定义拦截器：<ul><li>继承 <code>MethodFilterInterceptor</code> 类，并重写类方法；</li><li>配置拦截器和 Action 关联.</li></ul></li></ul></li></ul><h5 id="Spring-1"><a href="#Spring-1" class="headerlink" title="Spring"></a>Spring</h5><ul><li>Spring 核心配置文件：<ul><li>名称和位置没有固定要求；</li><li>在 Spring 核心配置文件中引入 Schema 约束.</li></ul></li><li>创建对象：<ul><li>XML 配置方式：<code>&lt;bean id=&quot;&quot; class=&quot;&quot; /&gt;</code>；</li><li>注解方式：<code>@Component</code> 或 <code>@Controller</code> (Web层)、<code>@Service</code> (业务层)、<code>@Repository</code> (持久层).</li></ul></li><li>注入属性:<ul><li>XML 配置方式：<code>&lt;bean id=&quot;&quot; class=&quot;&quot;&gt;&lt;property name=&quot;&quot; ref=&quot;&quot; /&gt;&lt;/bean&gt;</code>；</li><li>注解方式：<code>@autowired</code>、<code>@Resource(name=&quot;value&quot;)</code>.</li></ul></li><li>使用 ServletContext 对象和监听器实现<ul><li>在服务器启动时，加载 Spring 配置文件，创建对象；</li><li>配置 Spring 的监听器；</li><li>指定 Spring 配置文件位置.</li></ul></li><li>Spring JdbcTemplate </li><li>Spring 事务配置：<ul><li>XML 配置方式；</li><li>注解方式：<code>@Transational</code></li></ul></li></ul><h5 id="Hibernate-1"><a href="#Hibernate-1" class="headerlink" title="Hibernate"></a>Hibernate</h5><ul><li>ORM 思想：<code>对象关系映射</code>，参考 <a href="#ORM-框架">ORM 框架</a>；</li><li>数据库信息配置：MySQL / SQL Server 2008 R2；</li><li><p>Hibernate 信息配置：即配置 Hibernate 核心配置文件 ( <code>hibernate.cfg.xml</code> )。</p><blockquote><p>Hibernate 和 Spring 整合时，配置文件的名称和位置是没有固定要求的。</p></blockquote></li><li><p>映射关系配置：即配置 Hibernate 映射配置文件 ( <code>xxx.hbm.xml</code> )，实体类和数据表映射关系 ( 使用 ORM 思想 )。</p></li><li>Hibernate 操作步骤：Spring 框架对 Hibernate 框架也有封装，即 <code>HibernateTemplate</code> 类。</li></ul><h4 id="SSH-框架整合"><a href="#SSH-框架整合" class="headerlink" title="SSH 框架整合"></a>SSH 框架整合</h4><p><img src="/images/illustration/Project/2018/08/J2EE-SSH-SSI-1_6-1.png" alt="SSH框架整合思想"></p><center>图 6-1 SSH 框架整合思想</center><ul><li><p>Spring 与 Struts 2 框架的整合</p><p>  把 Struts 2 的 Action 对象创建交给 Spring 进行管理。</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">""</span> <span class="attr">scope</span>=<span class="string">"prototype"</span> /&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>Spring 与 Hibernate 框架的整合</p><p>  把 Hibernate 的核心配置文件里的数据库配置，直接写在 Spring 配置文件中。且把 SessionFactory 对象创建交给 Spring 管理。</p></li></ul><h4 id="SSH-整合演示"><a href="#SSH-整合演示" class="headerlink" title="SSH 整合演示"></a>SSH 整合演示</h4><h5 id="Spring-与-Struts-2-整合"><a href="#Spring-与-Struts-2-整合" class="headerlink" title="Spring 与 Struts 2 整合"></a>Spring 与 Struts 2 整合</h5><ul><li><p>Action 代码实现：</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cn.kofes.dao.BaseAction.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"The portion of action has deployed successfully."</span>);</span><br><span class="line">        <span class="keyword">return</span> NONE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>在 Spring  配置文件下整合 Struts：</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring.xml --&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context-2.5.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop/spring-aop-2.5.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/tx/spring-tx-2.5.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 整合 Struts：Action 对象的配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"BaseAction"</span> <span class="attr">class</span>=<span class="string">"cn.kofes.action.BaseAction"</span> <span class="attr">scope</span>=<span class="string">"prototype"</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>整合 Web，当服务器启动时加载 Spring 配置即初始化，我们需要在 web.xml 下配置监听器：</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- web.xml --&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">version</span>=<span class="string">"4.0"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 加载 Spring 的配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 监听器模块：作用就是启动 Web 容器时,自动装配 spring.xml 文件的配置信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 过滤器模块 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><ul><li><p>最后，struts.xml 填入以下配置即可：</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">    "-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">    "http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"sample"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">         | Class 属性值不写目标 Action 的全路径，原因是防止二次创建对象</span></span><br><span class="line"><span class="comment">         | 引入 Spring 相对应  Action 的 Bean 标签 ID</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"BaseAction"</span> <span class="attr">class</span>=<span class="string">"BaseAction"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h5 id="Spring-与-Hibernate-整合"><a href="#Spring-与-Hibernate-整合" class="headerlink" title="Spring 与 Hibernate 整合"></a>Spring 与 Hibernate 整合</h5><ul><li><p>在 Spring  配置文件下配置数据库信息，及整合 Hibernate。后者即将 SessionFacotry 交由 Spring 管理：</p><blockquote><p><code>c3p0.properties</code> 和 <code>hibernate.properties</code> 配置文件位于 Src 根目录下，键值分离以便以后修改配置。</p></blockquote>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- spring.xml --&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context-2.5.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop/spring-aop-2.5.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/tx/spring-tx-2.5.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 在根目录下新建文件 c3p0.properties，存储数据库连接信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:c3p0.properties"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Data Connection Settings --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 引用 c3p0.properties 的键值对即可，格式如 $&#123;key.value&#125; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.driverClass&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.jdbcUrl&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.user&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.password&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置数据库连接池的最大连接数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxPoolSize"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.maxPoolSize&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置数据库连接池的最小连接数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minPoolSize"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.minPoolSize&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置数据库连接池的初始化连接数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"initialPoolSize"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.initialPoolSize&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置数据库连接池的连接最大空闲时间 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdleTime"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.maxIdleTime&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- c3p0缓存Statement的数量数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxStatements"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.maxStatements&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 当连接池的连接用完的，从 C3p0 下获取新的连接数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"acquireIncrement"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.acquireIncrement&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"checkoutTimeout"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.checkoutTimeout&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"idleConnectionTestPeriod"</span> <span class="attr">value</span>=<span class="string">"$&#123;datasource.idleConnectionTestPeriod&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 整合 Hibernate：SessionFactory 对象的配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionFactory"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate5.LocalSessionFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- (必填信息) 指定数据库 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- (可选信息) 配置 Hibernate 信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernateProperties"</span> <span class="attr">value</span>=<span class="string">"classpath:hibernate.properties"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- (必填信息) 指定使用 Hibernate 核心配置文件位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocations"</span> <span class="attr">value</span>=<span class="string">"classpath:hibernate.cfg.xml"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>创建实体类：</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Employee.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sample</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>创建实体类映射文件 ( 文件位置没有固定要求，建议统一文件夹存储 )：</p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- src/resource/HbmCollection/sample.hbm.xml --&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">     | name 属性：实体类全路径</span></span><br><span class="line"><span class="comment">     | table 属性：数据库表名称</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"cn.kofes.bean.Sample"</span> <span class="attr">table</span>=<span class="string">"t_sample"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">         | Hibernate 要求实体类有一个属性唯一值，且要求表有字段作为唯一值</span></span><br><span class="line"><span class="comment">         | name 属性：实体类的 id 属性名称</span></span><br><span class="line"><span class="comment">         | column 属性：数据表字段名称</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 设置数据库表 id 增长策略：Class 标签</span></span><br><span class="line"><span class="comment">             | 属性值：increment、hilo、squence、identity、native、uuid、guid 等。</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 配置其他属性和表字段对应：Property 标签 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"string"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在 <code>核心配置文件</code> 中引入 <code>映射配置文件</code>：</p><blockquote><p>核心配置文件的名称和位置固定，名称为 <code>hibernate.cfg.xml</code>，目录放置于 <code>根目录</code>。</p></blockquote>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span><br><span class="line">!DOCTYPE hibernate-configuration PUBLIC</span><br><span class="line">    "-//Hibernate/Hibernate Configuration DTD//EN"</span><br><span class="line">    "http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- (必填) 把映射文件放到核心配置文件中 ( 填 Src 之后的路径 ) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"HbmCollection/sample.hbm.xml"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>事务配置：在 spring.xml 配置文件中配置并开始事务注解，再到 Service 层添加注解 <code>@Transactional</code>： </p>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置事务管理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate5.HibernateTransactionManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sessionFactory"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--  开始事务注解 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span> /&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h5 id="SSH-框架使用演示"><a href="#SSH-框架使用演示" class="headerlink" title="SSH 框架使用演示"></a>SSH 框架使用演示</h5><p>SSH 整合工作告一段落，当然你可通过 Maven 打包工程，以便以后复用。</p><h3 id="SSM-框架"><a href="#SSM-框架" class="headerlink" title="SSM 框架"></a>SSM 框架</h3><blockquote><p>当然，随着框架技术的迭代更新，更加科学、合理的新框架也逐渐在项目中使用起来，如 SSM 框架。具体细节可参考：<a href="#">Java EE 之 SSM 框架配置与使用</a></p></blockquote><ul><li><p><code>SSM 框架</code>：Spring MVC、Spring、MyBatis</p><p>  SSM ( Spring + SpringMVC + MyBatis ) 框架集由 Spring、SpringMVC、MyBatis 三个开源框架整合而成，常作为数据源较简单的 Web 项目的框架。</p></li><li><p><code>Spring</code>：是一个轻量级的控制反转 (IoC) 和面向切面 (AOP) 的容器框架。</p><blockquote><p>与本文的 Spring 章节内容相同。</p></blockquote></li><li><p><code>SpringMVC</code>：分离了控制器、模型对象、分派器以及处理程序对象的角色，这种分离让它们更容易进行定制。</p></li><li><code>Mybatis</code>：<a href="http://blog.mybatis.org/" target="_blank" rel="noopener">Mybatis</a> 是一个支持普通SQL查询，存储过程和高级映射的优秀持久层框架。它支持定制化 SQL、存储过程以及高级映射。MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。MyBatis 可以使用简单的 XML 或注解来配置和映射原生信息，将接口和 Java 的 POJOs (Plain Old Java Objects，普通的 Java对象 ) 映射成数据库中的记录。</li></ul><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li>[1] <a href="https://blog.csdn.net/weixin_37852133/article/details/62416263" target="_blank" rel="noopener"> 笨笨CEO. 利用 IntelliJ Idea 搭建 SSH 框架. csdn.net</a></li><li>[2] <a href="http://blog.lunhui.ren/archives/225" target="_blank" rel="noopener">刻下岁月. IntelliJ IDEA 2016.1.2 + Spring + Struts2 + Hibernate ( SSH ). lunhui.ren</a> </li><li>[3] <a href="https://www.cnblogs.com/xieyupeng/p/7108141.html" target="_blank" rel="noopener">kent. JavaEE SSH 三大框架整合 ( Spring + Struts2 + Hibernate ). cnblogs.com</a></li><li>[4] <a href="https://www.cnblogs.com/hoobey/p/5508992.html" target="_blank" rel="noopener">Starskyhu. Hibernate 各种主键生成策略与配置详解. cnblogs.cn</a></li><li>[5] <a href="https://blog.csdn.net/chentiefeng521/article/details/58775415" target="_blank" rel="noopener">陈铁锋. Hibernate 连接三种数据库的配置 ( SQL Server、Oracle、MySQL ). csdn.net</a></li><li>[6] <a href="https://www.cnblogs.com/roadofstudy/p/7446690.html" target="_blank" rel="noopener">RoadOfStudy. MySQL 5.7版本的root用户重置密码问题. cnbolgs.com</a></li><li>[7] <a href="https://blog.csdn.net/time_tries_all/article/details/78571984" target="_blank" rel="noopener">Time Tries All. MySQL 重置密码出现的一系列问题. csdn.net</a></li><li>[8] <a href="http://www.souvc.com/?p=915" target="_blank" rel="noopener">Souvc. 连接虚拟机 (Ubuntu16.04) 的 MySQL 服务器. souvc.com</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;序言&quot;&gt;&lt;a href=&quot;#序言&quot; class=&quot;headerlink&quot; title=&quot;序言&quot;&gt;&lt;/a&gt;序言&lt;/h2&gt;&lt;p&gt;本文章主要围绕 J2EE 中 SSH ( Spring、Struts、Hibernate ) 框架的配置以及使用问题展开学习的，最终目的是输出可复用的版本，以供后续的项目复用。当然，学习和配置的过程难免有不恰当或错误之处，还望朋友指出、斧正。&lt;/p&gt;
&lt;h2 id=&quot;更新进度&quot;&gt;&lt;a href=&quot;#更新进度&quot; class=&quot;headerlink&quot; title=&quot;更新进度&quot;&gt;&lt;/a&gt;更新进度&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;2018.07.17：完成初稿，IDE 搭建、框架初识章节；&lt;/li&gt;
&lt;li&gt;2018.07.18：完成 SSH 框架 Hibernate 部分的初稿；&lt;/li&gt;
&lt;li&gt;2018.07.20：更新 SSH 框架 Hibernate 部分内容；&lt;/li&gt;
&lt;li&gt;2018.07.28：完成 SSH 框架 Spring 部分的初稿；&lt;/li&gt;
&lt;li&gt;2018.07.31：更新 SSH 框架 Spring 部分内容；&lt;/li&gt;
&lt;li&gt;2018.08.03：整合 SSH 框架；&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;教学视频&quot;&gt;&lt;a href=&quot;#教学视频&quot; class=&quot;headerlink&quot; title=&quot;教学视频&quot;&gt;&lt;/a&gt;教学视频&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.bilibili.com/video/av14839030&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;黑马程序员. J2EE 进阶. 60 集精通 Spring 框架. 2017. bilibili.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.bilibili.com/video/av13748042&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;黑马程序员. J2EE 进阶. Struts2 框架精品教程. 2017. bilibili.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://www.bilibili.com/video/av14626440&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;黑马程序员. J2EE 进阶. 4 天精通 Hibernate 框架. 2017. bilibili.com&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;本框架的学习笔记是基于此系列教学视频所得的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Project" scheme="http://www.kofes.cn/categories/Project/"/>
    
    
      <category term="J2EE" scheme="http://www.kofes.cn/tags/J2EE/"/>
    
      <category term="JSP" scheme="http://www.kofes.cn/tags/JSP/"/>
    
      <category term="SSH" scheme="http://www.kofes.cn/tags/SSH/"/>
    
      <category term="Hibernate" scheme="http://www.kofes.cn/tags/Hibernate/"/>
    
      <category term="Spring" scheme="http://www.kofes.cn/tags/Spring/"/>
    
      <category term="Struts" scheme="http://www.kofes.cn/tags/Struts/"/>
    
  </entry>
  
  <entry>
    <title>论文 - 从商用车队的 GPS 数据中归类车辆停留意图信息</title>
    <link href="http://www.kofes.cn/2018/06/Stop-purpose-classification-from-GPS-data-of-commercial-vehicle-fleets.html"/>
    <id>http://www.kofes.cn/2018/06/Stop-purpose-classification-from-GPS-data-of-commercial-vehicle-fleets.html</id>
    <published>2018-06-11T16:58:25.000Z</published>
    <updated>2018-07-08T09:09:15.693Z</updated>
    
    <content type="html"><![CDATA[<div class="note default"><p>原文：Stop purpose classification from GPS data of commercial vehicle fleets<br>作者：Sarti L, Bravi L, Sambo F.<br>来源：Data Mining Workshops, 2017 IEEE International Conference on. IEEE, 2017: 280-287.  </p></div><h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>从原始 GPS (全球定位系统) 数据中提取 <code>汽车停靠意图数据</code> 是大多数位置感知应用程序中的关键任务，且随着从移动设备收集 GPS 数据的不断增长，这项任务变得越来越有趣。近期很多研究都集中在行人 (手机) 数据上 (可理解为红海市场)，而商用车领域几乎没有探索 (蓝海市场)。</p><p>在本论文中，针对车辆 GPS 数据的汽车停靠意图的 <code>识别</code> 和 <code>分类</code> 问题 (利用来自不同行业的商业车队的大型异构数据集)。按照意图分类，旨在把汽车停靠点分为：<code>工作相关</code> 和 <code>非工作相关</code>，以挖掘相关商业价值。</p><p>且还对每个汽车停靠点计算一组含 100 个不同特征的集合，特征可分为四个主要类别：<code>汽车停靠点特征</code>，<code>兴趣点特征</code>，<code>汽车停靠点集群特征</code> 和 <code>序列特征</code>。并通过随机森林分类模型，评估四组特征中每个特征对停靠点的相对重要性，以处理不同类型的问题。</p><p>实验结果表明，本论文的方法显着地超越了现有商业车辆背景下用于汽车停靠意图的分类模型。</p><a id="more"></a><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h3><p>在过去的十年中，GPS 设备的巨大推广，使得人们越发关注 <code>数据挖掘算法</code> 在 <code>时空数据</code> (GPS 产生的数据) 中的应用。而许多实际应用需要使用关于用户行为和地理位置的语义信息。例如，下述的两个实例：</p><ul><li>基于用户的历史位置以衡量用户之间的相似度 $^{[1]}$；</li><li>基于位置的兴趣地点推荐系统 $^{[2]}$。</li></ul><p>语义标记 GPS 数据，目标旨在 <code>识别</code> 和 <code>归类</code> GPS 沿途轨迹上的位置信息，即具体工作有 <code>语义位置的侦察</code> 和 <code>汽车停靠或出游的意图识别</code>。尽管上述问题不是同一类型的问题，但却是强相关的。例如，对多个用户而言具有相同意图的共同定位点，可能是语义上相关联的地方，因为知道某个地方的语义对分类每个汽车停靠点意图有很大的帮助。</p><p>通常，对于上述 <code>识别</code> 和 <code>归类</code> 问题的解决方法分两个阶段执行：</p><ul><li><p><code>侦查兴趣地点</code>：通常以非监督的方式实现位置侦查 $^{[3,4]}$，而作者提出了基于 <code>DBSCAN</code> $^{[5\,or\,6]}$ 的修改版本的聚类算法，即利用层次聚类从汽车停靠位置中提取访问点。</p><blockquote><p>当要处理非常大的数据集时需要考虑计算性能的问题，可参考其他论文中的扩展方法，例如对地点坐标进行哈希散列法 $^{[7,8]}$。</p></blockquote></li><li><p><code>对侦查到的地点分类</code>：对有关地点或汽车停靠点进行分类，可以在文献中找到两种主要方法：</p><ul><li>基于规则的系统 $^{[9,10]}$，其主要依赖于活动的位置、土地利用的数据以及机器学习方法，即活动本身提取特征；</li><li><p>利用 SVM 分类器来区分标识位置内的活动停靠点和非活动停靠点。分类器 (SVM，随机森林或逻辑回归) 利用时间和空间特征 $^{[6]}$，以及隐马尔可夫模型 (HMM) 利用时序特征把这些汽车停靠点分类为预定义类型。</p><blockquote><p>1) SVM 提取三个主要特征：停车驻留时间，每个汽车停靠地段周围的点到质心的平均距离。<br>2) 地点的语义分类是基于GPS数据和卫星图像的组合而定的 $^{[8]}$。  </p></blockquote></li></ul></li></ul><p>最后说明，本论文解决了与参考文献 [7] 的同样问题，即利用四个不同的特征集，使用一个随机森林分类器，对商业车队的汽车停靠意图数据进行分类。且本文的主要贡献如下：</p><ul><li>描述了一种方法，即从 GPS Pings (GPS 定位仪) 中提取汽车停靠点信息，并从工作状态停车点一览表 (已知的地点信息) 中給它们分配地面实况标签 (贴标签);</li><li>基于带标签的数据集，建立了一个模型，可以自动分类汽车停靠点，即工作状态和非工作状态的停靠点;</li><li>提供了严格评估的多类型特征集，便于我们处理不同问题，其中包括：<ul><li>汽车停靠点特征 (Stop-wise features，SWF)；</li><li>兴趣点特征 (Points of interest features，POIF)；</li><li>停靠点集群特征 (Stop Cluster，CF)；</li><li>序列特征 (Sequential features，SeqF).</li></ul></li></ul><h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><h4 id="GPS和工单数据"><a href="#GPS和工单数据" class="headerlink" title="GPS和工单数据"></a>GPS和工单数据</h4><ul><li>本论文采用的数据集由 Fleetmatics 公司 (车队情报公司) 提供。</li><li>采集的数据有两种类型，分别是<code>原始 GPS pings 数据</code> 和 <code>工单数据</code>。<ul><li>原始 GPS Pings 数据<ul><li>提供有关车辆位置的信息，工单状态的信息，有关司机执行的工作进度及进度信息；</li><li>设定有一系列的 GPS Pings $\{P_i\}_{i=1}^n = \{P_1, …, P_n\}$ 分别描述每辆车行驶的路线。</li><li>每一个 GPS Ping $P_i$ 包含每辆车的状态信息，即有车辆 ID $v_i$，经度和纬度 (位置信息 $p_i$)，里程表 $d_i$，时间戳 $t_i$ 和 事件代码 $e_i$。</li></ul></li><li>工单数据<ul><li>设定有一系列的工单 $\{W_i\}_{i=1}^n = \{W_1, …, W_n\}$。</li><li>每一个工单包含的信息有：车辆 ID $v_i$，经度和纬度 (位置 $p_i$)，时间戳 $t_i$ 和 状态代码 $c_i$ (例如：挂起，启动，完成)。</li></ul></li></ul></li></ul><h4 id="车辆停靠侦查技术"><a href="#车辆停靠侦查技术" class="headerlink" title="车辆停靠侦查技术"></a>车辆停靠侦查技术</h4><p>正如上述所描述的，关于瞬时车辆位置的原始数据是由 GPS Ping 组成的，将它们汇集起来以描述车辆的活动。为此本论文开发了一个 <code>时空聚类程序</code>。</p><ul><li>首先得为每个 GPS 信息分配一种状态类型 (Engine off，iDling，Journey)，然后把它们聚集成 GPS Ping 群组，并把这个 GPS Ping 群组称为 <code>汽车停靠点集</code>。</li><li>GPS Ping 的状态可分为三种类型：<ul><li><code>Engine Off (发动机关闭状态)</code>：发动机关闭事件。即这些 Ping 在发动机关闭的瞬间产生的 (当发动机处于关闭状态时不发送 Ping);</li><li><code>iDling (空转/怠速状态)</code>：发动机处于开启状态，但车辆静止或车辆在小区域内仍然缓慢行驶。对于后者，我们还需要作一些约束，设定 $H(p_i,p_{i-1})$ 表示两点间的半正定距离。然后，对于给定车辆给予一对连续的 Ping $P_{i-1}\,and\,P_i$，且满足以下约束，则可定义为怠速：<ul><li>$s_i = H(p_i,p_{i-1})\,/\,(t_i - t_{i-1}) \leq 1.4\,m/s\,(5km/h)$，确定速度接近零；</li><li>$H(p_i,p_{i-1}) \leq 150\,m$，确保 $P_{i-1}\,and\,P_i$ 足够接近，且避免了由于丢失数据而产生的 <code>伪影</code>。</li></ul></li><li><code>Journey (行驶状态)</code>：即不是发动机关闭状态，也不是怠速状态。</li></ul></li><li>当 Ping 被分类后，以每辆车为单位，按时间顺序排序；并把所有连续的怠速状态和发动机关闭状态的 Ping 聚集成集群 (并不会被其中 Journey 状态的 Ping 給分割开来)。</li><li><p>由于丢失数据，导致一组连续的怠速状态 Ping 彼此相对较远地分布开来。故我们得重新执行 <code>时间-空间</code> 的约束条件 ($s_i \leq 1.4\,m/s$ and $H(p_i,p_{i-1}) \leq 150\,m$)。</p><blockquote><p>无法满足约束条件：即一组连续的怠速状态 Ping 将被分隔得很远，其中的 Journey 状态的 Ping 都给丢失了。 </p></blockquote></li><li><p>以这种方式创建的 <code>Pings 集群</code> 代表我们想要分类的 <code>已识别的汽车停靠点</code>。综上所述，汽车停靠点被定义为按时间顺序排序的 Ping  集群 (包含怠速状态或发动机关闭状态的 Ping，并且满足进一步的 <code>时间-空间</code> 得约束条件。</p></li><li>每个 <code>汽车停靠点</code> 都有几个特性 (通过计算其中的 Ping)：Ping 的数量，停靠点的起点和终点 (属于该停靠点的 Ping 的第一个和最后一个时间戳)，驻留时间 (属于该停靠点的起始时间和结束时间) 和形状 (由GPS消息的最大 (最小) 纬度/经度坐标定义)。</li><li>所有这些信息对于在第二阶段提取特征工作至关重要，即汽车停靠点意图的分类。</li></ul><h4 id="贴标签"><a href="#贴标签" class="headerlink" title="贴标签"></a>贴标签</h4><ul><li>首先，对上述程序中获得的汽车停靠点分配 <code>地面实况标签</code>；再者，将它们与 <code>工单数据</code> 进行匹配。一般来说，若车辆停留点在时间上和空间上与工单数据 $W_i$ 相匹配，则可认为该汽车停靠点即为某一工单数据。<ul><li>对于只包含 idling 和 engine off Pings 的停靠点，我们认为它满足空间上的匹配。</li><li>对于任何工单，空间上匹配了停留点；如果停留点的驻留时间与工单的时间项 (指示作业已启动的时间和指示服务已结束的时间) 间隔相交，时间的匹配也随着满足。</li></ul></li></ul><h4 id="分类特征"><a href="#分类特征" class="headerlink" title="分类特征"></a>分类特征</h4><p>在 <code>车辆停靠侦查技术</code> 章节中描述的，从一系列的 GPS Pings 提取汽车停靠点，并从中提取 100 个不同的特征用于训练随机森林模型，随之将这些特征划分为 4 个不同的组：</p><ul><li>汽车停靠点特征 ( Stop-wise features，SWF )：<ul><li>驻留时间：(汽车) 停靠点第一个和最后一个 Ping 的时间差。</li><li>开始时间特征：一天中的小时，一周中的某天，某月某日，某年某日。</li><li>关闭引擎所花费的时间：对于每一个引擎关闭事件，我们计算当前 Ping 与前一个非引擎关闭状态的 Ping 之间的时间差，以表示引擎启动的时间。由于每个停靠点包含多个引擎关闭状态的 Ping，我们需要使用几个聚合函数聚合取得结果。</li><li>形状：停靠点的宽度、高度、面积、比例。</li><li>停靠点类型：发动机关闭状态。</li><li>停靠点中发动机关闭状态 Ping 的数量。</li><li>里程表距离：从第一次 Ping 到最后一次 Ping。</li><li>停靠点内 Ping 的总数。</li><li>平均速度 (根据停留点中第一次和最后一次 Ping 之间的里程差除以驻留时间计算所得)。</li></ul></li><li>兴趣点特征 ( Points of interest features，POIF)：利用 <code>PTV xLocate Server</code> 中提取以下 POI 类型：<ul><li>银行;</li><li>大学;</li><li>酒店;</li><li>餐厅;</li><li>休息区;</li><li>杂货店;</li><li>学校;</li><li>购物中心;</li><li>汽油;</li><li>开放式停车场;</li></ul></li><li><p>汽车停靠点集群特征 ( Stop cluster features，CF )：其原理是存在一些工单数据和非工单数据趋向于聚类成簇，类似于 [7] 中提出的熵度量方法：对于每个停靠点，查看并收集 250 米半径内的周边环绕的停靠点数据。</p><ul><li><p>车辆熵，计算公式为：</p><script type="math/tex; mode=display">E_v = - \sum_{\nu \in V}   \frac{n_{\nu}}{N} ln(\frac{n_{\nu}}{N})  \tag{1}</script><blockquote><p>$V$ 是车队中的车辆集合， $N$ 是 250 米半径范围内车队所有车辆的总停留点数，$n_{\nu}$ 是车辆 $\nu$ 在同一区域停靠的总次数。这个熵度量给出了一个区域内同一车队车辆的多样性。</p></blockquote></li><li><p>簇中汽车停靠点的平均，总和，最大和最小驻留时间。</p></li><li>邻近汽车停靠点的数量 (在其质心250米半径以内)。</li></ul></li><li><p>序列特征 (Sequential features，SeqF).</p></li></ul><h2 id="不足"><a href="#不足" class="headerlink" title="不足"></a>不足</h2><ul><li>在车辆停靠点侦查技术章节中，使用的是非监督方式的算法，即基于密度的 DBSCAN 聚类算法。其中涉及密度阈值的设定多少问题，就需要对具体样本量进行考究才能决定。</li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>[1] Horozov T, Narasimhan N, Vasudevan V. Using location for personalized POI recommendations in mobile environments [C]//Applications and the internet, 2006. SAINT 2006. International symposium on. IEEE, 2006: 6 pp.-129.<br>[2] Jiang K, Yin H, Wang P, et al. Learning from contextual information of geo-tagged web photos to rank personalized tourism attractions [J]. Neurocomputing, 2013, 119: 17-25.<br>[3] Palma A T, Bogorny V, Kuijpers B, et al. A clustering-based approach for discovering interesting places in trajectories [C]//Proceedings of the 2008 ACM symposium on Applied computing. ACM, 2008: 863-868.<br>[4] Gong L, Sato H, Yamamoto T, et al. Identification of activity stop locations in GPS trajectories by density-based clustering method combined with support vector machines [J]. Journal of Modern Transportation, 2015, 23(3): 202-213.<br>[5] Ester M, Kriegel H P, Sander J, et al. A density-based algorithm for discovering clusters in large spatial databases with noise [C]//Kdd. 1996, 96(34): 226-231.<br>[6] Lv M, Chen L, Xu Z, et al. The discovery of personally semantic places based on trajectory data mining [J]. Neurocomputing, 2016, 173: 1142-1153.<br>[7] Gingerich K, Maoh H, Anderson W. Classifying the purpose of stopped truck events: An application of entropy to GPS data [J]. Transportation Research Part C: Emerging Technologies, 2016, 64: 17-27.<br>[8] Sambo F, Salti S, Bravi L, et al. Integration of GPS and satellite images for detection and classification of fleet hotspots [C]//Intelligent Transportation Systems (ITSC), 2017 IEEE 20th International Conference on. IEEE, 2017: 1-6.<br>[9] Wolf J, Guensler R, Bachman W. Elimination of the travel diary: Experiment to derive trip purpose from global positioning system travel data [J]. Transportation Research Record: Journal of the Transportation Research Board, 2001 (1768): 125-134.<br>[10] Bohte W, Maat K. Deriving and validating trip purposes and travel modes for multi-day GPS-based travel surveys: A large-scale application in the Netherlands [J]. Transportation Research Part C: Emerging Technologies, 2009, 17(3): 285-297.  </p>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;note default&quot;&gt;&lt;p&gt;原文：Stop purpose classification from GPS data of commercial vehicle fleets&lt;br&gt;作者：Sarti L, Bravi L, Sambo F.&lt;br&gt;来源：Data Mining Workshops, 2017 IEEE International Conference on. IEEE, 2017: 280-287.  &lt;/p&gt;&lt;/div&gt;
&lt;h2 id=&quot;摘要&quot;&gt;&lt;a href=&quot;#摘要&quot; class=&quot;headerlink&quot; title=&quot;摘要&quot;&gt;&lt;/a&gt;摘要&lt;/h2&gt;&lt;p&gt;从原始 GPS (全球定位系统) 数据中提取 &lt;code&gt;汽车停靠意图数据&lt;/code&gt; 是大多数位置感知应用程序中的关键任务，且随着从移动设备收集 GPS 数据的不断增长，这项任务变得越来越有趣。近期很多研究都集中在行人 (手机) 数据上 (可理解为红海市场)，而商用车领域几乎没有探索 (蓝海市场)。&lt;/p&gt;
&lt;p&gt;在本论文中，针对车辆 GPS 数据的汽车停靠意图的 &lt;code&gt;识别&lt;/code&gt; 和 &lt;code&gt;分类&lt;/code&gt; 问题 (利用来自不同行业的商业车队的大型异构数据集)。按照意图分类，旨在把汽车停靠点分为：&lt;code&gt;工作相关&lt;/code&gt; 和 &lt;code&gt;非工作相关&lt;/code&gt;，以挖掘相关商业价值。&lt;/p&gt;
&lt;p&gt;且还对每个汽车停靠点计算一组含 100 个不同特征的集合，特征可分为四个主要类别：&lt;code&gt;汽车停靠点特征&lt;/code&gt;，&lt;code&gt;兴趣点特征&lt;/code&gt;，&lt;code&gt;汽车停靠点集群特征&lt;/code&gt; 和 &lt;code&gt;序列特征&lt;/code&gt;。并通过随机森林分类模型，评估四组特征中每个特征对停靠点的相对重要性，以处理不同类型的问题。&lt;/p&gt;
&lt;p&gt;实验结果表明，本论文的方法显着地超越了现有商业车辆背景下用于汽车停靠意图的分类模型。&lt;/p&gt;
    
    </summary>
    
      <category term="Paper" scheme="http://www.kofes.cn/categories/Paper/"/>
    
    
      <category term="数据挖掘" scheme="http://www.kofes.cn/tags/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/"/>
    
      <category term="聚类" scheme="http://www.kofes.cn/tags/%E8%81%9A%E7%B1%BB/"/>
    
      <category term="机器学习" scheme="http://www.kofes.cn/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="分类" scheme="http://www.kofes.cn/tags/%E5%88%86%E7%B1%BB/"/>
    
      <category term="特征提取" scheme="http://www.kofes.cn/tags/%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96/"/>
    
  </entry>
  
  <entry>
    <title>论文 - 通过非线性随机邻近嵌入自动分类细胞表达</title>
    <link href="http://www.kofes.cn/2018/06/Automatic-classification-of-cellular-expression-by-nonlinear-stochastic-embedding.html"/>
    <id>http://www.kofes.cn/2018/06/Automatic-classification-of-cellular-expression-by-nonlinear-stochastic-embedding.html</id>
    <published>2018-06-06T13:14:53.000Z</published>
    <updated>2018-06-11T16:57:11.760Z</updated>
    
    <content type="html"><![CDATA[<div class="note default"><p>原文：Automatic classification of cellular expression by nonlinear stochastic embedding (ACCENSE)<br>作者：Karthik Shekhar, Petter Brodin, Mark M.Davis and Arup K.Chakraborty.<br>来源：Proceedings of the National Academy of Sciences (PNAS), 2014, 111(1): 202-207.  </p></div><h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>质谱流式细胞技术 (Mass cytometry) 能够在单细胞水平上测试近 40 种不同的蛋白质，即提供前所未有的多维信息水平。由于各式各样的细胞种群数据集的复杂性，要收集有用的生物学知识对计算工具也有新的要求。回顾之前的聚类方法，即对于不同功能的细胞识别是基于细胞表征相似性来实现区分的。当然，经典方法存在一定局限性，例如单细胞分辨率的损失；经典方法需要预知簇中的对象数量 (本文中指细胞亚群的规模数量)。</p><a id="more"></a><p>则该论文引入 <code>ACCENSE</code> (Automatic classification of cellular expression by nonlinear stochastic embedding) 高维单细胞数据分析工具：</p><ul><li>基于密度划分的非线性降维方法，降维步骤采用 <code>t-Distributed Stochastic Neighbor Embedding (t-SNE)</code> 算法 $^{[1]}$。</li><li>探索性数据分析，同时避免任何手动 <code>阀门(阈值)</code> 的需要，即有别于基于距离的方法 (离群点判定)、基于密度的方法 (密度阈值)。</li><li>化繁为简，在二维或三维图上展示多元细胞的表型。</li></ul><p>再有，本论文将 ACCENSE 应用于 35 参数的质谱流式细胞技术，检测 CD8+ T 细胞的数量 (数据来自于特定的无病原和无菌小鼠)，并将细胞分层到表型亚群中。即对于具体的聚类算法、降维算法中，特定的符号名称会以具体的对象名称替代。</p><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h3><ul><li><p>免疫系统包含了许多类型的细胞，它们在免疫应答过程中表现出多样化的功能和复杂方式的相互作用，即通过不同蛋白质的表达水平所定义，故个体细胞的功能与其细胞表型密切相关。这里启示我们，对于不同功能的细胞可通过细胞表型相似性进行聚类区分。</p></li><li><p>传统流式细胞技术和质谱流式细胞技术</p><ul><li><p>传统流式细胞技术 (Flow Cytometry) $^{[2]}$ 中，用 <code>荧光基因</code> 标记的抗体染色，其蛋白质靶标通过单细胞分辨率的光发射信号进行量化。</p><blockquote><p>由于有限的光谱和重叠的发射信号，每个细胞限制为 12-16 个参数。</p></blockquote></li><li><p>质谱流式细胞技术 (Mass Cytometry) $^{[3]}$ ，使用 <code>金属螯合探针</code> 可以对多达 42 个参数的单个细胞进行量化。</p></li><li><p>传统流式细胞技术和质谱流式细胞技术相比，主要有两点不同：  </p><ul><li>标签系统的不同，前者主要使用各种荧光基团作为抗体的标签，后者则使用各种金属元素作为标签；  </li><li>检测系统的不同，前者使用激光器和光电倍增管，而后者使用 ICP 质谱技术。 </li></ul></li></ul></li></ul><h3 id="聚类算法"><a href="#聚类算法" class="headerlink" title="聚类算法"></a>聚类算法</h3><p>由 <code>质谱流式细胞技术产生的高维数据</code>，以具有生物学意义的方式解释是具有挑战性的。然而，很多聚类工具是基于细胞的蛋白表达相似性进行细胞分类的，例如：</p><ul><li><code>SPADE 算法</code> $^{[4,5]}$：SPADE 使用多元信息定义细胞簇，并在树状结构中显示潜在的表型层次结构。但尚有不足之处：<ul><li>一是单细胞分辨率的损失；</li><li>二是对目标集群数量的需要预知。</li></ul></li></ul><h3 id="降维算法"><a href="#降维算法" class="headerlink" title="降维算法"></a>降维算法</h3><p>同样，降维算法以蛋白质表达相似性，把空间组织的细胞群在低维空间聚集成不同的细胞亚群。    </p><ul><li><code>PCA 算法</code>：PCA降维的大致思想就是，挑选特征明显的、显得比较重要的信息保留下来。在本论文中，Newell 等人将主成分分析 (Principal component analysis，PCA) 应用于 25 参数的质谱流式细胞技术，检测人的 CD8+ T 细胞的数量，且使用前三种主成分 (3D-PCA) 分离细胞亚群。3D-PCA 以三个汇总变量表示数据，每个汇总变量都是原始维度的线性组合，并去捕获投影后数据的方差，直至其取值为最大值。然而，PCA 能在数据中所有的可能线性组合中找到最优表达，但也存在限制条件：线性投影可能太严格而不能产生精确的表示 $^{[6]}$ ( 引入 t-SNE 算法 )。</li><li><p><code>t-SNE 算法</code> $^{[7]}$：t-Distributed Stochastic Neighbor Embedding，数据降维与可视化的方法，具体的算法细节如下：</p><ul><li>让 $\{x^{(i)}\}$ 表示归一化 n 维蛋白质表达向量编码的细胞 i 表型 (i=1, 2, …, M)。</li><li>若在 2D 平面图下，$\{y^{(i)}\}$ 向量表示高维 $\{x^{(i)}\}$ 对应于低维的映射，它使得具有相似表型的 T 细胞彼此靠近嵌入，表型不相似的则嵌入相对较远的距离。</li><li>采用细胞 i 和 j 之间的成对概率 $\{p_{i,j}\}$ 表示 $\{x^{(i)}\}$ 与 $\{x^{(j)}\}$ 之间的相似性。</li><li>若在 2D 平面图下，成对概率 $\{q_{i,j}\}$ 表示 $\{y^{(i)}\}$ 与 $\{y^{(j)}\}$ 之间的相似性。</li><li><p>通过最小化 $\{p_{i,j}\}$ 与 $\{q_{i,j}\}$ 的 KL 散度 (可理解为代价函数)，然后找出嵌入向量 $\{y^{(i)}\}$，即它让高维转低维的表示信息能最大程度被保存下来。</p><blockquote><p>KL 散度 (<a href="#1-t-SNE-中的概率">详细见附录 1</a>)，Kullback-Leibler Divergence，又称相对熵，即描述两概率分布 P 和 Q 的差异。KL 散度公式 (1) 如下：</p></blockquote><script type="math/tex; mode=display">D_{KL}(\{p_{i,j}\}|\{q_{i,j}\}) = \sum_{i,j} p_{i,j} log \frac{p_{i,j}}{q_{i,j}} \tag{1}</script></li><li><p>$\{y^{(i)}\}$ 可以编码非线性关系，不像 PCA 中被约束为 $\{x^{(i)}\}$ 的线性组合。</p></li><li><code>最佳嵌入</code> 是通过数值梯度下降法来确定的，即所有数据点的 KL 散度总和减小到最小 (<a href="#2-数值梯度下降法">详细见附录 2</a>)。</li></ul></li></ul><h3 id="识别细胞亚群"><a href="#识别细胞亚群" class="headerlink" title="识别细胞亚群"></a>识别细胞亚群</h3><ul><li><p>使用一个内核密度变换，从 t-SNE 的细胞散布图计算出一个复合图像 $K_\gamma(y)$：</p><script type="math/tex; mode=display">K_\gamma(y) = exp(  -\frac{||y - y'||^{2}}{2\gamma^2}  )\tag{2}</script></li><li><p>在本论文中，$K_\gamma(y)$ 的 <code>局部最大值</code> 表示具有共同表型的 CD8+ T 细胞亚群，且使用了 matlab 的峰值检测算法识别这些局部最大值。</p><blockquote><p>当然，也可以在嵌入点上使用 K-Means 聚类算法来识别 T 细胞子集，但其要求事先指定簇的数量。</p></blockquote></li><li><p>如何求得 <code>局部最大值</code>，关键是对于公式 (2) 中 $\gamma$ 的参数设定多少有关。即通过比较不同的核-宽带 $\gamma$ 产生的结果，则存在一个 $\gamma$ 值为表型空间中存在的局部和全局特征提供了准确的粗粒度表示。从图 1-2 中可得，即启示我们可以以数据驱动的方式，近似地识别 CD8+ T 细胞的亚群。</p></li></ul><h3 id="相关图表"><a href="#相关图表" class="headerlink" title="相关图表"></a>相关图表</h3><ul><li>如图 1-1 所示，ACCENSE 应用于质谱高维数据。</li></ul><p><img src="/images/illustration/Paper/2018/06/Automatic-classification-of-cellular-expression-by-nonlinear-stochastic-embedding_1-1.jpg" alt="图1-1ACCENSE ACCENSE 应用于质谱高维数据"></p><center>图 1-1 ACCENSE 应用于质谱高维数据</center><p>(A) 质谱细胞计数数据集样本的图示。行对应于不同的细胞，而列对应于测量其表达 (细胞表面抗原和细胞内蛋白) 的不同标记的金属螯合抗体。每一元组对应于指示每个标记的表达水平的质荷比变换值 (反双曲函数)。(C) 来自SPF B6 小鼠的 CD8+ T 细胞的 2D t-SNE 图谱。每个点代表来自训练集的一个细胞 (M = 18304)，且数据点是通过对原始数据集进行下采样得到。(D) 通过使用基于内核密度变换 ($K_{\gamma}(y)\,{,}\,\gamma = 7$)，将细胞的局部概率密度嵌入 (C) 的复合图像。并使用标准的峰值检测算法进行识别局部最大值，在二维密度图表示表型亚群的中心。</p><ul><li>如图 1-2 所示，展示了峰值随着 $\gamma$ 的增加而变化。</li></ul><p><img src="/images/illustration/Paper/2018/06/Automatic-classification-of-cellular-expression-by-nonlinear-stochastic-embedding_1-2.png" alt="图1-2展示了峰值随着γ的增加而变化"></p><center>图 1-2 展示了峰值随着 $\gamma$ 的增加而变化</center><h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="1-t-SNE-中的概率"><a href="#1-t-SNE-中的概率" class="headerlink" title="1 t-SNE 中的概率"></a>1 t-SNE 中的概率</h3><h4 id="p-i-j-概率"><a href="#p-i-j-概率" class="headerlink" title="$p_{i,j}$ 概率"></a>$p_{i,j}$ 概率</h4><p>基于蛋白质相似性，设 $p_{j|i}$ (i,j = 1, 2, …, M) 表示细胞 i 将选择细胞 j 作为其最近邻的概率 ( $p_{j|i}$ 越大，$x^{(i)} 和 x^{(j)}$ 越近 )：</p><script type="math/tex; mode=display">p_{j|i} = \frac{    exp({-d_{i,j}^2} / {    2\sigma_i^2})}{     \sum_{k \neq i} exp({-d_{i,k}^2} / {    2\sigma_i^2})}, d_{i,j} = ||x^{(i)} - x^{(j)}||_2\tag{3}</script><p>对于概率 $p_{j|i}$ 的几点说明：</p><ul><li>$d_{i,j}$ 可以使用其他距离范式替代欧式距离范式；</li><li><p>原始的 SNE 算法是不对称的，为简化梯度公式，t-SNE 中让公式 (3) 的条件概率是对称的。即初始化 $p_{i|i} = 0$，对于任意的 $p_{i|j} = p_{j|i}$，可得：    </p><script type="math/tex; mode=display">p_{i,j} = \frac{  p_{j|i} + p_{i|j} }{2M} = \frac{  exp({-d_{i,j}^2} / {  2\sigma_i^2})}{   \sum_{k \neq i} exp({-d_{i,k}^2} / {  2\sigma_i^2})}\tag{4}</script></li><li><p>不同的点 $x_i$，带宽 $\sigma_i$ 的取值也是不同的。</p><ul><li>公式 (3) 中的带宽 $\sigma_i$ 是确保对于每一个细胞都有相同的复杂度 (Complexity)。复杂度可理解为一个点附近的 <code>有效近邻点个数</code>。</li><li>定义复杂度为 $P_i = 2^{H_{j|i}}$，其近似地解释为细胞 i 的最近邻点的数量。</li><li><p>定义 $p_{j|i}$ 的香农熵 (信息熵) 为 $H_{j|i} = - \sum_j p_{j|i} \log_2 p_{j|i}$，且 $H_{j|i}$ 随着 $\sigma_i$ 的增加而增加。</p><blockquote><p>在本论文中，t-SNE 图谱的复杂度被设定为 30，即 10-50 范围内的复杂度对最终结果的影响不大 (较好的鲁棒性)。</p></blockquote></li></ul></li></ul><h4 id="q-i-j-概率"><a href="#q-i-j-概率" class="headerlink" title="$q_{i,j}$ 概率"></a>$q_{i,j}$ 概率</h4><p>对于低维度下的 $\{y_i\}$，在原始的 SNE 算法 $^{[7]}$ 中 Hinton 和 Rowers 引用高斯核函数 (Gaussian Kernels) 定义 $q_{i,j}$，但在低维表达中发现了 <code>拥挤问题</code>。</p><blockquote><p><code>拥挤问题</code>：就是说各个簇聚集在一起，无法区分。譬如，有一高维度数据在降维到 10 维下可以有很好的表达，但是降维到两维后无法得到可信映射。具体情况是，10 维中有数个点之间两两等距离的，在二维下就无法得到可信的映射结果。<br>进一步说明，假设一个以数据点 $x^i$ 为中心，半径为 r 的 m 维球(三维空间就是球)，其体积是按 $r^m$ 增长的，假设数据点是在 m 维球中均匀分布的，我们来看看其他数据点与 $x^i$ 的距离随维度增大而产生的变化。</p></blockquote><p>t-SNE 减轻了拥挤问题，即使用更加偏重长尾分布的方式来将距离转换为概率分布 $^{[8]}$，故有 $q_{i,j}$：</p><script type="math/tex; mode=display">q_{i,j} = \frac{    (1 + \Delta_{i,j}^2)^{-1}}{     \sum_{k \neq i} (1 + \Delta_{i,k}^2)^{-1}}, \Delta_{i,j} = ||y^{(i)} - y^{(j)}||_2\tag{5}</script><p>同样地，对于概率 $q_{i,j}$ 的几点说明：</p><ul><li>$\Delta_{i,j}$ 可以使用其他距离范式替代欧式距离范式；</li><li>原始的 SNE 算法是不对称的，为简化梯度公式，t-SNE 中让公式 (5) 的条件概率是对称的。即初始化 $q_{i|i}=0$，对于任意的 $q_{i|j} = q_{j|i}$。</li></ul><h3 id="2-数值梯度下降法"><a href="#2-数值梯度下降法" class="headerlink" title="2 数值梯度下降法"></a>2 数值梯度下降法</h3><ul><li>在 [7] 中的概述过程，获得优化的梯度公式，如下所示:</li></ul><script type="math/tex; mode=display">\frac{    \partial D_{KL}(\{p_{i,j}\} | \{q_{i,j}\})}{    \partial_{y_t}^{(i)}} = 4 \sum_j \frac{        (p_{i,j} - q_{i,j})    }{        (1 + ||y_t^{(i)} - y_t^{(j)}||^2)    }    (y_t^{(i)} - y_t^{(j)})    \tag{6}</script><ul><li><p>通过梯度下降法迭代计算局部最大值：</p><script type="math/tex; mode=display">  y_{t+1}^{(i)} = y_{t}^{(i)} + \eta(t) \frac{      \partial D_{KL}(\{p_{i,j}\} | \{q_{i,j}\})  }{      \partial_{y_t}^{(i)}  }  + \alpha(t)(y_{t}^{(i)} - y_{t-1}^{(i)})  \tag{7}</script><ul><li>$y_t^{(i)}$ 表示迭代 t 次的解，$\eta(t)$ 表示学习速率，$\alpha(t)$ 表示迭代 t 次的动量。</li><li><p>学习速率初始值为 $\eta(t) = 100\,^{[9]}$，且动能量 $\alpha(t)$ 设定为：</p><script type="math/tex; mode=display">\alpha(t) = \begin{cases} 0.8, & t < 300 \\0.5, & t \geq 300 \end{cases}</script></li></ul></li></ul><h2 id="不足"><a href="#不足" class="headerlink" title="不足"></a>不足</h2><ul><li>t-SNE 主要用于可视化，很难用于其他目的。譬如测试集合降维，因为他没有显式的预估部分，不能在测试集合直接降维。</li><li>关于核-带宽 $\gamma$ 参数设定问题：文中展示了 $\gamma$ 参数的大小与识别细胞亚群能力的数量关系。然而，数据驱动方式虽能实现自动聚类，但缺乏对于 $\gamma$ 参数设定范围该如何控制的说明。</li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>[1] Maaten L, Hinton G. Visualizing data using t-SNE [J]. Journal of machine learning research, 2008, 9(Nov): 2579-2605.<br>[2] Cantor H, Simpson E, Sato V L, et al. And functional studies of peripheral t-cells binding different amounts of fluorescent anti-thy 1.2 (theta) Antibody using a fluorescence—activated cell sorter (FACS) [J]. 1975.<br>[3] Bendall S C, Nolan G P, Roederer M, et al. A deep profiler’s guide to cytometry [J]. Trends in immunology, 2012, 33(7): 323-332.<br>[4] Qiu P, Simonds E F, Bendall S C, et al. Extracting a cellular hierarchy from high-dimensional cytometry data with SPADE [J]. Nature biotechnology, 2011, 29(10): 886.<br>[5] Bendall S C, Simonds E F, Qiu P, et al. Single-cell mass cytometry of differential immune and drug responses across a human hematopoietic continuum [J]. Science, 2011, 332(6030): 687-696.<br>[6] Van Der Maaten L, Postma E, Van den Herik J. Dimensionality reduction: a comparative [J]. J Mach Learn Res, 2009, 10: 66-71.<br>[7] Maaten L, Hinton G. Visualizing data using t-SNE [J]. Journal of machine learning research, 2008, 9(Nov): 2579-2605.<br><a href="http://www.datakit.cn/blog/2017/02/05/t_sne_full.html" target="_blank" rel="noopener">[8] Chrispher. t-SNE 完整笔记 [OL]. www.datakit.cn. 2017.</a><br>[9] Jacobs R A. Increased rates of convergence through learning rate adaptation[J]. Neural networks, 1988, 1(4): 295-307.</p>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;note default&quot;&gt;&lt;p&gt;原文：Automatic classification of cellular expression by nonlinear stochastic embedding (ACCENSE)&lt;br&gt;作者：Karthik Shekhar, Petter Brodin, Mark M.Davis and Arup K.Chakraborty.&lt;br&gt;来源：Proceedings of the National Academy of Sciences (PNAS), 2014, 111(1): 202-207.  &lt;/p&gt;&lt;/div&gt;
&lt;h2 id=&quot;摘要&quot;&gt;&lt;a href=&quot;#摘要&quot; class=&quot;headerlink&quot; title=&quot;摘要&quot;&gt;&lt;/a&gt;摘要&lt;/h2&gt;&lt;p&gt;质谱流式细胞技术 (Mass cytometry) 能够在单细胞水平上测试近 40 种不同的蛋白质，即提供前所未有的多维信息水平。由于各式各样的细胞种群数据集的复杂性，要收集有用的生物学知识对计算工具也有新的要求。回顾之前的聚类方法，即对于不同功能的细胞识别是基于细胞表征相似性来实现区分的。当然，经典方法存在一定局限性，例如单细胞分辨率的损失；经典方法需要预知簇中的对象数量 (本文中指细胞亚群的规模数量)。&lt;/p&gt;
    
    </summary>
    
      <category term="Paper" scheme="http://www.kofes.cn/categories/Paper/"/>
    
    
      <category term="数据挖掘" scheme="http://www.kofes.cn/tags/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/"/>
    
      <category term="聚类" scheme="http://www.kofes.cn/tags/%E8%81%9A%E7%B1%BB/"/>
    
      <category term="降维" scheme="http://www.kofes.cn/tags/%E9%99%8D%E7%BB%B4/"/>
    
      <category term="免疫表型" scheme="http://www.kofes.cn/tags/%E5%85%8D%E7%96%AB%E8%A1%A8%E5%9E%8B/"/>
    
      <category term="机器学习" scheme="http://www.kofes.cn/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>论文 - 扩展 K-Means 算法：混合数据类型的聚类方法</title>
    <link href="http://www.kofes.cn/2018/06/Extensions-to-the-k-Means-algorithm-for-custering-large-datasets-with-categorical-values.html"/>
    <id>http://www.kofes.cn/2018/06/Extensions-to-the-k-Means-algorithm-for-custering-large-datasets-with-categorical-values.html</id>
    <published>2018-06-03T12:47:42.000Z</published>
    <updated>2018-07-17T01:07:36.604Z</updated>
    
    <content type="html"><![CDATA[<div class="note default"><p>原文：Extensions to the k-means algorithm for clustering large datasets with categorical values<br>作者：ZHEXUE HUANG.<br>来源：Data mining and knowledge discovery, 1998, 2(3): 283-304.  </p></div><h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>在早期，大多数聚类工作主要集中在数值数据上，且它们主要是利用数值数据的固有几何特性，即数据点之间的 <code>距离函数</code> (<a href="#1-距离函数">见附录1</a>)。但是，数据挖掘应用程序通常涉及许多数据集，这些数据集是由混合数值属性和标称属性组成的，仅拥有数值数据的测量方法已无法满足混合数据类型的聚类工作。</p><p>本论文基于经典的 K-Means 算法上，提出了两种聚类算法，分别应对 <code>标称域</code> 和 <code>混合数值与标称域</code> 属性值的聚类操作。首先介绍的是<code>K-Modes (K-众数)</code> 聚类算法，他运作的方式与 K-Means 相仿，只是它利用的是相异性度量处理标称对象，聚类中心以众数替代均值，且众数以基于频率的方法去迭代更新，直至 <code>聚类代价函数</code> 的结果最小化停止迭代。其次，是 <code>K-Prototype</code> 聚类算法，它定义了一组合的相异性度量值，进一步整合 <code>K-Means</code> 和 <code>K-Modes</code> 算法，以实现对混合数值与标称属性的对象进行聚类操作。</p><a id="more"></a><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h3><p>将数据库中的一组对象划分为同构组或集群是数据挖掘中最基本的操作。而讨论划分操作，自然离不开聚类。聚类是把每一组对象划分为一个簇，且同一簇中对象之间相似，而不同簇之间的对象相异。</p><p>数据挖掘最显著的特征是处理复杂的大型数据集。特别地，数据集包含数以百万计由不同类型属性或变量描述的对象，由此数据挖掘操作和算法应充分考虑可扩展性，以应付处理不同类型的属性。</p><p>在本论文中，提出的两个新聚类算法，即利用 <code>K-Means 范式</code> 对拥有标称属性的数据进行聚类。<code>K-Modes (K-众数)</code> 聚类算法，他运作的方式与 K-Means 相仿，只是它利用的是相异性度量处理标称对象，聚类中心以众数替代均值，且众数以基于频率的方法去迭代更新，直至 <code>聚类代价函数</code> 的结果最小化停止迭代。其次，是 <code>K-Prototype</code> 聚类算法，它定义了一组合的相异性度量值 $s^r + \gamma s^c$，以实现对混合数值与标称属性的对象进行聚类操作。其中，$s^r$ 是由 <code>平方欧式距离</code> 定义的 <code>数值属性</code> 的相异性度量值，$s^c$ 是由 <code>两个对象间类别不匹配的数量</code> 定义的 <code>标称属性</code> 的相异性度量值，$\gamma$ 是平衡数值属性和标称属性两部分的的权值，以避免偏向于某一属性。若聚类的效果更青睐于数值属性，则可以设定一个较小的 $\gamma$ 值；反之，设定一较大的 $\gamma$ 值。</p><h3 id="符号"><a href="#符号" class="headerlink" title="符号"></a>符号</h3><ul><li>假设需要聚类的对象数据集储存在数据集 D 中。<ul><li>集合的属性 $A_1, A_2, … , A_m$ 分别是值域 $D_1, D_2, … , D_m$ 的描述。</li><li>在 D 中的每个对象由元组 t 表示，$t \in D_1 \times D_2 \times … \times D_m$。</li></ul></li><li>针对本文讨论的聚类问题，仅考虑两种常见数据类型：数值类型和标称类型。<ul><li>数值域的取值范围是实数域。</li><li>在多维的密度空间中，每一个数值型的数据点都采用诸如欧式或马氏的距离度量方法。</li><li>若值域 $D_i$ 被定义为有限、无序的标称域，则对象的比较操作只允许在 $D_i$ 中执行，即有 $a, b \in D_i$，either a = b or $a \neq b$。</li></ul></li><li><p>对于数据集中的每一数据对象 $X$，也可由 <code>属性-属性值</code> 的键值对表示，</p><script type="math/tex; mode=display">[A_1=x_1] \bigwedge [A_2=x_2] \bigwedge ... \bigwedge [A_m=x_m]</script></li><li><p>即当 $x_i \in D_i$，for i = 1, 2, …, m。为简单起见，这里以 $X$ 表示元组：</p><script type="math/tex; mode=display">[x_1^r, x_2^r, ...,x_p^r, x_{p+1}^c, ..., x_m^c] \in D_1 \times D_2 \times ... \times D_m</script><blockquote><p>最后一个数值对象为元素 $p$ ，其余的都是标称对象。当然，若元组中仅有一种数据类型，可表示为 $[x_1, x_2, …, x_m]$。</p></blockquote></li></ul><h3 id="K-Means-均值-算法"><a href="#K-Means-均值-算法" class="headerlink" title="K-Means (均值) 算法"></a>K-Means (均值) 算法</h3><ul><li>K-Means，是一种划分或非分层的聚类算法，为进一步阐述细节，需给出如下设定：<ul><li>一组含 $n$ 个数值数据的对象集 $D = \{X_1, X_2, …, X_n\}$；</li><li>距离度量 $d$；</li><li>自然数 $k (\leq n)$，并把 $D$ 划分 $k$ 个非空且相分离的簇群：<script type="math/tex; mode=display">C_1, C_2, ..., C_k, \, with \, C_i \bigcap C_j = \emptyset \, and \, \bigcup_{i=1}^k C_i = D</script></li><li>$D$ 中随机选取 $k$ 个对象，每个对象代表一个簇的初始均值或中心。</li></ul></li><li><p>如此一来，使得数据对象与其簇的中心之间的平方误差总和被最小化。然后，根据非线性优化问题，将该问题描述为:</p><script type="math/tex; mode=display">  Minimise \, P(W,Q) = \sum_{l=1}^k \sum_{i=1}^n w_{i,l} d(X_i, Q_l)  \tag{1}</script><p>  且服从：</p><script type="math/tex; mode=display">  \begin{cases}  \sum_{l=1}^k w_{i,l} = 1, \, i = 1, 2, ..., n   \\ w_{i,l} \in \{0,1\}, \, i = 1, 2, ..., n; l = 1, 2, ..., k  \end{cases}  \tag{2}</script><ul><li>$w_{i,l}$ 指标变量表示对象 $X_i$ 仅属于哪一个簇。即取值为 1 时，表示对象 $X_i $ 在 簇 $C_l$ 中；反之，取值为 0。</li><li><p>$W = \left[ w_{i,l} \right]_{n \times k}$ 是分块矩阵 (见公式 3)，$Q = \{Q_1, Q_2, …, Q_K\}$ 是簇的中心集合，$d(·,·)$ 是两对象间的平方欧式距离 (<a href="#1-距离函数">见附录1</a>)。</p><script type="math/tex; mode=display">W = \left[ w_{i,l} \right]_{n \times k} = \begin{bmatrix} w_{11} & \cdots & w_{1l} & \cdots & w_{1k} \\ \vdots & & \vdots & & \vdots \\w_{i1} & \cdots & w_{il} & \cdots & w_{ik} \\\vdots & & \vdots & & \vdots \\w_{n1} & \cdots & w_{nl} & \cdots & w_{nk} \\ \end{bmatrix}\tag{3}</script></li></ul></li><li><p>紧接着，在约束条件 (2) 下对 (1) 中的 P 进行优化，即对 Q 和 W 进行局部优化。首先，我们先固定 Q 并找出必要条件 W 使 P 最小化。然后，根据 Q 去修正 W 并最小化 P。基于上述几点，若为了达到 P 最小化，K-Means 算法通过 <code>三步迭代</code>，直到 P(W, Q) <code>收敛</code> 到某个 <code>局部最小值</code>。</p><ul><li><code>Step.01</code>： 初始化 $Q^{(0)} = \{Q_1^{(0)}, Q_2^{(0)}, …, Q_k^{(0)}\}$，且设立 $t = 0$。</li><li><code>Step.02</code>：固定 $Q^{(t)}$ 不变，求解 $P(W, Q^{(t)})$ 再去获得 W，即以 Q 作为簇群的中心，将每个对象分配到距离其最近的簇中心的簇群当中。</li><li><p><code>Step.03</code>：固定 $W^{(t)}$  不变，生成 $Q^{(t+1)}$，求解 $P(W^{(t)}, Q^{(t+1)})$。比较 $P(W, Q^{(t)}) \, and \, P(W^{(t)}, Q^{(t+1)})$，若后者为最小化，则根据当前的对象部分构造新的簇群中心。</p><ul><li><p>$Q_t^{t+1} = \{q_{l,1}^{(t+1)}, …, q_{l,m}^{(t+1)}\}, \, for \, l = 1, 2, …, k$，且：</p><script type="math/tex; mode=display">q_{l,j}^{(t+1)} = \frac {  \sum_{i=1}^n w_{i,l}^{(t)} x_{i,j}}{  \sum_{i=1}^n w_{i,l}^{(t)}}, \, j = 1, 2, ..., m\tag{4}</script></li></ul></li><li><p><code>Step.04</code>：当满足收敛或给定的停止条件时 ( <code>局部最优化</code> )，输出结果并停止；反之，令 $t = t + 1$，并继续从 <code>Step.02</code> 开始执行。</p></li></ul></li><li>为了解决 <code>簇间边界不明确</code> 的问题，模糊分区的概念成功地应用到聚类问题中，即模糊聚类 $^{[2,3]}$。但是，我们在本论文中不考虑这个问题。</li><li>综上所述，K-Means 算法具有以下特征：<ul><li>局部最优化为算法结束的终止条件；</li><li>仅适用于数值属性数据的聚类；</li><li>簇群的特征为球形簇.</li></ul></li></ul><h3 id="K-Modes-众数-算法"><a href="#K-Modes-众数-算法" class="headerlink" title="K-Modes (众数) 算法"></a>K-Modes (众数) 算法</h3><p>原则上，K-Means 算法中问题 P 的公式对于分类和混合类型的对象也是有效的，之所以 K-Means 算法不能对标称属性对象进行聚类的原因是它的相异性度量方法和用于构造新的簇群中心的方法不适用，故通过对 K-Means 算法进行以下修改，可消除不适用问题：</p><ul><li>用于标称属性对象的相异性度量的方法；</li><li>簇群的中心以 <code>众数</code> 替代 <code>均值</code>；</li><li>使用基于频率的方法求的众数，以构造新的簇群中心。</li></ul><h4 id="相异性度量"><a href="#相异性度量" class="headerlink" title="相异性度量"></a>相异性度量</h4><p>相异性度量：设 $X,Y$ 是由 m 个标称属性描述的两个标称属性对象， $X,Y$ 的相异性度量可通过两个对象间相对应属性的不匹配总和来定义，即不匹配的次数越少，两个对象越相似。定义如下：</p><script type="math/tex; mode=display">d_1(X,Y) = \sum_{j=1}^m \delta (x_j,y_j)\tag{5}</script><p> 且满足条件：</p><script type="math/tex; mode=display">\delta (x_j,y_j) = \begin{cases}0 , \, (x_j = y_j) \\1 , \, (x_j \neq y_j)\end{cases} \tag{6}</script><h4 id="众数集"><a href="#众数集" class="headerlink" title="众数集"></a>众数集</h4><p>设 $X$ 是由标称属性 $A_1, A_2, …, A_m$ 描述的标称属性对象集。$X= \{X_1, X_2, …, X_n\}$ 的众数由向量 $Q =\{q_1, q_2, …, q_m\}$ 表示，并最小化函数：</p><script type="math/tex; mode=display">Minimise \, D(X,Q) = \sum_{i=1}^n d_1(Xi,Q)\tag{7}</script><blockquote><p> 注意，这里 $Q$ 并不一定是 $X$ 中包含元素 (有别于 K-Medoids 算法 $^{[4]}$，质心从它的样本点中选择 )。    </p></blockquote><h4 id="挑选众数"><a href="#挑选众数" class="headerlink" title="挑选众数"></a>挑选众数</h4><p>设 $n_{c_{k,j}}$ 为属性 $A_j$ 中包含第 k 个标称属性 $c_{k,j}$ 的对象数量，且定义 $f(A_j = c_{k,j} | X) = \frac{ n_{c_{k,j}} }{n}$ 为标称属性 $c_{k,j}$ 在 $X$ 中的出现频率。</p><ul><li><p><code>定理 1</code>：若满足下述条件 (8)，即 $D(X,Q)$ 已最小化 ( 证明见<a href="#2-定理证明">附录2</a> )。即定理定义了一种从给定的 $X$ 中找到 $Q$ 的方法，即它允许使用 K-Means 范式来聚类标称数据，且定理 1 暗示了数据集 $X$ 的众数不是唯一的。 </p><script type="math/tex; mode=display">  f(A_j = q_j | X) \geq f(A_j = c_{k,j} | X) \, for \, q_j \neq c_{k,j},j=1, 2, ..., m  \tag{8}</script></li></ul><h4 id="算法核心"><a href="#算法核心" class="headerlink" title="算法核心"></a>算法核心</h4><ul><li>当公式 (5) 用作标称属性对象的相异性度量时，公式 (1) 的代价函数将推导为：</li></ul><script type="math/tex; mode=display">P(W,Q) = \sum_{l=1}^k \sum_{i=1}^n \sum_{j=1}^m w_{i,l} \delta(x_{i,j},q_{l,j})\\\ where \, w_{i,l}  \in W \, and \, Q_l = [q_{l,1}, q_{l,1}, ..., q_{l,m}] \in Q\tag{9}</script><ul><li>为了最小化代价函数，则修改经典 K-Means 算法：<ul><li>以相异性度量方法求解 $W$，即上述 <code>Step.02</code> 所描述的，以当前 $Q$ 为簇群中心，将每个对象分配到距离其最近的簇中心的簇当中去；</li><li>用簇的众数代替均值，根据 <code>定理 1</code> 选择众数来求解  $Q$，即上述 <code>Step.03</code> 所描述的，求得新的簇群中心。</li></ul></li><li><p>在经典算法中，我们需要在每次获得一个新的 $Q$ 或 $W$ 时，根据整个数据集计算总代价 P。为了提高计算效率，我们在实践中采用了下面的算法。</p><ul><li><code>Step.01</code>：初始化 k 个众数，且每个众数对应一个簇；</li><li><code>Step.02</code>：根据公式 (5)，将距离众数最近的对象分配该簇当中。再根据 <code>定理 1</code>，在每次分配后更新簇群的众数。</li><li><code>Step.03</code>：当所有对象分配到具体的簇群之后，重新测试对象与当前众数的相异性。如果找到一个对象，距离其最近的众数属于另一个簇群而不是当前的簇群，则将该对象重新分配给该簇群，并更新两个簇群的众数。</li><li><p><code>Step.04</code>：重复执行 <code>Step.03</code>，直到对整个数据集进行完整的循环测试之后，没有对象更改簇群。</p><blockquote><p>目前，虽没有证明该算法的收敛性，但在实际使用过程中，它的表现总是收敛的。</p></blockquote></li></ul></li><li><p>与 K-Means 算法一样，K-Modes 算法也是产生 <code>局部最优解</code>，且依赖于数据集中的 <code>初始的众数</code> 和 <code>对象的顺序</code>。考虑 <code>初始的众数</code> 和 <code>对象的顺序</code> 的因素影响，我们通过两种方法改进算法。</p><ul><li>第一个方法是第一次从数据集中选择 $k$ 个不同的记录作为初始 $k$ 个众数值。</li><li><p>第二个方法通过以下步骤实现：</p><ul><li><code>Step.01</code>：计算所有属性的所有标称值的频率，并按照频率的降序将它们存储在一个标称类型的数组中，如图 2-1 所示，展示了标称类型数组中，分别包含 4、2、5、3 个标称值的 4 个属性。这里 $c_{i,j}$ 表示属性 $i$ 的标称值 $j$，$f(c_{i,j})$ 为标称值的频率，且 $f(c_{i,j}) \geq f(c_{i+1,j})$。</li><li><code>Step.02</code>：将频率最高的标称值作为 $k$ 个众数的初始值。</li><li><p><code>Step.03</code>：从 $Q_1$ 开始，选择相似性最接近其的记录并替换它的初始众数。以此类推，直至 $Q_k$  的初始众数被替换完成。其中，$Q_l \neq Q_t \, for \, l \neq t$。</p><blockquote><p><code>Step.03</code> 的目的在于避免空簇群的情况，致使初始众数具有多样性，以获得更好的聚类结果。</p></blockquote></li></ul><script type="math/tex; mode=display">\begin{Bmatrix} c_{1,1} & c_{1,2} & c_{1,3} & c_{1,4} \\ c_{2,1} & c_{2,2} & c_{2,3} & c_{2,4} \\ c_{3,1} & \, & c_{3,3} & c_{3,4} \\ c_{4,1} & \,  & c_{4,3} & \, \\ \,  & \,  & c_{5,3} & \, \\ \end{Bmatrix}</script><center>图 2-1 标称类型数组 ( 横向表示集合的属性 A，纵向表示簇中心点 Q )</center></li></ul></li></ul><h3 id="K-Prototypes-算法"><a href="#K-Prototypes-算法" class="headerlink" title="K-Prototypes 算法"></a>K-Prototypes 算法</h3><ul><li><p>将 K-Means 和 K-Modes 算法集成到 K-Prototypes 算法中是很容易的，这种算法用于混合类型对象的簇群聚类。</p></li><li><p>在混合对象 $X$ 和 $Y$ 间的相异性可由属性 $A_1^r, A_2^r, …, A_p^r, A_{p+1}^c, …, A_m^c$ 描述，并定义其相异性度量为：</p><script type="math/tex; mode=display">  d_2(X,Y) = \sum_{j=1}^p (x_j - y_j)^2 + \gamma \sum_{j=p+1}^m \delta(x_j,y_j)  \tag{10}</script><blockquote><p>其中，第一项是数值属性的平方欧氏距离度量，第二项是标称属性的相异性度量。权重 $\gamma$ 是用来避免偏袒任何类型的属性，即聚类结果更趋向于数值属性还是标称属性。</p></blockquote></li><li><p>当公式 (10) 用作混合类型属性对象的相异性度量时，公式 (1) 的代价函数将推导为：</p><script type="math/tex; mode=display">  P(W,Q) = \sum_{l=1}^k (      \sum_{i=1}^n w_{i,l} \sum_{j=1}^p(x_{i,j}-q_{l,j})^2      + \gamma \sum_{i=1}^n w_{i,l} \sum_{j=p+1}^m \delta(x_{i,j}-q_{l,j})  )  \tag{11}</script><blockquote><p>$ \sum_{i=1}^n w_{i,l}$ 即公式 (2) 所描述的，每个簇对象只对应一个簇中心。</p></blockquote><ul><li><p>为简化公式 (11)，让：</p><script type="math/tex; mode=display">P_l^r = \sum_{i=1}^n w_{i,l} \sum_{j=1}^p(x_{i,j}-q_{l,j})^2\tag{12}</script><script type="math/tex; mode=display">P_l^c =  \gamma \sum_{i=1}^n w_{i,l} \sum_{j=p+1}^m \delta(x_{i,j}-q_{l,j})\tag{13}</script></li><li><p>重写公式 (11)：</p><script type="math/tex; mode=display">P(W,Q) = \sum_{l=1}^k (P_l^r + P_l^c)\tag{14}</script></li></ul><ul><li>$P_l^r$ 和 $P_l^c$ 都是非负的，最小化 $P(W,Q)$ 等同于最小化 $P_l^r$ 和 $P_l^c$，$1 \leq l \leq k$。</li></ul></li></ul><h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="1-距离函数"><a href="#1-距离函数" class="headerlink" title="1 距离函数"></a>1 距离函数</h3><p><code>距离函数</code>：关于数据点之间的距离函数，即数值属性刻画的对象相异性的距离度量。度量方法 $^{[1]}$ 包括闵可夫斯基距离 (闵氏距离)、欧几里得距离 (欧式距离) 和曼哈顿距离。</p><p>令 $i=(x_{i1},x_{i2},…,x_{ih})$ 和 $j=(x_{j1},x_{j2},…,x_{jh})$ 是两个被 h 个属性描述的对象。 </p><p>闵氏距离是欧式距离和曼哈顿距离的推广，定义如下：</p><script type="math/tex; mode=display">d(i, j) = \sqrt[h](    \sum_{f=1}^h |x_{if}-x_{jf}|^{h}),h \geq 1\tag{1}</script><ul><li>当 h = 1 时，它表示 <code>曼哈顿距离</code>，也称 <code>城市块</code> 距离 (城市两点之间的街区距离，如向南 2 个街区，横过 3 个街区，共计五个街区)，其定义如下：</li></ul><script type="math/tex; mode=display">d(i, j) = \sum_{f=1}^h |x_{if}-x_{jf}|,h \geq 1\tag{2}</script><ul><li>当 h = 2 时，它表示 <code>欧式距离</code>，也称 <code>直线或乌鸦飞行</code> 距离，其定义如下：</li></ul><script type="math/tex; mode=display">d(i, j) = \sqrt(\sum_{f=1}^h (x_{if}-x_{jf})^2),h \geq 1\tag{3}</script><ul><li>当 h = $\infty$ 时，它表示 <code>上确界距离</code>，又称 <code>切比雪夫距离</code>，其定义如下L：</li></ul><script type="math/tex; mode=display">d(i, j) = \lim_{h \to \infty} (    \sum_{f=1}^h |x_{if}-x_{jf}|^h)^\frac{1}{h} = max_{f}^h |x_{if}-x_{jf}|\tag{4}</script><h3 id="2-定理证明"><a href="#2-定理证明" class="headerlink" title="2 定理证明"></a>2 定理证明</h3><p><code>定理 1</code> 的证明如下：</p><ul><li>让 $f_r (A_j = c_{k,j} | X) = \frac { n_{c_{k,j}} }{n}$ 为属性 $A_j$ 的第 $k$ 个标称属性 $c_{k,j}$ 的相对频率，$n$ 是 $X$ 中对象的总数，$n_{C_{k,j}}$ 是拥有标称属性 $c_{k,j}$ 的对象的计数。</li><li>则有，相异性度量公式可推导为：</li></ul><script type="math/tex; mode=display">\sum_{i=1}^n d(X_i,Q) = \sum_{i=1}^n \sum_{j=1}^m \delta(x_{i,j},q_j)\\ = \sum_{i=1}^n ( \sum_{j=1}^m \delta(x_{i,j},q_j) )= \sum_{i=1}^m n(1-\frac{n_{q_j}}{n})= \sum n( 1-f_r(A_j = q_j | X) )</script><ul><li>因为 $n( 1-f_r(A_j = q_j | X) ) \geq 0 \, , \, 1 \leq j \leq m$，若让 $\sum_{i=1}^n  d(X_i,Q)$ 最小化，则需让每一个 $n( 1-f_r(A_j = q_j | X) )$ 取最小值，即 $f_r(A_j = q_j | X)$ 必须取最大值。</li></ul><h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>[1] Jiewei Han, Micheline Kamber and Jian Pei. 数据挖掘 (第三版) [M]. 机械工业出版社, 2018, 48-49.<br>[2] Bezdek J C. A convergence theorem for the fuzzy ISODATA clustering algorithms [J]. IEEE transactions on pattern analysis and machine intelligence, 1980 (1): 1-8.<br>[3] Ismail M A, Selim S Z. Fuzzy c-means: optimality of solutions and effective termination of the algorithm[J]. Pattern recognition, 1986, 19(6): 481-485.<br>[4] Park H S, Jun C H. A simple and fast algorithm for K-medoids clustering[J]. Expert systems with applications, 2009, 36(2): 3336-3341.  </p>]]></content>
    
    <summary type="html">
    
      &lt;div class=&quot;note default&quot;&gt;&lt;p&gt;原文：Extensions to the k-means algorithm for clustering large datasets with categorical values&lt;br&gt;作者：ZHEXUE HUANG.&lt;br&gt;来源：Data mining and knowledge discovery, 1998, 2(3): 283-304.  &lt;/p&gt;&lt;/div&gt;
&lt;h2 id=&quot;摘要&quot;&gt;&lt;a href=&quot;#摘要&quot; class=&quot;headerlink&quot; title=&quot;摘要&quot;&gt;&lt;/a&gt;摘要&lt;/h2&gt;&lt;p&gt;在早期，大多数聚类工作主要集中在数值数据上，且它们主要是利用数值数据的固有几何特性，即数据点之间的 &lt;code&gt;距离函数&lt;/code&gt; (&lt;a href=&quot;#1-距离函数&quot;&gt;见附录1&lt;/a&gt;)。但是，数据挖掘应用程序通常涉及许多数据集，这些数据集是由混合数值属性和标称属性组成的，仅拥有数值数据的测量方法已无法满足混合数据类型的聚类工作。&lt;/p&gt;
&lt;p&gt;本论文基于经典的 K-Means 算法上，提出了两种聚类算法，分别应对 &lt;code&gt;标称域&lt;/code&gt; 和 &lt;code&gt;混合数值与标称域&lt;/code&gt; 属性值的聚类操作。首先介绍的是&lt;code&gt;K-Modes (K-众数)&lt;/code&gt; 聚类算法，他运作的方式与 K-Means 相仿，只是它利用的是相异性度量处理标称对象，聚类中心以众数替代均值，且众数以基于频率的方法去迭代更新，直至 &lt;code&gt;聚类代价函数&lt;/code&gt; 的结果最小化停止迭代。其次，是 &lt;code&gt;K-Prototype&lt;/code&gt; 聚类算法，它定义了一组合的相异性度量值，进一步整合 &lt;code&gt;K-Means&lt;/code&gt; 和 &lt;code&gt;K-Modes&lt;/code&gt; 算法，以实现对混合数值与标称属性的对象进行聚类操作。&lt;/p&gt;
    
    </summary>
    
      <category term="Paper" scheme="http://www.kofes.cn/categories/Paper/"/>
    
    
      <category term="数据挖掘" scheme="http://www.kofes.cn/tags/%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98/"/>
    
      <category term="聚类" scheme="http://www.kofes.cn/tags/%E8%81%9A%E7%B1%BB/"/>
    
      <category term="机器学习" scheme="http://www.kofes.cn/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="混合类型" scheme="http://www.kofes.cn/tags/%E6%B7%B7%E5%90%88%E7%B1%BB%E5%9E%8B/"/>
    
      <category term="K-Means" scheme="http://www.kofes.cn/tags/K-Means/"/>
    
  </entry>
  
</feed>
